"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6929],{257:(Is,an,ee)=>{ee.d(an,{$:()=>qs,A:()=>st,G:()=>na,K:()=>zu,L:()=>Ye,N:()=>Qt,P:()=>El,R:()=>li,U:()=>be,V:()=>Ge,W:()=>yn,X:()=>Us,Y:()=>Bs,Z:()=>ke,_:()=>tn,a:()=>Le,a0:()=>ju,a1:()=>js,a2:()=>wa,a3:()=>at,a4:()=>$u,a5:()=>Pa,a6:()=>Qu,a7:()=>Hu,a8:()=>Sa,a9:()=>Xc,aA:()=>Ee,aB:()=>rt,aC:()=>H,aD:()=>Ja,aE:()=>de,aF:()=>$e,aG:()=>ci,aH:()=>$a,aI:()=>gh,aJ:()=>Ke,aN:()=>ii,aQ:()=>Xr,aa:()=>Ju,ab:()=>Yu,ac:()=>Zc,ad:()=>eh,ae:()=>Da,af:()=>Xs,ag:()=>Xu,ah:()=>Zu,ak:()=>ti,al:()=>tl,am:()=>nl,ap:()=>pr,aq:()=>wn,as:()=>ol,at:()=>vr,au:()=>yt,av:()=>qn,aw:()=>Rs,ax:()=>ct,ay:()=>Co,az:()=>hi,b:()=>cl,c:()=>Tl,d:()=>mh,e:()=>ph,f:()=>Ar,g:()=>Rl,h:()=>wl,i:()=>Oa,j:()=>Sl,k:()=>Vn,l:()=>Ua,m:()=>Bl,o:()=>Rh,p:()=>Re,r:()=>Yi,s:()=>Ze,u:()=>Ba});var y=ee(467),Q=ee(7852),w=ee(1076),Ae=ee(8041),Tt=ee(1635),fe=ee(1362);const Re={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},st={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const na=function Bt(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},vs=function Dn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Or=new w.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Dt=new Ae.Vy("@firebase/auth");function Mr(c,...o){Dt.logLevel<=Ae.$b.ERROR&&Dt.error(`Auth (${Q.SDK_VERSION}): ${c}`,...o)}function ct(c,...o){throw Nn(c,...o)}function rt(c,...o){return Nn(c,...o)}function Lr(c,o,a){const d=Object.assign(Object.assign({},vs()),{[o]:a});return new w.FA("auth","Firebase",d).create(o,{appName:c.name})}function tt(c){return Lr(c,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Yt(c,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&ct(c,"argument-error"),Lr(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Nn(c,...o){if("string"!=typeof c){const a=o[0],d=[...o.slice(1)];return d[0]&&(d[0].appName=c.name),c._errorFactory.create(a,...d)}return Or.create(c,...o)}function H(c,o,...a){if(!c)throw Nn(o,...a)}function qt(c){const o="INTERNAL ASSERTION FAILED: "+c;throw Mr(o),new Error(o)}function yt(c,o){c||qt(o)}function Xt(){var c;return typeof self<"u"&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function ir(){return"http:"===ra()||"https:"===ra()}function ra(){var c;return typeof self<"u"&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class kn{constructor(o,a){this.shortDelay=o,this.longDelay=a,yt(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,w.jZ)()||(0,w.lV)()}get(){return function Fr(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ir()||(0,w.sr)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ur(c,o){yt(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class Br{static initialize(o,a,d){this.fetchImpl=o,a&&(this.headersImpl=a),d&&(this.responseImpl=d)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void qt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void qt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void qt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ts={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},As=new kn(3e4,6e4);function De(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function xe(c,o,a,d){return On.apply(this,arguments)}function On(){return(On=(0,y.A)(function*(c,o,a,d,_={}){return mn(c,_,(0,y.A)(function*(){let v={},x={};d&&("GET"===o?x=d:v={body:JSON.stringify(d)});const U=(0,w.Am)(Object.assign({key:c.config.apiKey},x)).slice(1),j=yield c._getAdditionalHeaders();return j["Content-Type"]="application/json",c.languageCode&&(j["X-Firebase-Locale"]=c.languageCode),Br.fetch()(Si(c,c.config.apiHost,a,U),Object.assign({method:o,headers:j,referrerPolicy:"no-referrer"},v))}))})).apply(this,arguments)}function mn(c,o,a){return Zt.apply(this,arguments)}function Zt(){return(Zt=(0,y.A)(function*(c,o,a){c._canInitEmulator=!1;const d=Object.assign(Object.assign({},Ts),o);try{const _=new qr(c),v=yield Promise.race([a(),_.promise]);_.clearNetworkTimeout();const x=yield v.json();if("needConfirmation"in x)throw _n(c,"account-exists-with-different-credential",x);if(v.ok&&!("errorMessage"in x))return x;{const U=v.ok?x.errorMessage:x.error.message,[j,re]=U.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===j)throw _n(c,"credential-already-in-use",x);if("EMAIL_EXISTS"===j)throw _n(c,"email-already-in-use",x);if("USER_DISABLED"===j)throw _n(c,"user-disabled",x);const le=d[j]||j.toLowerCase().replace(/[_\s]+/g,"-");if(re)throw Lr(c,le,re);ct(c,le)}}catch(_){if(_ instanceof w.g)throw _;ct(c,"network-request-failed",{message:String(_)})}})).apply(this,arguments)}function me(c,o,a,d){return At.apply(this,arguments)}function At(){return(At=(0,y.A)(function*(c,o,a,d,_={}){const v=yield xe(c,o,a,d,_);return"mfaPendingCredential"in v&&ct(c,"multi-factor-auth-required",{_serverResponse:v}),v})).apply(this,arguments)}function Si(c,o,a,d){const _=`${o}${a}?${d}`;return c.config.emulator?Ur(c.config,_):`${c.config.apiScheme}://${_}`}function ia(c){switch(c){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qr{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,d)=>{this.timer=setTimeout(()=>d(rt(this.auth,"network-request-failed")),As.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function _n(c,o,a){const d={appName:c.name};a.email&&(d.email=a.email),a.phoneNumber&&(d.phoneNumber=a.phoneNumber);const _=rt(c,o,d);return _.customData._tokenResponse=a,_}function Mn(c){return void 0!==c&&void 0!==c.getResponse}function sr(c){return void 0!==c&&void 0!==c.enterprise}class ws{constructor(o){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===o.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=o.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=o.recaptchaEnforcementState}getProviderEnforcementState(o){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const a of this.recaptchaEnforcementState)if(a.provider&&a.provider===o)return ia(a.enforcementState);return null}isProviderEnabled(o){return"ENFORCE"===this.getProviderEnforcementState(o)||"AUDIT"===this.getProviderEnforcementState(o)}}function zr(){return(zr=(0,y.A)(function*(c){return(yield xe(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function ht(c,o){return It.apply(this,arguments)}function It(){return(It=(0,y.A)(function*(c,o){return xe(c,"GET","/v2/recaptchaConfig",De(c,o))})).apply(this,arguments)}function Ln(){return(Ln=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function Fn(){return(Fn=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Vi(c,o){return un.apply(this,arguments)}function un(){return(un=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function Un(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch{}}function Kr(){return(Kr=(0,y.A)(function*(c,o=!1){const a=(0,w.Ku)(c),d=yield a.getIdToken(o),_=or(d);H(_&&_.exp&&_.auth_time&&_.iat,a.auth,"internal-error");const v="object"==typeof _.firebase?_.firebase:void 0,x=null==v?void 0:v.sign_in_provider;return{claims:_,token:d,authTime:Un(Gr(_.auth_time)),issuedAtTime:Un(Gr(_.iat)),expirationTime:Un(Gr(_.exp)),signInProvider:x||null,signInSecondFactor:(null==v?void 0:v.sign_in_second_factor)||null}})).apply(this,arguments)}function Gr(c){return 1e3*Number(c)}function or(c){const[o,a,d]=c.split(".");if(void 0===o||void 0===a||void 0===d)return Mr("JWT malformed, contained fewer than 3 sections"),null;try{const _=(0,w.u)(a);return _?JSON.parse(_):(Mr("Failed to decode base64 JWT payload"),null)}catch(_){return Mr("Caught error parsing JWT payload as JSON",null==_?void 0:_.toString()),null}}function jr(c){const o=or(c);return H(o,"internal-error"),H(typeof o.exp<"u","internal-error"),H(typeof o.iat<"u","internal-error"),Number(o.exp)-Number(o.iat)}function _e(c,o){return Wt.apply(this,arguments)}function Wt(){return(Wt=(0,y.A)(function*(c,o,a=!1){if(a)return o;try{return yield o}catch(d){throw d instanceof w.g&&function Kt({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}(d)&&c.auth.currentUser===c&&(yield c.auth.signOut()),d}})).apply(this,arguments)}class Bn{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const d=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),d}{this.errorBackoff=3e4;const _=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,_)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const d=this.getInterval(o);this.timerId=setTimeout((0,y.A)(function*(){yield a.iteration()}),d)}iteration(){var o=this;return(0,y.A)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===(null==a?void 0:a.code)&&o.schedule(!0))}o.schedule()})()}}class kt{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Un(this.lastLoginAt),this.creationTime=Un(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function K(c){return Me.apply(this,arguments)}function Me(){return(Me=(0,y.A)(function*(c){var o;const a=c.auth,d=yield c.getIdToken(),_=yield _e(c,Vi(a,{idToken:d}));H(null==_?void 0:_.users.length,a,"internal-error");const v=_.users[0];c._notifyReloadListener(v);const x=null!==(o=v.providerUserInfo)&&void 0!==o&&o.length?se(v.providerUserInfo):[],U=function ne(c,o){return[...c.filter(d=>!o.some(_=>_.providerId===d.providerId)),...o]}(c.providerData,x),le=!!c.isAnonymous&&!(c.email&&v.passwordHash||null!=U&&U.length),ye={uid:v.localId,displayName:v.displayName||null,photoURL:v.photoUrl||null,email:v.email||null,emailVerified:v.emailVerified||!1,phoneNumber:v.phoneNumber||null,tenantId:v.tenantId||null,providerData:U,metadata:new kt(v.createdAt,v.lastLoginAt),isAnonymous:le};Object.assign(c,ye)})).apply(this,arguments)}function ar(){return(ar=(0,y.A)(function*(c){const o=(0,w.Ku)(c);yield K(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function se(c){return c.map(o=>{var{providerId:a}=o,d=(0,Tt.Tt)(o,["providerId"]);return{providerId:a,uid:d.rawId||"",displayName:d.displayName||null,email:d.email||null,phoneNumber:d.phoneNumber||null,photoURL:d.photoUrl||null}})}function J(){return(J=(0,y.A)(function*(c,o){const a=yield mn(c,{},(0,y.A)(function*(){const d=(0,w.Am)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:_,apiKey:v}=c.config,x=Si(c,_,"/v1/token",`key=${v}`),U=yield c._getAdditionalHeaders();return U["Content-Type"]="application/x-www-form-urlencoded",Br.fetch()(x,{method:"POST",headers:U,body:d})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}function A(){return(A=(0,y.A)(function*(c,o){return xe(c,"POST","/v2/accounts:revokeToken",De(c,o))})).apply(this,arguments)}class S{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){H(o.idToken,"internal-error"),H(typeof o.idToken<"u","internal-error"),H(typeof o.refreshToken<"u","internal-error");const a="expiresIn"in o&&typeof o.expiresIn<"u"?Number(o.expiresIn):jr(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}updateFromIdToken(o){H(0!==o.length,"internal-error");const a=jr(o);this.updateTokensAndExpiration(o,null,a)}getToken(o,a=!1){var d=this;return(0,y.A)(function*(){return a||!d.accessToken||d.isExpired?(H(d.refreshToken,o,"user-token-expired"),d.refreshToken?(yield d.refresh(o,d.refreshToken),d.accessToken):null):d.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var d=this;return(0,y.A)(function*(){const{accessToken:_,refreshToken:v,expiresIn:x}=yield function sa(c,o){return J.apply(this,arguments)}(o,a);d.updateTokensAndExpiration(_,v,Number(x))})()}updateTokensAndExpiration(o,a,d){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*d}static fromJSON(o,a){const{refreshToken:d,accessToken:_,expirationTime:v}=a,x=new S;return d&&(H("string"==typeof d,"internal-error",{appName:o}),x.refreshToken=d),_&&(H("string"==typeof _,"internal-error",{appName:o}),x.accessToken=_),v&&(H("number"==typeof v,"internal-error",{appName:o}),x.expirationTime=v),x}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new S,this.toJSON())}_performRefresh(){return qt("not implemented")}}function b(c,o){H("string"==typeof c||typeof c>"u","internal-error",{appName:o})}class W{constructor(o){var{uid:a,auth:d,stsTokenManager:_}=o,v=(0,Tt.Tt)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Bn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=d,this.stsTokenManager=_,this.accessToken=_.accessToken,this.displayName=v.displayName||null,this.email=v.email||null,this.emailVerified=v.emailVerified||!1,this.phoneNumber=v.phoneNumber||null,this.photoURL=v.photoURL||null,this.isAnonymous=v.isAnonymous||!1,this.tenantId=v.tenantId||null,this.providerData=v.providerData?[...v.providerData]:[],this.metadata=new kt(v.createdAt||void 0,v.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,y.A)(function*(){const d=yield _e(a,a.stsTokenManager.getToken(a.auth,o));return H(d,a.auth,"internal-error"),a.accessToken!==d&&(a.accessToken=d,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),d})()}getIdTokenResult(o){return function Wr(c){return Kr.apply(this,arguments)}(this,o)}reload(){return function dt(c){return ar.apply(this,arguments)}(this)}_assign(o){this!==o&&(H(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){const a=new W(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}));return a.metadata._copy(this.metadata),a}_onReload(o){H(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var d=this;return(0,y.A)(function*(){let _=!1;o.idToken&&o.idToken!==d.stsTokenManager.accessToken&&(d.stsTokenManager.updateFromServerResponse(o),_=!0),a&&(yield K(d)),yield d.auth._persistUserIfCurrent(d),_&&d.auth._notifyListenersIfCurrent(d)})()}delete(){var o=this;return(0,y.A)(function*(){if((0,Q._isFirebaseServerApp)(o.auth.app))return Promise.reject(tt(o.auth));const a=yield o.getIdToken();return yield _e(o,function Ci(c,o){return Ln.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var d,_,v,x,U,j,re,le;const ye=null!==(d=a.displayName)&&void 0!==d?d:void 0,mt=null!==(_=a.email)&&void 0!==_?_:void 0,tr=null!==(v=a.phoneNumber)&&void 0!==v?v:void 0,is=null!==(x=a.photoURL)&&void 0!==x?x:void 0,xo=null!==(U=a.tenantId)&&void 0!==U?U:void 0,ss=null!==(j=a._redirectEventId)&&void 0!==j?j:void 0,mi=null!==(re=a.createdAt)&&void 0!==re?re:void 0,os=null!==(le=a.lastLoginAt)&&void 0!==le?le:void 0,{uid:as,emailVerified:Do,isAnonymous:$l,providerData:No,stsTokenManager:Ql}=a;H(as&&Ql,o,"internal-error");const Hl=S.fromJSON(this.name,Ql);H("string"==typeof as,o,"internal-error"),b(ye,o.name),b(mt,o.name),H("boolean"==typeof Do,o,"internal-error"),H("boolean"==typeof $l,o,"internal-error"),b(tr,o.name),b(is,o.name),b(xo,o.name),b(ss,o.name),b(mi,o.name),b(os,o.name);const ko=new W({uid:as,auth:o,email:mt,emailVerified:Do,displayName:ye,isAnonymous:$l,photoURL:is,phoneNumber:tr,tenantId:xo,stsTokenManager:Hl,createdAt:mi,lastLoginAt:os});return No&&Array.isArray(No)&&(ko.providerData=No.map(su=>Object.assign({},su))),ss&&(ko._redirectEventId=ss),ko}static _fromIdTokenResponse(o,a,d=!1){return(0,y.A)(function*(){const _=new S;_.updateFromServerResponse(a);const v=new W({uid:a.localId,auth:o,stsTokenManager:_,isAnonymous:d});return yield K(v),v})()}static _fromGetAccountInfoResponse(o,a,d){return(0,y.A)(function*(){const _=a.users[0];H(void 0!==_.localId,"internal-error");const v=void 0!==_.providerUserInfo?se(_.providerUserInfo):[],x=!(_.email&&_.passwordHash||null!=v&&v.length),U=new S;U.updateFromIdToken(d);const j=new W({uid:_.localId,auth:o,stsTokenManager:U,isAnonymous:x}),re={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:v,metadata:new kt(_.createdAt,_.lastLoginAt),isAnonymous:!(_.email&&_.passwordHash||null!=v&&v.length)};return Object.assign(j,re),j})()}}const te=new Map;function de(c){yt(c instanceof Function,"Expected a class definition");let o=te.get(c);return o?(yt(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,te.set(c,o),o)}const be=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,y.A)(function*(){return!0})()}_set(a,d){var _=this;return(0,y.A)(function*(){_.storage[a]=d})()}_get(a){var d=this;return(0,y.A)(function*(){const _=d.storage[a];return void 0===_?null:_})()}_remove(a){var d=this;return(0,y.A)(function*(){delete d.storage[a]})()}_addListener(a,d){}_removeListener(a,d){}}return c.type="NONE",c})();function $e(c,o,a){return`firebase:${c}:${o}:${a}`}class ot{constructor(o,a,d){this.persistence=o,this.auth=a,this.userKey=d;const{config:_,name:v}=this.auth;this.fullUserKey=$e(this.userKey,_.apiKey,v),this.fullPersistenceKey=$e("persistence",_.apiKey,v),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,y.A)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?W._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,y.A)(function*(){if(a.persistence===o)return;const d=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,d?a.setCurrentUser(d):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,d="authUser"){return(0,y.A)(function*(){if(!a.length)return new ot(de(be),o,d);const _=(yield Promise.all(a.map(function(){var re=(0,y.A)(function*(le){if(yield le._isAvailable())return le});return function(le){return re.apply(this,arguments)}}()))).filter(re=>re);let v=_[0]||de(be);const x=$e(d,o.config.apiKey,o.name);let U=null;for(const re of a)try{const le=yield re._get(x);if(le){const ye=W._fromJSON(o,le);re!==v&&(U=ye),v=re;break}}catch{}const j=_.filter(re=>re._shouldAllowMigration);return v._shouldAllowMigration&&j.length?(v=j[0],U&&(yield v._set(x,U.toJSON())),yield Promise.all(a.map(function(){var re=(0,y.A)(function*(le){if(le!==v)try{yield le._remove(x)}catch{}});return function(le){return re.apply(this,arguments)}}())),new ot(v,o,d)):new ot(v,o,d)})()}}function Gt(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(ur(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(we(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(Ue(o))return"Blackberry";if(ue(o))return"Webos";if(jt(o))return"Safari";if((o.includes("chrome/")||he(o))&&!o.includes("edge/"))return"Chrome";if(Rs(o))return"Android";{const d=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==d?void 0:d.length))return d[1]}return"Other"}function we(c=(0,w.ZQ)()){return/firefox\//i.test(c)}function jt(c=(0,w.ZQ)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function he(c=(0,w.ZQ)()){return/crios\//i.test(c)}function ur(c=(0,w.ZQ)()){return/iemobile/i.test(c)}function Rs(c=(0,w.ZQ)()){return/android/i.test(c)}function Ue(c=(0,w.ZQ)()){return/blackberry/i.test(c)}function ue(c=(0,w.ZQ)()){return/webos/i.test(c)}function qn(c=(0,w.ZQ)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function Ee(c=(0,w.ZQ)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}function Y(c=(0,w.ZQ)()){return qn(c)||Rs(c)||ue(c)||Ue(c)||/windows phone/i.test(c)||ur(c)}function lr(c,o=[]){let a;switch(c){case"Browser":a=Gt((0,w.ZQ)());break;case"Worker":a=`${Gt((0,w.ZQ)())}-${c}`;break;default:a=c}const d=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${Q.SDK_VERSION}/${d}`}class oa{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const d=v=>new Promise((x,U)=>{try{x(o(v))}catch(j){U(j)}});d.onAbort=a,this.queue.push(d);const _=this.queue.length-1;return()=>{this.queue[_]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,y.A)(function*(){if(a.auth.currentUser===o)return;const d=[];try{for(const _ of a.queue)yield _(o),_.onAbort&&d.push(_.onAbort)}catch(_){d.reverse();for(const v of d)try{v()}catch{}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null==_?void 0:_.message})}})()}}function aa(){return(aa=(0,y.A)(function*(c,o={}){return xe(c,"GET","/v2/passwordPolicy",De(c,o))})).apply(this,arguments)}class qc{constructor(o){var a,d,_,v;const x=o.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(a=x.minPasswordLength)&&void 0!==a?a:6,x.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=x.maxPasswordLength),void 0!==x.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=x.containsLowercaseCharacter),void 0!==x.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=x.containsUppercaseCharacter),void 0!==x.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=x.containsNumericCharacter),void 0!==x.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=x.containsNonAlphanumericCharacter),this.enforcementState=o.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(_=null===(d=o.allowedNonAlphanumericCharacters)||void 0===d?void 0:d.join(""))&&void 0!==_?_:"",this.forceUpgradeOnSignin=null!==(v=o.forceUpgradeOnSignin)&&void 0!==v&&v,this.schemaVersion=o.schemaVersion}validatePassword(o){var a,d,_,v,x,U;const j={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(o,j),this.validatePasswordCharacterOptions(o,j),j.isValid&&(j.isValid=null===(a=j.meetsMinPasswordLength)||void 0===a||a),j.isValid&&(j.isValid=null===(d=j.meetsMaxPasswordLength)||void 0===d||d),j.isValid&&(j.isValid=null===(_=j.containsLowercaseLetter)||void 0===_||_),j.isValid&&(j.isValid=null===(v=j.containsUppercaseLetter)||void 0===v||v),j.isValid&&(j.isValid=null===(x=j.containsNumericCharacter)||void 0===x||x),j.isValid&&(j.isValid=null===(U=j.containsNonAlphanumericCharacter)||void 0===U||U),j}validatePasswordLengthOptions(o,a){const d=this.customStrengthOptions.minPasswordLength,_=this.customStrengthOptions.maxPasswordLength;d&&(a.meetsMinPasswordLength=o.length>=d),_&&(a.meetsMaxPasswordLength=o.length<=_)}validatePasswordCharacterOptions(o,a){let d;this.updatePasswordCharacterOptionsStatuses(a,!1,!1,!1,!1);for(let _=0;_<o.length;_++)d=o.charAt(_),this.updatePasswordCharacterOptionsStatuses(a,d>="a"&&d<="z",d>="A"&&d<="Z",d>="0"&&d<="9",this.allowedNonAlphanumericCharacters.includes(d))}updatePasswordCharacterOptionsStatuses(o,a,d,_,v){this.customStrengthOptions.containsLowercaseLetter&&(o.containsLowercaseLetter||(o.containsLowercaseLetter=a)),this.customStrengthOptions.containsUppercaseLetter&&(o.containsUppercaseLetter||(o.containsUppercaseLetter=d)),this.customStrengthOptions.containsNumericCharacter&&(o.containsNumericCharacter||(o.containsNumericCharacter=_)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(o.containsNonAlphanumericCharacter||(o.containsNonAlphanumericCharacter=v))}}class $r{constructor(o,a,d,_){this.app=o,this.heartbeatServiceProvider=a,this.appCheckServiceProvider=d,this.config=_,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ua(this),this.idTokenSubscription=new ua(this),this.beforeStateQueue=new oa(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Or,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=_.sdkClientVersion}_initializeWithPersistence(o,a){var d=this;return a&&(this._popupRedirectResolver=de(a)),this._initializationPromise=this.queue((0,y.A)(function*(){var _,v;if(!d._deleted&&(d.persistenceManager=yield ot.create(d,o),!d._deleted)){if(null!==(_=d._popupRedirectResolver)&&void 0!==_&&_._shouldInitProactively)try{yield d._popupRedirectResolver._initialize(d)}catch{}yield d.initializeCurrentUser(a),d.lastNotifiedUid=(null===(v=d.currentUser)||void 0===v?void 0:v.uid)||null,!d._deleted&&(d._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,y.A)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUserFromIdToken(o){var a=this;return(0,y.A)(function*(){try{const d=yield Vi(a,{idToken:o}),_=yield W._fromGetAccountInfoResponse(a,d,o);yield a.directlySetCurrentUser(_)}catch(d){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",d),yield a.directlySetCurrentUser(null)}})()}initializeCurrentUser(o){var a=this;return(0,y.A)(function*(){var d;if((0,Q._isFirebaseServerApp)(a.app)){const U=a.app.settings.authIdToken;return U?new Promise(j=>{setTimeout(()=>a.initializeCurrentUserFromIdToken(U).then(j,j))}):a.directlySetCurrentUser(null)}const _=yield a.assertedPersistence.getCurrentUser();let v=_,x=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const U=null===(d=a.redirectUser)||void 0===d?void 0:d._redirectEventId,j=null==v?void 0:v._redirectEventId,re=yield a.tryRedirectSignIn(o);(!U||U===j)&&null!=re&&re.user&&(v=re.user,x=!0)}if(!v)return a.directlySetCurrentUser(null);if(!v._redirectEventId){if(x)try{yield a.beforeStateQueue.runMiddleware(v)}catch(U){v=_,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(U))}return v?a.reloadAndSetCurrentUserOrClear(v):a.directlySetCurrentUser(null)}return H(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===v._redirectEventId?a.directlySetCurrentUser(v):a.reloadAndSetCurrentUserOrClear(v)})()}tryRedirectSignIn(o){var a=this;return(0,y.A)(function*(){let d=null;try{d=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch{yield a._setRedirectUser(null)}return d})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,y.A)(function*(){try{yield K(o)}catch(d){if("auth/network-request-failed"!==(null==d?void 0:d.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function Es(){if(typeof navigator>"u")return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,y.A)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,y.A)(function*(){if((0,Q._isFirebaseServerApp)(a.app))return Promise.reject(tt(a));const d=o?(0,w.Ku)(o):null;return d&&H(d.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(d&&d._clone(a))})()}_updateCurrentUser(o,a=!1){var d=this;return(0,y.A)(function*(){if(!d._deleted)return o&&H(d.tenantId===o.tenantId,d,"tenant-id-mismatch"),a||(yield d.beforeStateQueue.runMiddleware(o)),d.queue((0,y.A)(function*(){yield d.directlySetCurrentUser(o),d.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,y.A)(function*(){return(0,Q._isFirebaseServerApp)(o.app)?Promise.reject(tt(o)):(yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0))})()}setPersistence(o){var a=this;return(0,Q._isFirebaseServerApp)(this.app)?Promise.reject(tt(this)):this.queue((0,y.A)(function*(){yield a.assertedPersistence.setPersistence(de(o))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(o){var a=this;return(0,y.A)(function*(){a._getPasswordPolicyInternal()||(yield a._updatePasswordPolicy());const d=a._getPasswordPolicyInternal();return d.schemaVersion!==a.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(a._errorFactory.create("unsupported-password-policy-schema-version",{})):d.validatePassword(o)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var o=this;return(0,y.A)(function*(){const a=yield function cr(c){return aa.apply(this,arguments)}(o),d=new qc(a);null===o.tenantId?o._projectPasswordPolicy=d:o._tenantPasswordPolicies[o.tenantId]=d})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new w.FA("auth","Firebase",o())}onAuthStateChanged(o,a,d){return this.registerStateListener(this.authStateSubscription,o,a,d)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,d){return this.registerStateListener(this.idTokenSubscription,o,a,d)}authStateReady(){return new Promise((o,a)=>{if(this.currentUser)o();else{const d=this.onAuthStateChanged(()=>{d(),o()},a)}})}revokeAccessToken(o){var a=this;return(0,y.A)(function*(){if(a.currentUser){const d=yield a.currentUser.getIdToken(),_={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:o,idToken:d};null!=a.tenantId&&(_.tenantId=a.tenantId),yield function B(c,o){return A.apply(this,arguments)}(a,_)}})()}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var d=this;return(0,y.A)(function*(){const _=yield d.getOrInitRedirectPersistenceManager(a);return null===o?_.removeCurrentUser():_.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,y.A)(function*(){if(!a.redirectPersistenceManager){const d=o&&de(o)||a._popupRedirectResolver;H(d,a,"argument-error"),a.redirectPersistenceManager=yield ot.create(a,[de(d._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,y.A)(function*(){var d,_;return a._isInitialized&&(yield a.queue((0,y.A)(function*(){}))),(null===(d=a._currentUser)||void 0===d?void 0:d._redirectEventId)===o?a._currentUser:(null===(_=a.redirectUser)||void 0===_?void 0:_._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,y.A)(function*(){if(o===a.currentUser)return a.queue((0,y.A)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const d=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==d&&(this.lastNotifiedUid=d,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,d,_){if(this._deleted)return()=>{};const v="function"==typeof a?a:a.next.bind(a);let x=!1;const U=this._isInitialized?Promise.resolve():this._initializationPromise;if(H(U,this,"internal-error"),U.then(()=>{x||v(this.currentUser)}),"function"==typeof a){const j=o.addObserver(a,d,_);return()=>{x=!0,j()}}{const j=o.addObserver(a);return()=>{x=!0,j()}}}directlySetCurrentUser(o){var a=this;return(0,y.A)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return H(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=lr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,y.A)(function*(){var a;const d={"X-Client-Version":o.clientVersion};o.app.options.appId&&(d["X-Firebase-gmpid"]=o.app.options.appId);const _=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();_&&(d["X-Firebase-Client"]=_);const v=yield o._getAppCheckToken();return v&&(d["X-Firebase-AppCheck"]=v),d})()}_getAppCheckToken(){var o=this;return(0,y.A)(function*(){var a;const d=yield null===(a=o.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getToken();return null!=d&&d.error&&function lt(c,...o){Dt.logLevel<=Ae.$b.WARN&&Dt.warn(`Auth (${Q.SDK_VERSION}): ${c}`,...o)}(`Error while retrieving App Check token: ${d.error}`),null==d?void 0:d.token})()}}function Ke(c){return(0,w.Ku)(c)}class ua{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,w.tD)(a=>this.observer=a)}get next(){return H(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ft={loadJS:()=>(0,y.A)(function*(){throw new Error("Unable to load external scripts")})(),recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ps(c){return ft.loadJS(c)}function M(c){return`__${c}${Math.floor(1e6*Math.random())}`}class ha{constructor(o){this.type="recaptcha-enterprise",this.auth=Ke(o)}verify(o="verify",a=!1){var d=this;return(0,y.A)(function*(){function v(){return v=(0,y.A)(function*(U){if(!a){if(null==U.tenantId&&null!=U._agentRecaptchaConfig)return U._agentRecaptchaConfig.siteKey;if(null!=U.tenantId&&void 0!==U._tenantRecaptchaConfigs[U.tenantId])return U._tenantRecaptchaConfigs[U.tenantId].siteKey}return new Promise(function(){var j=(0,y.A)(function*(re,le){ht(U,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(ye=>{if(void 0!==ye.recaptchaKey){const mt=new ws(ye);return null==U.tenantId?U._agentRecaptchaConfig=mt:U._tenantRecaptchaConfigs[U.tenantId]=mt,re(mt.siteKey)}le(new Error("recaptcha Enterprise site key undefined"))}).catch(ye=>{le(ye)})});return function(re,le){return j.apply(this,arguments)}}())}),v.apply(this,arguments)}function x(U,j,re){const le=window.grecaptcha;sr(le)?le.enterprise.ready(()=>{le.enterprise.execute(U,{action:o}).then(ye=>{j(ye)}).catch(()=>{j("NO_RECAPTCHA")})}):re(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((U,j)=>{(function _(U){return v.apply(this,arguments)})(d.auth).then(re=>{if(!a&&sr(window.grecaptcha))x(re,U,j);else{if(typeof window>"u")return void j(new Error("RecaptchaVerifier is only supported in browser"));let le=function zn(){return ft.recaptchaEnterpriseScript}();0!==le.length&&(le+=re),Ps(le).then(()=>{x(re,U,j)}).catch(ye=>{j(ye)})}}).catch(re=>{j(re)})})})()}}function qu(c,o,a){return dr.apply(this,arguments)}function dr(){return(dr=(0,y.A)(function*(c,o,a,d=!1){const _=new ha(c);let v;try{v=yield _.verify(a)}catch{v=yield _.verify(a,!0)}const x=Object.assign({},o);return Object.assign(x,d?{captchaResp:v}:{captchaResponse:v}),Object.assign(x,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(x,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),x})).apply(this,arguments)}function $t(c,o,a,d){return da.apply(this,arguments)}function da(){return da=(0,y.A)(function*(c,o,a,d){var _;if(null!==(_=c._getRecaptchaConfig())&&void 0!==_&&_.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const v=yield qu(c,o,a,"getOobCode"===a);return d(c,v)}return d(c,o).catch(function(){var v=(0,y.A)(function*(x){if("auth/missing-recaptcha-token"===x.code){console.log(`${a} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const U=yield qu(c,o,a,"getOobCode"===a);return d(c,U)}return Promise.reject(x)});return function(x){return v.apply(this,arguments)}}())}),da.apply(this,arguments)}function zu(c,o,a){const d=Ke(c);H(d._canInitEmulator,d,"emulator-config-failed"),H(/^https?:\/\//.test(o),d,"invalid-emulator-scheme");const _=!(null==a||!a.disableWarnings),v=wt(o),{host:x,port:U}=function xi(c){const o=wt(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!a)return{host:"",port:null};const d=a[2].split("@").pop()||"",_=/^(\[[^\]]+\])(:|$)/.exec(d);if(_){const v=_[1];return{host:v,port:Qr(d.substr(v.length+1))}}{const[v,x]=d.split(":");return{host:v,port:Qr(x)}}}(o);d.config.emulator={url:`${v}//${x}${null===U?"":`:${U}`}/`},d.settings.appVerificationDisabledForTesting=!0,d.emulatorConfig=Object.freeze({host:x,port:U,protocol:v.replace(":",""),options:Object.freeze({disableWarnings:_})}),_||function Wu(){function c(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}function wt(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function Qr(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class Ye{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return qt("not implemented")}_getIdTokenResponse(o){return qt("not implemented")}_linkToIdToken(o,a){return qt("not implemented")}_getReauthenticationResolver(o){return qt("not implemented")}}function Ku(c,o){return Cs.apply(this,arguments)}function Cs(){return(Cs=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:resetPassword",De(c,o))})).apply(this,arguments)}function Vs(){return(Vs=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function xs(c,o){return Ds.apply(this,arguments)}function Ds(){return(Ds=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:signUp",o)})).apply(this,arguments)}function pa(){return(pa=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:update",De(c,o))})).apply(this,arguments)}function Kc(c,o){return ma.apply(this,arguments)}function ma(){return(ma=(0,y.A)(function*(c,o){return me(c,"POST","/v1/accounts:signInWithPassword",De(c,o))})).apply(this,arguments)}function Ns(c,o){return _a.apply(this,arguments)}function _a(){return(_a=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:sendOobCode",De(c,o))})).apply(this,arguments)}function ga(){return(ga=(0,y.A)(function*(c,o){return Ns(c,o)})).apply(this,arguments)}function jc(c,o){return ya.apply(this,arguments)}function ya(){return(ya=(0,y.A)(function*(c,o){return Ns(c,o)})).apply(this,arguments)}function $c(c,o){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,y.A)(function*(c,o){return Ns(c,o)})).apply(this,arguments)}function va(){return(va=(0,y.A)(function*(c,o){return Ns(c,o)})).apply(this,arguments)}function ks(){return(ks=(0,y.A)(function*(c,o){return me(c,"POST","/v1/accounts:signInWithEmailLink",De(c,o))})).apply(this,arguments)}function Os(){return(Os=(0,y.A)(function*(c,o){return me(c,"POST","/v1/accounts:signInWithEmailLink",De(c,o))})).apply(this,arguments)}class Hr extends Ye{constructor(o,a,d,_=null){super("password",d),this._email=o,this._password=a,this._tenantId=_}static _fromEmailAndPassword(o,a){return new Hr(o,a,"password")}static _fromEmailAndCode(o,a,d=null){return new Hr(o,a,"emailLink",d)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if(null!=a&&a.email&&null!=a&&a.password){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,y.A)(function*(){switch(a.signInMethod){case"password":return $t(o,{returnSecureToken:!0,email:a._email,password:a._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Kc);case"emailLink":return function Hc(c,o){return ks.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:ct(o,"internal-error")}})()}_linkToIdToken(o,a){var d=this;return(0,y.A)(function*(){switch(d.signInMethod){case"password":return $t(o,{idToken:a,returnSecureToken:!0,email:d._email,password:d._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xs);case"emailLink":return function Jc(c,o){return Os.apply(this,arguments)}(o,{idToken:a,email:d._email,oobCode:d._password});default:ct(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function en(c,o){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,y.A)(function*(c,o){return me(c,"POST","/v1/accounts:signInWithIdp",De(c,o))})).apply(this,arguments)}class Qt extends Ye{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new Qt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):ct("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:d,signInMethod:_}=a,v=(0,Tt.Tt)(a,["providerId","signInMethod"]);if(!d||!_)return null;const x=new Qt(d,_);return x.idToken=v.idToken||void 0,x.accessToken=v.accessToken||void 0,x.secret=v.secret,x.nonce=v.nonce,x.pendingToken=v.pendingToken||null,x}_getIdTokenResponse(o){return en(o,this.buildRequest())}_linkToIdToken(o,a){const d=this.buildRequest();return d.idToken=a,en(o,d)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,en(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,w.Am)(a)}return o}}function Ms(){return(Ms=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:sendVerificationCode",De(c,o))})).apply(this,arguments)}function Ls(){return(Ls=(0,y.A)(function*(c,o){return me(c,"POST","/v1/accounts:signInWithPhoneNumber",De(c,o))})).apply(this,arguments)}function Ne(){return(Ne=(0,y.A)(function*(c,o){const a=yield me(c,"POST","/v1/accounts:signInWithPhoneNumber",De(c,o));if(a.temporaryProof)throw _n(c,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const Fs={USER_NOT_FOUND:"user-not-found"};function Ce(){return(Ce=(0,y.A)(function*(c,o){return me(c,"POST","/v1/accounts:signInWithPhoneNumber",De(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),Fs)})).apply(this,arguments)}class Kn extends Ye{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new Kn({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new Kn({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function Wn(c,o){return Ls.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function Gu(c,o){return Ne.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function pt(c,o){return Ce.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:d,verificationCode:_}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:d,code:_}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:d,phoneNumber:_,temporaryProof:v}=o;return d||a||_||v?new Kn({verificationId:a,verificationCode:d,phoneNumber:_,temporaryProof:v}):null}}class Yr{constructor(o){var a,d,_,v,x,U;const j=(0,w.I9)((0,w.hp)(o)),re=null!==(a=j.apiKey)&&void 0!==a?a:null,le=null!==(d=j.oobCode)&&void 0!==d?d:null,ye=function Jr(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(_=j.mode)&&void 0!==_?_:null);H(re&&le&&ye,"argument-error"),this.apiKey=re,this.operation=ye,this.code=le,this.continueUrl=null!==(v=j.continueUrl)&&void 0!==v?v:null,this.languageCode=null!==(x=j.languageCode)&&void 0!==x?x:null,this.tenantId=null!==(U=j.tenantId)&&void 0!==U?U:null}static parseLink(o){const a=function Rt(c){const o=(0,w.I9)((0,w.hp)(c)).link,a=o?(0,w.I9)((0,w.hp)(o)).deep_link_id:null,d=(0,w.I9)((0,w.hp)(c)).deep_link_id;return(d?(0,w.I9)((0,w.hp)(d)).link:null)||d||a||o||c}(o);try{return new Yr(a)}catch{return null}}}let Ge=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(a,d){return Hr._fromEmailAndPassword(a,d)}static credentialWithLink(a,d){const _=Yr.parseLink(d);return H(_,"argument-error"),Hr._fromEmailAndCode(a,_.code,_.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class gn{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Pt extends gn{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class ke extends Pt{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return H("providerId"in a&&"signInMethod"in a,"argument-error"),Qt._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return H(o.idToken||o.accessToken,"argument-error"),Qt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return ke.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return ke.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:d,oauthTokenSecret:_,pendingToken:v,nonce:x,providerId:U}=o;if(!d&&!_&&!a&&!v||!U)return null;try{return new ke(U)._credential({idToken:a,accessToken:d,nonce:x,pendingToken:v})}catch{return null}}}let yn=(()=>{class c extends Pt{constructor(){super("facebook.com")}static credential(a){return Qt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch{return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),Us=(()=>{class c extends Pt{constructor(){super("google.com"),this.addScope("profile")}static credential(a,d){return Qt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:d})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:d,oauthAccessToken:_}=a;if(!d&&!_)return null;try{return c.credential(d,_)}catch{return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),Bs=(()=>{class c extends Pt{constructor(){super("github.com")}static credential(a){return Qt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch{return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class Xr extends Ye{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return en(o,this.buildRequest())}_linkToIdToken(o,a){const d=this.buildRequest();return d.idToken=a,en(o,d)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,en(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:d,signInMethod:_,pendingToken:v}=a;return d&&_&&v&&d===_?new Xr(d,v):null}static _create(o,a){return new Xr(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class tn extends gn{constructor(o){H(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return tn.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return tn.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=Xr.fromJSON(o);return H(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:d}=o;if(!a||!d)return null;try{return Xr._create(d,a)}catch{return null}}}let qs=(()=>{class c extends Pt{constructor(){super("twitter.com")}static credential(a,d){return Qt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:d})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:d,oauthTokenSecret:_}=a;if(!d||!_)return null;try{return c.credential(d,_)}catch{return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function In(c,o){return Ht.apply(this,arguments)}function Ht(){return(Ht=(0,y.A)(function*(c,o){return me(c,"POST","/v1/accounts:signUp",De(c,o))})).apply(this,arguments)}class _t{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,d,_=!1){return(0,y.A)(function*(){const v=yield W._fromIdTokenResponse(o,d,_),x=vn(d);return new _t({user:v,providerId:x,_tokenResponse:d,operationType:a})})()}static _forOperation(o,a,d){return(0,y.A)(function*(){yield o._updateTokensIfNecessary(d,!0);const _=vn(d);return new _t({user:o,providerId:_,_tokenResponse:d,operationType:a})})()}}function vn(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function ju(c){return zs.apply(this,arguments)}function zs(){return(zs=(0,y.A)(function*(c){var o;if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(tt(c));const a=Ke(c);if(yield a._initializationPromise,null!==(o=a.currentUser)&&void 0!==o&&o.isAnonymous)return new _t({user:a.currentUser,providerId:null,operationType:"signIn"});const d=yield In(a,{returnSecureToken:!0}),_=yield _t._fromIdTokenResponse(a,"signIn",d,!0);return yield a._updateCurrentUser(_.user),_})).apply(this,arguments)}class En extends w.g{constructor(o,a,d,_){var v;super(a.code,a.message),this.operationType=d,this.user=_,Object.setPrototypeOf(this,En.prototype),this.customData={appName:o.name,tenantId:null!==(v=o.tenantId)&&void 0!==v?v:void 0,_serverResponse:a.customData._serverResponse,operationType:d}}static _fromErrorAndOperation(o,a,d,_){return new En(o,a,d,_)}}function Ws(c,o,a,d){return("reauthenticate"===o?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(v=>{throw"auth/multi-factor-auth-required"===v.code?En._fromErrorAndOperation(c,v,o,d):v})}function Ni(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function pr(c,o){return ki.apply(this,arguments)}function ki(){return ki=(0,y.A)(function*(c,o){const a=(0,w.Ku)(c);yield Oi(!0,a,o);const{providerUserInfo:d}=yield function Nt(c,o){return Fn.apply(this,arguments)}(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),_=Ni(d||[]);return a.providerData=a.providerData.filter(v=>_.has(v.providerId)),_.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a}),ki.apply(this,arguments)}function mr(c,o){return Ks.apply(this,arguments)}function Ks(){return(Ks=(0,y.A)(function*(c,o,a=!1){const d=yield _e(c,o._linkToIdToken(c.auth,yield c.getIdToken()),a);return _t._forOperation(c,"link",d)})).apply(this,arguments)}function Oi(c,o,a){return Zr.apply(this,arguments)}function Zr(){return(Zr=(0,y.A)(function*(c,o,a){yield K(o);const _=!1===c?"provider-already-linked":"no-such-provider";H(Ni(o.providerData).has(a)===c,o.auth,_)})).apply(this,arguments)}function Mi(c,o){return _r.apply(this,arguments)}function _r(){return(_r=(0,y.A)(function*(c,o,a=!1){const{auth:d}=c;if((0,Q._isFirebaseServerApp)(d.app))return Promise.reject(tt(d));const _="reauthenticate";try{const v=yield _e(c,Ws(d,_,o,c),a);H(v.idToken,d,"internal-error");const x=or(v.idToken);H(x,d,"internal-error");const{sub:U}=x;return H(c.uid===U,d,"user-mismatch"),_t._forOperation(c,_,v)}catch(v){throw"auth/user-not-found"===(null==v?void 0:v.code)&&ct(d,"user-mismatch"),v}})).apply(this,arguments)}function Ta(c,o){return Gs.apply(this,arguments)}function Gs(){return(Gs=(0,y.A)(function*(c,o,a=!1){if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(tt(c));const d="signIn",_=yield Ws(c,d,o),v=yield _t._fromIdTokenResponse(c,d,_);return a||(yield c._updateCurrentUser(v.user)),v})).apply(this,arguments)}function js(c,o){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,y.A)(function*(c,o){return Ta(Ke(c),o)})).apply(this,arguments)}function wa(c,o){return $s.apply(this,arguments)}function $s(){return($s=(0,y.A)(function*(c,o){const a=(0,w.Ku)(c);return yield Oi(!1,a,o.providerId),mr(a,o)})).apply(this,arguments)}function at(c,o){return Qs.apply(this,arguments)}function Qs(){return(Qs=(0,y.A)(function*(c,o){return Mi((0,w.Ku)(c),o)})).apply(this,arguments)}function hn(){return(hn=(0,y.A)(function*(c,o){return me(c,"POST","/v1/accounts:signInWithCustomToken",De(c,o))})).apply(this,arguments)}function $u(c,o){return Hs.apply(this,arguments)}function Hs(){return Hs=(0,y.A)(function*(c,o){if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(tt(c));const a=Ke(c),d=yield function qe(c,o){return hn.apply(this,arguments)}(a,{token:o,returnSecureToken:!0}),_=yield _t._fromIdTokenResponse(a,"signIn",d);return yield a._updateCurrentUser(_.user),_}),Hs.apply(this,arguments)}class Tn{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?Ra._fromServerResponse(o,a):"totpInfo"in a?Js._fromServerResponse(o,a):ct(o,"internal-error")}}class Ra extends Tn{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new Ra(a)}}class Js extends Tn{constructor(o){super("totp",o)}static _fromServerResponse(o,a){return new Js(a)}}function Ie(c,o,a){var d;H((null===(d=a.url)||void 0===d?void 0:d.length)>0,c,"invalid-continue-uri"),H(typeof a.dynamicLinkDomain>"u"||a.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(H(a.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(H(a.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function Se(c){return jn.apply(this,arguments)}function jn(){return(jn=(0,y.A)(function*(c){const o=Ke(c);o._getPasswordPolicyInternal()&&(yield o._updatePasswordPolicy())})).apply(this,arguments)}function Pa(c,o,a){return Li.apply(this,arguments)}function Li(){return(Li=(0,y.A)(function*(c,o,a){const d=Ke(c),_={requestType:"PASSWORD_RESET",email:o,clientType:"CLIENT_TYPE_WEB"};a&&Ie(d,_,a),yield $t(d,_,"getOobCode",jc)})).apply(this,arguments)}function Qu(c,o,a){return Fi.apply(this,arguments)}function Fi(){return Fi=(0,y.A)(function*(c,o,a){yield Ku((0,w.Ku)(c),{oobCode:o,newPassword:a}).catch(function(){var d=(0,y.A)(function*(_){throw"auth/password-does-not-meet-requirements"===_.code&&Se(c),_});return function(_){return d.apply(this,arguments)}}())}),Fi.apply(this,arguments)}function Hu(c,o){return Ys.apply(this,arguments)}function Ys(){return Ys=(0,y.A)(function*(c,o){yield function Wc(c,o){return pa.apply(this,arguments)}((0,w.Ku)(c),{oobCode:o})}),Ys.apply(this,arguments)}function Sa(c,o){return ba.apply(this,arguments)}function ba(){return(ba=(0,y.A)(function*(c,o){const a=(0,w.Ku)(c),d=yield Ku(a,{oobCode:o}),_=d.requestType;switch(H(_,a,"internal-error"),_){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":H(d.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":H(d.mfaInfo,a,"internal-error");default:H(d.email,a,"internal-error")}let v=null;return d.mfaInfo&&(v=Tn._fromServerResponse(Ke(a),d.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===d.requestType?d.newEmail:d.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===d.requestType?d.email:d.newEmail)||null,multiFactorInfo:v},operation:_}})).apply(this,arguments)}function Xc(c,o){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,y.A)(function*(c,o){const{data:a}=yield Sa((0,w.Ku)(c),o);return a.email})).apply(this,arguments)}function Ju(c,o,a){return Va.apply(this,arguments)}function Va(){return(Va=(0,y.A)(function*(c,o,a){if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(tt(c));const d=Ke(c),x=yield $t(d,{returnSecureToken:!0,email:o,password:a,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",In).catch(j=>{throw"auth/password-does-not-meet-requirements"===j.code&&Se(c),j}),U=yield _t._fromIdTokenResponse(d,"signIn",x);return yield d._updateCurrentUser(U.user),U})).apply(this,arguments)}function Yu(c,o,a){return(0,Q._isFirebaseServerApp)(c.app)?Promise.reject(tt(c)):js((0,w.Ku)(c),Ge.credential(o,a)).catch(function(){var d=(0,y.A)(function*(_){throw"auth/password-does-not-meet-requirements"===_.code&&Se(c),_});return function(_){return d.apply(this,arguments)}}())}function Zc(c,o,a){return xa.apply(this,arguments)}function xa(){return(xa=(0,y.A)(function*(c,o,a){const d=Ke(c),_={requestType:"EMAIL_SIGNIN",email:o,clientType:"CLIENT_TYPE_WEB"};(function v(x,U){H(U.handleCodeInApp,d,"argument-error"),U&&Ie(d,x,U)})(_,a),yield $t(d,_,"getOobCode",$c)})).apply(this,arguments)}function eh(c,o){const a=Yr.parseLink(o);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}function Da(c,o,a){return An.apply(this,arguments)}function An(){return(An=(0,y.A)(function*(c,o,a){if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(tt(c));const d=(0,w.Ku)(c),_=Ge.credentialWithLink(o,a||Xt());return H(_._tenantId===(d.tenantId||null),d,"tenant-id-mismatch"),js(d,_)})).apply(this,arguments)}function ei(){return(ei=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:createAuthUri",De(c,o))})).apply(this,arguments)}function Xs(c,o){return Zs.apply(this,arguments)}function Zs(){return Zs=(0,y.A)(function*(c,o){const d={identifier:o,continueUri:ir()?Xt():"http://localhost"},{signinMethods:_}=yield function Ui(c,o){return ei.apply(this,arguments)}((0,w.Ku)(c),d);return _||[]}),Zs.apply(this,arguments)}function Xu(c,o){return nn.apply(this,arguments)}function nn(){return nn=(0,y.A)(function*(c,o){const a=(0,w.Ku)(c),_={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&Ie(a.auth,_,o);const{email:v}=yield function Gc(c,o){return ga.apply(this,arguments)}(a.auth,_);v!==c.email&&(yield c.reload())}),nn.apply(this,arguments)}function Zu(c,o,a){return $n.apply(this,arguments)}function $n(){return $n=(0,y.A)(function*(c,o,a){const d=(0,w.Ku)(c),v={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};a&&Ie(d.auth,v,a);const{email:x}=yield function Qc(c,o){return va.apply(this,arguments)}(d.auth,v);x!==c.email&&(yield c.reload())}),$n.apply(this,arguments)}function Bi(){return(Bi=(0,y.A)(function*(c,o){return xe(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function ti(c,o){return ut.apply(this,arguments)}function ut(){return ut=(0,y.A)(function*(c,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const d=(0,w.Ku)(c),v={idToken:yield d.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},x=yield _e(d,function el(c,o){return Bi.apply(this,arguments)}(d.auth,v));d.displayName=x.displayName||null,d.photoURL=x.photoUrl||null;const U=d.providerData.find(({providerId:j})=>"password"===j);U&&(U.displayName=d.displayName,U.photoURL=d.photoURL),yield d._updateTokensIfNecessary(x)}),ut.apply(this,arguments)}function tl(c,o){const a=(0,w.Ku)(c);return(0,Q._isFirebaseServerApp)(a.auth.app)?Promise.reject(tt(a.auth)):eo(a,o,null)}function nl(c,o){return eo((0,w.Ku)(c),null,o)}function eo(c,o,a){return ni.apply(this,arguments)}function ni(){return ni=(0,y.A)(function*(c,o,a){const{auth:d}=c,v={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(v.email=o),a&&(v.password=a);const x=yield _e(c,function cn(c,o){return Vs.apply(this,arguments)}(d,v));yield c._updateTokensIfNecessary(x,!0)}),ni.apply(this,arguments)}class gr{constructor(o,a,d={}){this.isNewUser=o,this.providerId=a,this.profile=d}}class yr extends gr{constructor(o,a,d,_){super(o,a,d),this.username=_}}class zi extends gr{constructor(o,a){super(o,"facebook.com",a)}}class rl extends yr{constructor(o,a){super(o,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class il extends gr{constructor(o,a){super(o,"google.com",a)}}class th extends yr{constructor(o,a,d){super(o,"twitter.com",a,d)}}function wn(c){const{user:o,_tokenResponse:a}=c;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function qi(c){var o,a;if(!c)return null;const{providerId:d}=c,_=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},v=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!d&&null!=c&&c.idToken){const x=null===(a=null===(o=or(c.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(x)return new gr(v,"anonymous"!==x&&"custom"!==x?x:null)}if(!d)return null;switch(d){case"facebook.com":return new zi(v,_);case"github.com":return new rl(v,_);case"google.com":return new il(v,_);case"twitter.com":return new th(v,_,c.screenName||null);case"custom":case"anonymous":return new gr(v,null);default:return new gr(v,d,_)}}(a)}class Rn{constructor(o,a,d){this.type=o,this.credential=a,this.user=d}static _fromIdtoken(o,a){return new Rn("enroll",o,a)}static _fromMfaPendingCredential(o){return new Rn("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,d;if(null!=o&&o.multiFactorSession){if(null!==(a=o.multiFactorSession)&&void 0!==a&&a.pendingCredential)return Rn._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null!==(d=o.multiFactorSession)&&void 0!==d&&d.idToken)return Rn._fromIdtoken(o.multiFactorSession.idToken)}return null}}class no{constructor(o,a,d){this.session=o,this.hints=a,this.signInResolver=d}static _fromError(o,a){const d=Ke(o),_=a.customData._serverResponse,v=(_.mfaInfo||[]).map(U=>Tn._fromServerResponse(d,U));H(_.mfaPendingCredential,d,"internal-error");const x=Rn._fromMfaPendingCredential(_.mfaPendingCredential);return new no(x,v,function(){var U=(0,y.A)(function*(j){const re=yield j._process(d,x);delete _.mfaInfo,delete _.mfaPendingCredential;const le=Object.assign(Object.assign({},_),{idToken:re.idToken,refreshToken:re.refreshToken});switch(a.operationType){case"signIn":const ye=yield _t._fromIdTokenResponse(d,a.operationType,le);return yield d._updateCurrentUser(ye.user),ye;case"reauthenticate":return H(a.user,d,"internal-error"),_t._forOperation(a.user,a.operationType,le);default:ct(d,"internal-error")}});return function(j){return U.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,y.A)(function*(){return a.signInResolver(o)})()}}function ol(c,o){var a;const d=(0,w.Ku)(c),_=o;return H(o.customData.operationType,d,"argument-error"),H(null===(a=_.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,d,"argument-error"),no._fromError(d,_)}class Pn{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(d=>Tn._fromServerResponse(o.auth,d)))})}static _fromUser(o){return new Pn(o)}getSession(){var o=this;return(0,y.A)(function*(){return Rn._fromIdtoken(yield o.user.getIdToken(),o.user)})()}enroll(o,a){var d=this;return(0,y.A)(function*(){const _=o,v=yield d.getSession(),x=yield _e(d.user,_._process(d.user.auth,v,a));return yield d.user._updateTokensIfNecessary(x),d.user.reload()})()}unenroll(o){var a=this;return(0,y.A)(function*(){const d="string"==typeof o?o:o.uid,_=yield a.user.getIdToken();try{const v=yield _e(a.user,function ri(c,o){return xe(c,"POST","/v2/accounts/mfaEnrollment:withdraw",De(c,o))}(a.user.auth,{idToken:_,mfaEnrollmentId:d}));a.enrolledFactors=a.enrolledFactors.filter(({uid:x})=>x!==d),yield a.user._updateTokensIfNecessary(v),yield a.user.reload()}catch(v){throw v}})()}}const io=new WeakMap;function vr(c){const o=(0,w.Ku)(c);return io.has(o)||io.set(o,Pn._fromUser(o)),io.get(o)}const Ki="__sak";class Er{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Ki,"1"),this.storage.removeItem(Ki),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const cl=(()=>{class c extends Er{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,d)=>this.onStorageEvent(a,d),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Y(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const d of Object.keys(this.listeners)){const _=this.storage.getItem(d),v=this.localCache[d];_!==v&&a(d,v,_)}}onStorageEvent(a,d=!1){if(!a.key)return void this.forAllChangedKeys((U,j,re)=>{this.notifyListeners(U,re)});const _=a.key;d?this.detachListener():this.stopPolling();const v=()=>{const U=this.storage.getItem(_);!d&&this.localCache[_]===U||this.notifyListeners(_,U)},x=this.storage.getItem(_);!function Be(){return(0,w.lT)()&&10===document.documentMode}()||x===a.newValue||a.newValue===a.oldValue?v():setTimeout(v,10)}notifyListeners(a,d){this.localCache[a]=d;const _=this.listeners[a];if(_)for(const v of Array.from(_))v(d&&JSON.parse(d))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,d,_)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:d,newValue:_}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,d){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(d)}_removeListener(a,d){this.listeners[a]&&(this.listeners[a].delete(d),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,d){var _=()=>super._set,v=this;return(0,y.A)(function*(){yield _().call(v,a,d),v.localCache[a]=JSON.stringify(d)})()}_get(a){var d=()=>super._get,_=this;return(0,y.A)(function*(){const v=yield d().call(_,a);return _.localCache[a]=JSON.stringify(v),v})()}_remove(a){var d=()=>super._remove,_=this;return(0,y.A)(function*(){yield d().call(_,a),delete _.localCache[a]})()}}return c.type="LOCAL",c})(),Le=(()=>{class c extends Er{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,d){}_removeListener(a,d){}}return c.type="SESSION",c})();let ao=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const d=this.receivers.find(v=>v.isListeningto(a));if(d)return d;const _=new c(a);return this.receivers.push(_),_}isListeningto(a){return this.eventTarget===a}handleEvent(a){var d=this;return(0,y.A)(function*(){const _=a,{eventId:v,eventType:x,data:U}=_.data,j=d.handlersMap[x];if(null==j||!j.size)return;_.ports[0].postMessage({status:"ack",eventId:v,eventType:x});const re=Array.from(j).map(function(){var ye=(0,y.A)(function*(mt){return mt(_.origin,U)});return function(mt){return ye.apply(this,arguments)}}()),le=yield function oo(c){return Promise.all(c.map(function(){var o=(0,y.A)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(d){return{fulfilled:!1,reason:d}}});return function(a){return o.apply(this,arguments)}}()))}(re);_.ports[0].postMessage({status:"done",eventId:v,eventType:x,response:le})})()}_subscribe(a,d){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(d)}_unsubscribe(a,d){this.handlersMap[a]&&d&&this.handlersMap[a].delete(d),(!d||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function ii(c="",o=10){let a="";for(let d=0;d<o;d++)a+=Math.floor(10*Math.random());return c+a}class sh{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,d=50){var _=this;return(0,y.A)(function*(){const v=typeof MessageChannel<"u"?new MessageChannel:null;if(!v)throw new Error("connection_unavailable");let x,U;return new Promise((j,re)=>{const le=ii("",20);v.port1.start();const ye=setTimeout(()=>{re(new Error("unsupported_event"))},d);U={messageChannel:v,onMessage(mt){const tr=mt;if(tr.data.eventId===le)switch(tr.data.status){case"ack":clearTimeout(ye),x=setTimeout(()=>{re(new Error("timeout"))},3e3);break;case"done":clearTimeout(x),j(tr.data.response);break;default:clearTimeout(ye),clearTimeout(x),re(new Error("invalid_response"))}}},_.handlers.add(U),v.port1.addEventListener("message",U.onMessage),_.target.postMessage({eventType:o,eventId:le,data:a},[v.port2])}).finally(()=>{U&&_.removeMessageHandler(U)})})()}}function je(){return window}function uo(){return typeof je().WorkerGlobalScope<"u"&&"function"==typeof je().importScripts}function rn(){return(rn=(0,y.A)(function*(){if(null==navigator||!navigator.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const Na="firebaseLocalStorageDb",ai="firebaseLocalStorage",lo="fbase_key";class Tr{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function ui(c,o){return c.transaction([ai],o?"readwrite":"readonly").objectStore(ai)}function ka(){const c=indexedDB.open(Na,1);return new Promise((o,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const d=c.result;try{d.createObjectStore(ai,{keyPath:lo})}catch(_){a(_)}}),c.addEventListener("success",(0,y.A)(function*(){const d=c.result;d.objectStoreNames.contains(ai)?o(d):(d.close(),yield function fl(){const c=indexedDB.deleteDatabase(Na);return new Tr(c).toPromise()}(),o(yield ka()))}))})}function Xe(c,o,a){return Te.apply(this,arguments)}function Te(){return(Te=(0,y.A)(function*(c,o,a){const d=ui(c,!0).put({[lo]:o,value:a});return new Tr(d).toPromise()})).apply(this,arguments)}function co(){return(co=(0,y.A)(function*(c,o){const a=ui(c,!1).get(o),d=yield new Tr(a).toPromise();return void 0===d?null:d.value})).apply(this,arguments)}function Gi(c,o){const a=ui(c,!0).delete(o);return new Tr(a).toPromise()}const Oa=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,y.A)(function*(){return a.db||(a.db=yield ka()),a.db})()}_withRetries(a){var d=this;return(0,y.A)(function*(){let _=0;for(;;)try{const v=yield d._openDb();return yield a(v)}catch(v){if(_++>3)throw v;d.db&&(d.db.close(),d.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,y.A)(function*(){return uo()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,y.A)(function*(){a.receiver=ao._getInstance(function dl(){return uo()?self:null}()),a.receiver._subscribe("keyChanged",function(){var d=(0,y.A)(function*(_,v){return{keyProcessed:(yield a._poll()).includes(v.key)}});return function(_,v){return d.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var d=(0,y.A)(function*(_,v){return["keyChanged"]});return function(_,v){return d.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,y.A)(function*(){var d,_;if(a.activeServiceWorker=yield function si(){return rn.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new sh(a.activeServiceWorker);const v=yield a.sender._send("ping",{},800);v&&null!==(d=v[0])&&void 0!==d&&d.fulfilled&&null!==(_=v[0])&&void 0!==_&&_.value.includes("keyChanged")&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var d=this;return(0,y.A)(function*(){if(d.sender&&d.activeServiceWorker&&function hl(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===d.activeServiceWorker)try{yield d.sender._send("keyChanged",{key:a},d.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,y.A)(function*(){try{if(!indexedDB)return!1;const a=yield ka();return yield Xe(a,Ki,"1"),yield Gi(a,Ki),!0}catch{}return!1})()}_withPendingWrite(a){var d=this;return(0,y.A)(function*(){d.pendingWrites++;try{yield a()}finally{d.pendingWrites--}})()}_set(a,d){var _=this;return(0,y.A)(function*(){return _._withPendingWrite((0,y.A)(function*(){return yield _._withRetries(v=>Xe(v,a,d)),_.localCache[a]=d,_.notifyServiceWorker(a)}))})()}_get(a){var d=this;return(0,y.A)(function*(){const _=yield d._withRetries(v=>function pl(c,o){return co.apply(this,arguments)}(v,a));return d.localCache[a]=_,_})()}_remove(a){var d=this;return(0,y.A)(function*(){return d._withPendingWrite((0,y.A)(function*(){return yield d._withRetries(_=>Gi(_,a)),delete d.localCache[a],d.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,y.A)(function*(){const d=yield a._withRetries(x=>{const U=ui(x,!1).getAll();return new Tr(U).toPromise()});if(!d)return[];if(0!==a.pendingWrites)return[];const _=[],v=new Set;if(0!==d.length)for(const{fbase_key:x,value:U}of d)v.add(x),JSON.stringify(a.localCache[x])!==JSON.stringify(U)&&(a.notifyListeners(x,U),_.push(x));for(const x of Object.keys(a.localCache))a.localCache[x]&&!v.has(x)&&(a.notifyListeners(x,null),_.push(x));return _})()}notifyListeners(a,d){this.localCache[a]=d;const _=this.listeners[a];if(_)for(const v of Array.from(_))v(d)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,y.A)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,d){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(d)}_removeListener(a,d){this.listeners[a]&&(this.listeners[a].delete(d),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})(),Hi=1e12;class _l{constructor(o){this.auth=o,this.counter=Hi,this._widgets=new Map}render(o,a){const d=this.counter;return this._widgets.set(d,new gl(o,this.auth.name,a||{})),this.counter++,d}reset(o){var a;const d=o||Hi;null===(a=this._widgets.get(d))||void 0===a||a.delete(),this._widgets.delete(d)}getResponse(o){var a;return(null===(a=this._widgets.get(o||Hi))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,y.A)(function*(){var d;return null===(d=a._widgets.get(o||Hi))||void 0===d||d.execute(),""})()}}class gl{constructor(o,a,d){this.params=d,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const _="string"==typeof o?document.getElementById(o):o;H(_,"argument-error",{appName:a}),this.container=_,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function lh(c){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let d=0;d<c;d++)o.push(a.charAt(Math.floor(62*Math.random())));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const fo=M("rcb"),yl=new kn(3e4,6e4);class ch{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(o=je().grecaptcha)||void 0===o||!o.render)}load(o,a=""){return H(function hh(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(a),o,"argument-error"),this.shouldResolveImmediately(a)&&Mn(je().grecaptcha)?Promise.resolve(je().grecaptcha):new Promise((d,_)=>{const v=je().setTimeout(()=>{_(rt(o,"network-request-failed"))},yl.get());je()[fo]=()=>{je().clearTimeout(v),delete je()[fo];const U=je().grecaptcha;if(!U||!Mn(U))return void _(rt(o,"internal-error"));const j=U.render;U.render=(re,le)=>{const ye=j(re,le);return this.counter++,ye},this.hostLanguage=a,d(U)},Ps(`${function Bu(){return ft.recaptchaV2Script}()}?${(0,w.Am)({onload:fo,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(v),_(rt(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!(null===(a=je().grecaptcha)||void 0===a||!a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class dh{load(o){return(0,y.A)(function*(){return new _l(o)})()}clearedOneInstance(){}}const Il="recaptcha",La={theme:"light",type:"image"};class li{constructor(o,a,d=Object.assign({},La)){this.parameters=d,this.type=Il,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ke(o),this.isInvisible="invisible"===this.parameters.size,H(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const _="string"==typeof a?document.getElementById(a):a;H(_,this.auth,"argument-error"),this.container=_,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new dh:new ch,this.validateStartingState()}verify(){var o=this;return(0,y.A)(function*(){o.assertNotDestroyed();const a=yield o.render(),d=o.getAssertedRecaptcha();return d.getResponse(a)||new Promise(v=>{const x=U=>{U&&(o.tokenChangeListeners.delete(x),v(U))};o.tokenChangeListeners.add(x),o.isInvisible&&d.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){H(!this.parameters.sitekey,this.auth,"argument-error"),H(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),H(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(d=>d(a)),"function"==typeof o)o(a);else if("string"==typeof o){const d=je()[o];"function"==typeof d&&d(a)}}}assertNotDestroyed(){H(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,y.A)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const d=document.createElement("div");a.appendChild(d),a=d}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,y.A)(function*(){H(ir()&&!uo(),o.auth,"internal-error"),yield function vl(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function bi(c){return zr.apply(this,arguments)}(o.auth);H(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return H(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Fa{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=Kn._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Ze(c,o,a){return Ji.apply(this,arguments)}function Ji(){return(Ji=(0,y.A)(function*(c,o,a){if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(tt(c));const d=Ke(c),_=yield Xi(d,o,(0,w.Ku)(a));return new Fa(_,v=>js(d,v))})).apply(this,arguments)}function Ua(c,o,a){return po.apply(this,arguments)}function po(){return(po=(0,y.A)(function*(c,o,a){const d=(0,w.Ku)(c);yield Oi(!1,d,"phone");const _=yield Xi(d.auth,o,(0,w.Ku)(a));return new Fa(_,v=>wa(d,v))})).apply(this,arguments)}function Yi(c,o,a){return Jt.apply(this,arguments)}function Jt(){return(Jt=(0,y.A)(function*(c,o,a){const d=(0,w.Ku)(c);if((0,Q._isFirebaseServerApp)(d.auth.app))return Promise.reject(tt(d.auth));const _=yield Xi(d.auth,o,(0,w.Ku)(a));return new Fa(_,v=>at(d,v))})).apply(this,arguments)}function Xi(c,o,a){return mo.apply(this,arguments)}function mo(){return mo=(0,y.A)(function*(c,o,a){var d;const _=yield a.verify();try{let v;if(H("string"==typeof _,c,"argument-error"),H(a.type===Il,c,"argument-error"),v="string"==typeof o?{phoneNumber:o}:o,"session"in v){const x=v.session;if("phoneNumber"in v)return H("enroll"===x.type,c,"internal-error"),(yield function ro(c,o){return xe(c,"POST","/v2/accounts/mfaEnrollment:start",De(c,o))}(c,{idToken:x.credential,phoneEnrollmentInfo:{phoneNumber:v.phoneNumber,recaptchaToken:_}})).phoneSessionInfo.sessionInfo;{H("signin"===x.type,c,"internal-error");const U=(null===(d=v.multiFactorHint)||void 0===d?void 0:d.uid)||v.multiFactorUid;return H(U,c,"missing-multi-factor-info"),(yield function Ma(c,o){return xe(c,"POST","/v2/accounts/mfaSignIn:start",De(c,o))}(c,{mfaPendingCredential:x.credential,mfaEnrollmentId:U,phoneSignInInfo:{recaptchaToken:_}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:x}=yield function it(c,o){return Ms.apply(this,arguments)}(c,{phoneNumber:v.phoneNumber,recaptchaToken:_});return x}}finally{a._reset()}}),mo.apply(this,arguments)}function Ba(c,o){return _o.apply(this,arguments)}function _o(){return(_o=(0,y.A)(function*(c,o){const a=(0,w.Ku)(c);if((0,Q._isFirebaseServerApp)(a.auth.app))return Promise.reject(tt(a.auth));yield mr(a,o)})).apply(this,arguments)}let El=(()=>{class c{constructor(a){this.providerId=c.PROVIDER_ID,this.auth=Ke(a)}verifyPhoneNumber(a,d){return Xi(this.auth,a,(0,w.Ku)(d))}static credential(a,d){return Kn._fromVerification(a,d)}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:d,temporaryProof:_}=a;return d&&_?Kn._fromTokenResponse(d,_):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function Qn(c,o){return o?de(o):(H(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class qa extends Ye{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return en(o,this._buildIdpRequest())}_linkToIdToken(o,a){return en(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return en(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function fh(c){return Ta(c.auth,new qa(c),c.bypassAuthState)}function Zi(c){const{auth:o,user:a}=c;return H(a,o,"internal-error"),Mi(a,new qa(c),c.bypassAuthState)}function za(c){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,y.A)(function*(c){const{auth:o,user:a}=c;return H(a,o,"internal-error"),mr(a,new qa(c),c.bypassAuthState)})).apply(this,arguments)}class Ka{constructor(o,a,d,_,v=!1){this.auth=o,this.resolver=d,this.user=_,this.bypassAuthState=v,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,y.A)(function*(d,_){o.pendingPromise={resolve:d,reject:_};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(v){o.reject(v)}});return function(d,_){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,y.A)(function*(){const{urlResponse:d,sessionId:_,postBody:v,tenantId:x,error:U,type:j}=o;if(U)return void a.reject(U);const re={auth:a.auth,requestUri:d,sessionId:_,tenantId:x||void 0,postBody:v||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(j)(re))}catch(le){a.reject(le)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return fh;case"linkViaPopup":case"linkViaRedirect":return za;case"reauthViaPopup":case"reauthViaRedirect":return Zi;default:ct(this.auth,"internal-error")}}resolve(o){yt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){yt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const go=new kn(2e3,1e4);function Tl(c,o,a){return yo.apply(this,arguments)}function yo(){return(yo=(0,y.A)(function*(c,o,a){if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(rt(c,"operation-not-supported-in-this-environment"));const d=Ke(c);Yt(c,o,gn);const _=Qn(d,a);return new ja(d,"signInViaPopup",o,_).executeNotNull()})).apply(this,arguments)}function ph(c,o,a){return Io.apply(this,arguments)}function Io(){return(Io=(0,y.A)(function*(c,o,a){const d=(0,w.Ku)(c);if((0,Q._isFirebaseServerApp)(d.auth.app))return Promise.reject(rt(d.auth,"operation-not-supported-in-this-environment"));Yt(d.auth,o,gn);const _=Qn(d.auth,a);return new ja(d.auth,"reauthViaPopup",o,_,d).executeNotNull()})).apply(this,arguments)}function mh(c,o,a){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,y.A)(function*(c,o,a){const d=(0,w.Ku)(c);Yt(d.auth,o,gn);const _=Qn(d.auth,a);return new ja(d.auth,"linkViaPopup",o,_,d).executeNotNull()})).apply(this,arguments)}let ja=(()=>{class c extends Ka{constructor(a,d,_,v,x){super(a,d,v,x),this.provider=_,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var a=this;return(0,y.A)(function*(){const d=yield a.execute();return H(d,a.auth,"internal-error"),d})()}onExecution(){var a=this;return(0,y.A)(function*(){yt(1===a.filter.length,"Popup operations only handle one event");const d=ii();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],d),a.authWindow.associatedEvent=d,a.resolver._originValidation(a.auth).catch(_=>{a.reject(_)}),a.resolver._isIframeWebStorageSupported(a.auth,_=>{_||a.reject(rt(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(rt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const a=()=>{var d,_;this.pollId=null!==(_=null===(d=this.authWindow)||void 0===d?void 0:d.window)&&void 0!==_&&_.closed?window.setTimeout(()=>{this.pollId=null,this.reject(rt(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(a,go.get())};a()}}return c.currentPopupAction=null,c})();const Hn="pendingRedirect",fn=new Map;class Al extends Ka{constructor(o,a,d=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,d),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,y.A)(function*(){let d=fn.get(a.auth._key());if(!d){try{const v=(yield function _h(c,o){return vo.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;d=()=>Promise.resolve(v)}catch(_){d=()=>Promise.reject(_)}fn.set(a.auth._key(),d)}return a.bypassAuthState||fn.set(a.auth._key(),()=>Promise.resolve(null)),d()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,d=this;return(0,y.A)(function*(){if("signInViaRedirect"===o.type)return a().call(d,o);if("unknown"!==o.type){if(o.eventId){const _=yield d.auth._redirectUserForId(o.eventId);if(_)return d.user=_,a().call(d,o);d.resolve(null)}}else d.resolve(null)})()}onExecution(){return(0,y.A)(function*(){})()}cleanUp(){}}function vo(){return(vo=(0,y.A)(function*(c,o){const a=Jn(o),d=es(c);if(!(yield d._isAvailable()))return!1;const _="true"===(yield d._get(a));return yield d._remove(a),_})).apply(this,arguments)}function sn(c,o){return Eo.apply(this,arguments)}function Eo(){return(Eo=(0,y.A)(function*(c,o){return es(c)._set(Jn(o),"true")})).apply(this,arguments)}function gh(){fn.clear()}function $a(c,o){fn.set(c._key(),o)}function es(c){return de(c._redirectPersistence)}function Jn(c){return $e(Hn,c.config.apiKey,c.name)}function Ar(c,o,a){return function wr(c,o,a){return Rr.apply(this,arguments)}(c,o,a)}function Rr(){return(Rr=(0,y.A)(function*(c,o,a){if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(tt(c));const d=Ke(c);Yt(c,o,gn),yield d._initializationPromise;const _=Qn(d,a);return yield sn(_,d),_._openRedirect(d,o,"signInViaRedirect")})).apply(this,arguments)}function wl(c,o,a){return function Qa(c,o,a){return ts.apply(this,arguments)}(c,o,a)}function ts(){return(ts=(0,y.A)(function*(c,o,a){const d=(0,w.Ku)(c);if(Yt(d.auth,o,gn),(0,Q._isFirebaseServerApp)(d.auth.app))return Promise.reject(tt(d.auth));yield d.auth._initializationPromise;const _=Qn(d.auth,a);yield sn(_,d.auth);const v=yield bl(d);return _._openRedirect(d.auth,o,"reauthViaRedirect",v)})).apply(this,arguments)}function Rl(c,o,a){return function Pl(c,o,a){return Ha.apply(this,arguments)}(c,o,a)}function Ha(){return(Ha=(0,y.A)(function*(c,o,a){const d=(0,w.Ku)(c);Yt(d.auth,o,gn),yield d.auth._initializationPromise;const _=Qn(d.auth,a);yield Oi(!1,d,o.providerId),yield sn(_,d.auth);const v=yield bl(d);return _._openRedirect(d.auth,o,"linkViaRedirect",v)})).apply(this,arguments)}function Sl(c,o){return To.apply(this,arguments)}function To(){return(To=(0,y.A)(function*(c,o){return yield Ke(c)._initializationPromise,ci(c,o,!1)})).apply(this,arguments)}function ci(c,o){return Pr.apply(this,arguments)}function Pr(){return(Pr=(0,y.A)(function*(c,o,a=!1){if((0,Q._isFirebaseServerApp)(c.app))return Promise.reject(tt(c));const d=Ke(c),_=Qn(d,o),x=yield new Al(d,_,a).execute();return x&&!a&&(delete x.user._redirectEventId,yield d._persistUserIfCurrent(x.user),yield d._setRedirectUser(null,o)),x})).apply(this,arguments)}function bl(c){return Sn.apply(this,arguments)}function Sn(){return(Sn=(0,y.A)(function*(c){const o=ii(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class Ja{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(d=>{this.isEventForConsumer(o,d)&&(a=!0,this.sendToConsumer(o,d),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Ih(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vl(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var d;if(o.error&&!Vl(o)){const _=(null===(d=o.error.code)||void 0===d?void 0:d.split("auth/")[1])||"internal-error";a.onError(rt(this.auth,_))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const d=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&d}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Cl(o))}saveEventToCache(o){this.cachedEventUids.add(Cl(o)),this.lastProcessedEventTime=Date.now()}}function Cl(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function Vl({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function hi(c){return bn.apply(this,arguments)}function bn(){return(bn=(0,y.A)(function*(c,o={}){return xe(c,"GET","/v1/projects",o)})).apply(this,arguments)}const Yn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xl=/^https?/;function Ao(){return(Ao=(0,y.A)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield hi(c);for(const a of o)try{if(vh(a))return}catch{}ct(c,"unauthorized-domain")})).apply(this,arguments)}function vh(c){const o=Xt(),{protocol:a,hostname:d}=new URL(o);if(c.startsWith("chrome-extension://")){const x=new URL(c);return""===x.hostname&&""===d?"chrome-extension:"===a&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&x.hostname===d}if(!xl.test(a))return!1;if(Yn.test(c))return d===c;const _=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+_+"|"+_+")$","i").test(d)}const Ya=new kn(3e4,6e4);function wo(){const c=je().___jsl;if(null!=c&&c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let di=null;const kl=new kn(5e3,15e3),Ro="__/auth/iframe",Eh="emulator/auth/iframe",Za={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Po=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Th(c){const o=c.config;H(o.authDomain,c,"auth-domain-config-required");const a=o.emulator?Ur(o,Eh):`https://${c.config.authDomain}/${Ro}`,d={apiKey:o.apiKey,appName:c.name,v:Q.SDK_VERSION},_=Po.get(c.config.apiHost);_&&(d.eid=_);const v=c._getFrameworks();return v.length&&(d.fw=v.join(",")),`${a}?${(0,w.Am)(d).slice(1)}`}function Xn(){return Xn=(0,y.A)(function*(c){const o=yield function Xa(c){return di=di||function Nl(c){return new Promise((o,a)=>{var d,_,v;function x(){wo(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{wo(),a(rt(c,"network-request-failed"))},timeout:Ya.get()})}if(null!==(_=null===(d=je().gapi)||void 0===d?void 0:d.iframes)&&void 0!==_&&_.Iframe)o(gapi.iframes.getContext());else{if(null===(v=je().gapi)||void 0===v||!v.load){const U=M("iframefcb");return je()[U]=()=>{gapi.load?x():a(rt(c,"network-request-failed"))},Ps(`${function ca(){return ft.gapiScript}()}?onload=${U}`).catch(j=>a(j))}x()}}).catch(o=>{throw di=null,o})}(c),di}(c),a=je().gapi;return H(a,c,"internal-error"),o.open({where:document.body,url:Th(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Za,dontclear:!0},d=>new Promise(function(){var _=(0,y.A)(function*(v,x){yield d.restyle({setHideOnLeave:!1});const U=rt(c,"network-request-failed"),j=je().setTimeout(()=>{x(U)},kl.get());function re(){je().clearTimeout(j),v(d)}d.ping(re).then(re,()=>{x(U)})});return function(v,x){return _.apply(this,arguments)}}()))}),Xn.apply(this,arguments)}const ns={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class eu{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const Fl="__/auth/handler",Zn="emulator/auth/handler",pi=encodeURIComponent("fac");function Co(c,o,a,d,_,v){return Cn.apply(this,arguments)}function Cn(){return(Cn=(0,y.A)(function*(c,o,a,d,_,v){H(c.config.authDomain,c,"auth-domain-config-required"),H(c.config.apiKey,c,"invalid-api-key");const x={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:d,v:Q.SDK_VERSION,eventId:_};if(o instanceof gn){o.setDefaultLanguage(c.languageCode),x.providerId=o.providerId||"",(0,w.Im)(o.getCustomParameters())||(x.customParameters=JSON.stringify(o.getCustomParameters()));for(const[le,ye]of Object.entries(v||{}))x[le]=ye}if(o instanceof Pt){const le=o.getScopes().filter(ye=>""!==ye);le.length>0&&(x.scopes=le.join(","))}c.tenantId&&(x.tid=c.tenantId);const U=x;for(const le of Object.keys(U))void 0===U[le]&&delete U[le];const j=yield c._getAppCheckToken(),re=j?`#${pi}=${encodeURIComponent(j)}`:"";return`${function Ah({config:c}){return c.emulator?Ur(c,Zn):`https://${c.authDomain}/${Fl}`}(c)}?${(0,w.Am)(U).slice(1)}${re}`})).apply(this,arguments)}const er="webStorageSupport",Vn=class Ul{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Le,this._completeRedirectFn=ci,this._overrideRedirectResult=$a}_openPopup(o,a,d,_){var v=this;return(0,y.A)(function*(){var x;yt(null===(x=v.eventManagers[o._key()])||void 0===x?void 0:x.manager,"_initialize() not called before _openPopup()");const U=yield Co(o,a,d,Xt(),_);return function So(c,o,a,d=500,_=600){const v=Math.max((window.screen.availHeight-_)/2,0).toString(),x=Math.max((window.screen.availWidth-d)/2,0).toString();let U="";const j=Object.assign(Object.assign({},ns),{width:d.toString(),height:_.toString(),top:v,left:x}),re=(0,w.ZQ)().toLowerCase();a&&(U=he(re)?"_blank":a),we(re)&&(o=o||"http://localhost",j.scrollbars="yes");const le=Object.entries(j).reduce((mt,[tr,is])=>`${mt}${tr}=${is},`,"");if(function Bc(c=(0,w.ZQ)()){var o;return qn(c)&&!(null===(o=window.navigator)||void 0===o||!o.standalone)}(re)&&"_self"!==U)return function bo(c,o){const a=document.createElement("a");a.href=c,a.target=o;const d=document.createEvent("MouseEvent");d.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(d)}(o||"",U),new eu(null);const ye=window.open(o||"",U,le);H(ye,c,"popup-blocked");try{ye.focus()}catch{}return new eu(ye)}(o,U,ii())})()}_openRedirect(o,a,d,_){var v=this;return(0,y.A)(function*(){return yield v._originValidation(o),function oh(c){je().location.href=c}(yield Co(o,a,d,Xt(),_)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:_,promise:v}=this.eventManagers[a];return _?Promise.resolve(_):(yt(v,"If manager is not set, promise should be"),v)}const d=this.initAndGetManager(o);return this.eventManagers[a]={promise:d},d.catch(()=>{delete this.eventManagers[a]}),d}initAndGetManager(o){var a=this;return(0,y.A)(function*(){const d=yield function Ol(c){return Xn.apply(this,arguments)}(o),_=new Ja(o);return d.register("authEvent",v=>(H(null==v?void 0:v.authEvent,o,"invalid-auth-event"),{status:_.onEvent(v.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:_},a.iframes[o._key()]=d,_})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(er,{type:er},_=>{var v;const x=null===(v=null==_?void 0:_[0])||void 0===v?void 0:v[er];void 0!==x&&a(!!x),ct(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Dl(c){return Ao.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return Y()||jt()||qn()}};class tu{constructor(o){this.factorId=o}_process(o,a,d){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,d);case"signin":return this._finalizeSignIn(o,a.credential);default:return qt("unexpected MultiFactorSessionType")}}}class nu extends tu{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new nu(o)}_finalizeEnroll(o,a,d){return function ih(c,o){return xe(c,"POST","/v2/accounts/mfaEnrollment:finalize",De(c,o))}(o,{idToken:a,displayName:d,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function ji(c,o){return xe(c,"POST","/v2/accounts/mfaSignIn:finalize",De(c,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Bl=(()=>{class c{constructor(){}static assertion(a){return nu._fromCredential(a)}}return c.FACTOR_ID="phone",c})();var ru="@firebase/auth";class Wl{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,y.A)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(d=>{o((null==d?void 0:d.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);a&&(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){H(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const rs=(0,w.XA)("authIdTokenMaxAge")||300;let iu=null;const Gl=c=>function(){var o=(0,y.A)(function*(a){const d=a&&(yield a.getIdTokenResult()),_=d&&((new Date).getTime()-Date.parse(d.issuedAtTime))/1e3;if(_&&_>rs)return;const v=null==d?void 0:d.token;iu!==v&&(iu=v,yield fetch(c,{method:v?"POST":"DELETE",headers:v?{Authorization:`Bearer ${v}`}:{}}))});return function(a){return o.apply(this,arguments)}}();function Rh(c=(0,Q.getApp)()){const o=(0,Q._getProvider)(c,"auth");if(o.isInitialized())return o.getImmediate();const a=function fa(c,o){const a=(0,Q._getProvider)(c,"auth");if(a.isInitialized()){const _=a.getImmediate(),v=a.getOptions();if((0,w.bD)(v,null!=o?o:{}))return _;ct(_,"already-initialized")}return a.initialize({options:o})}(c,{popupRedirectResolver:Vn,persistence:[Oa,cl,Le]}),d=(0,w.XA)("authTokenSyncURL");if(d&&"boolean"==typeof isSecureContext&&isSecureContext){const v=new URL(d,location.origin);if(location.origin===v.origin){const x=Gl(v.toString());(function dn(c,o,a){(0,w.Ku)(c).beforeAuthStateChanged(o,a)})(a,x,()=>x(a.currentUser)),function sl(c,o,a,d){(0,w.Ku)(c).onIdTokenChanged(o,a,d)}(a,U=>x(U))}}const _=(0,w.Tj)("auth");return _&&zu(a,`http://${_}`),a}(function la(c){ft=c})({loadJS:c=>new Promise((o,a)=>{const d=document.createElement("script");d.setAttribute("src",c),d.onload=o,d.onerror=_=>{const v=rt("internal-error");v.customData=_,a(v)},d.type="text/javascript",d.charset="UTF-8",function jl(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(d)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function Kl(c){(0,Q._registerComponent)(new fe.uA("auth",(o,{options:a})=>{const d=o.getProvider("app").getImmediate(),_=o.getProvider("heartbeat"),v=o.getProvider("app-check-internal"),{apiKey:x,authDomain:U}=d.options;H(x&&!x.includes(":"),"invalid-api-key",{appName:d.name});const j={apiKey:x,authDomain:U,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:lr(c)},re=new $r(d,_,v,j);return function zc(c,o){const a=(null==o?void 0:o.persistence)||[],d=(Array.isArray(a)?a:[a]).map(de);null!=o&&o.errorMap&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(d,null==o?void 0:o.popupRedirectResolver)}(re,a),re},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,d)=>{o.getProvider("auth-internal").initialize()})),(0,Q._registerComponent)(new fe.uA("auth-internal",o=>{const a=Ke(o.getProvider("auth").getImmediate());return new Wl(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,Q.registerVersion)(ru,"1.7.7",function wh(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(c)),(0,Q.registerVersion)(ru,"1.7.7","esm2017")}("Browser")},7133:(Is,an,ee)=>{ee.d(an,{f:()=>wI});var y=ee(467),Q=ee(3953),w=ee(9842),Tt=(ee(2438),ee(177)),fe=ee(5407),We=ee(9253),Re=ee(1413),Oe=ee(7673),et=ee(1985),st=ee(8455),Bt=ee(6365),Dn=ee(8750),na=ee(983),vs=ee(3794),Pi=ee(941),Dt=ee(5558),lt=ee(6354),Mr=ee(6129);class ct extends Re.B{constructor(e=1/0,t=1/0,n=Mr.U){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:n,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:l}=this;t||(n.push(e),!i&&n.push(s.now()+l)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:n,_buffer:i}=this,s=i.slice();for(let l=0;l<s.length&&!e.closed;l+=n?1:2)e.next(s[l]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:n,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<n.length&&n.splice(0,n.length-s),!i){const l=t.now();let h=0;for(let f=1;f<n.length&&n[f]<=l;f+=2)h=f;h&&n.splice(0,h+1)}}}var rt=ee(7707),Lr=ee(9974);function Yt(r,e,...t){if(!0===e)return void r();if(!1===e)return;const n=new rt.Ms({next:()=>{n.unsubscribe(),r()}});return(0,Dn.Tg)(e(...t)).subscribe(n)}function Nn(r,e,t){let n,i=!1;return r&&"object"==typeof r?({bufferSize:n=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=r):n=null!=r?r:1/0,function tt(r={}){const{connector:e=()=>new Re.B,resetOnError:t=!0,resetOnComplete:n=!0,resetOnRefCountZero:i=!0}=r;return s=>{let l,h,f,m=0,I=!1,T=!1;const P=()=>{null==h||h.unsubscribe(),h=void 0},k=()=>{P(),l=f=void 0,I=T=!1},z=()=>{const $=l;k(),null==$||$.unsubscribe()};return(0,Lr.N)(($,G)=>{m++,!T&&!I&&P();const Z=f=null!=f?f:e();G.add(()=>{m--,0===m&&!T&&!I&&(h=Yt(z,i))}),Z.subscribe(G),!l&&m>0&&(l=new rt.Ms({next:oe=>Z.next(oe),error:oe=>{T=!0,P(),h=Yt(k,t,oe),Z.error(oe)},complete:()=>{I=!0,P(),h=Yt(k,n),Z.complete()}}),(0,Dn.Tg)($).subscribe(l))})(s)}}({connector:()=>new ct(n,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var H=ee(1594),qt=ee(8071);function yt(r,e){return(0,qt.T)(e)?(0,Dt.n)(()=>r,e):(0,Dt.n)(()=>r)}var Xt=ee(6745),ir=ee(5964);ee(7935);const Es=new Q.nKC("angularfire2.auth.use-emulator"),kn=new Q.nKC("angularfire2.auth.settings"),Ur=new Q.nKC("angularfire2.auth.tenant-id"),Br=new Q.nKC("angularfire2.auth.langugage-code"),Ts=new Q.nKC("angularfire2.auth.use-device-language"),As=new Q.nKC("angularfire.auth.persistence"),De=(r,e,t,n,i,s,l,h)=>(0,We.BM)(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{const f=e.runOutsideAngular(()=>r.auth());if(t&&f.useEmulator(...t),n&&(f.tenantId=n),f.languageCode=i,s&&f.useDeviceLanguage(),l)for(const[m,I]of Object.entries(l))f.settings[m]=I;return h&&f.setPersistence(h),f},[t,n,i,s,l,h]);let xe=(()=>{var r;class e{constructor(n,i,s,l,h,f,m,I,T,P,k,z){(0,w.A)(this,"authState",void 0),(0,w.A)(this,"idToken",void 0),(0,w.A)(this,"user",void 0),(0,w.A)(this,"idTokenResult",void 0),(0,w.A)(this,"credential",void 0);const $=new Re.B,G=(0,Oe.of)(void 0).pipe((0,Pi.Q)(h.outsideAngular),(0,Dt.n)(()=>l.runOutsideAngular(()=>Promise.resolve().then(ee.bind(ee,2438)))),(0,lt.T)(()=>(0,We.iB)(n,l,i)),(0,lt.T)(Z=>De(Z,l,f,I,T,P,m,k)),Nn({bufferSize:1,refCount:!1}));if((0,Tt.Vy)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Oe.of)(null);else{G.pipe((0,H.$)()).subscribe();const Z=G.pipe((0,Dt.n)(ie=>ie.getRedirectResult().then(pe=>pe,()=>null)),fe.U0,Nn({bufferSize:1,refCount:!1})),oe=G.pipe((0,Dt.n)(ie=>new et.c(pe=>({unsubscribe:l.runOutsideAngular(()=>ie.onAuthStateChanged(ce=>pe.next(ce),ce=>pe.error(ce),()=>pe.complete()))})))),ae=G.pipe((0,Dt.n)(ie=>new et.c(pe=>({unsubscribe:l.runOutsideAngular(()=>ie.onIdTokenChanged(ce=>pe.next(ce),ce=>pe.error(ce),()=>pe.complete()))}))));this.authState=Z.pipe(yt(oe),(0,Xt._)(h.outsideAngular),(0,Pi.Q)(h.insideAngular)),this.user=Z.pipe(yt(ae),(0,Xt._)(h.outsideAngular),(0,Pi.Q)(h.insideAngular)),this.idToken=this.user.pipe((0,Dt.n)(ie=>ie?(0,st.H)(ie.getIdToken()):(0,Oe.of)(null))),this.idTokenResult=this.user.pipe((0,Dt.n)(ie=>ie?(0,st.H)(ie.getIdTokenResult()):(0,Oe.of)(null))),this.credential=function Or(...r){const e=(0,vs.lI)(r),t=(0,vs.R0)(r,1/0),n=r;return n.length?1===n.length?(0,Dn.Tg)(n[0]):(0,Bt.U)(t)((0,st.H)(n,e)):na.w}(Z,$,this.authState.pipe((0,ir.p)(ie=>!ie))).pipe((0,lt.T)(ie=>null!=ie&&ie.user?ie:null),(0,Xt._)(h.outsideAngular),(0,Pi.Q)(h.insideAngular))}return(0,We.Gt)(this,G,l,{spy:{apply:(Z,oe,ae)=>{(Z.startsWith("signIn")||Z.startsWith("createUser"))&&ae.then(ie=>$.next(ie))}}})}}return r=e,(0,w.A)(e,"\u0275fac",function(n){return new(n||r)(Q.KVO(We.rx),Q.KVO(We.uP,8),Q.KVO(Q.Agw),Q.KVO(Q.SKi),Q.KVO(fe.u0),Q.KVO(Es,8),Q.KVO(kn,8),Q.KVO(Ur,8),Q.KVO(Br,8),Q.KVO(Ts,8),Q.KVO(As,8),Q.KVO(fe.Jv,8))}),(0,w.A)(e,"\u0275prov",Q.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})),e})();var mn=ee(257),Zt=ee(7852),me=ee(1076),At=ee(8041),Si=ee(1362),ia=ee(3236),qr=ee(9172),_n=ee(4360);function Mn(){return(0,Lr.N)((r,e)=>{let t,n=!1;r.subscribe((0,_n._)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var It,Ci,sr=ee(2816),ws=ee(3294),bi=ee(3345),zr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ht={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(D,R,V){V||(V=0);var N=Array(16);if("string"==typeof R)for(var O=0;16>O;++O)N[O]=R.charCodeAt(V++)|R.charCodeAt(V++)<<8|R.charCodeAt(V++)<<16|R.charCodeAt(V++)<<24;else for(O=0;16>O;++O)N[O]=R[V++]|R[V++]<<8|R[V++]<<16|R[V++]<<24;var F=D.g[3],C=(R=D.g[0])+(F^(V=D.g[1])&((O=D.g[2])^F))+N[0]+3614090360&4294967295;C=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=(V=(O=(F=(R=V+(C<<7&4294967295|C>>>25))+((C=F+(O^R&(V^O))+N[1]+3905402710&4294967295)<<12&4294967295|C>>>20))+((C=O+(V^F&(R^V))+N[2]+606105819&4294967295)<<17&4294967295|C>>>15))+((C=V+(R^O&(F^R))+N[3]+3250441966&4294967295)<<22&4294967295|C>>>10))+((C=R+(F^V&(O^F))+N[4]+4118548399&4294967295)<<7&4294967295|C>>>25))+((C=F+(O^R&(V^O))+N[5]+1200080426&4294967295)<<12&4294967295|C>>>20))+((C=O+(V^F&(R^V))+N[6]+2821735955&4294967295)<<17&4294967295|C>>>15))+((C=V+(R^O&(F^R))+N[7]+4249261313&4294967295)<<22&4294967295|C>>>10))+((C=R+(F^V&(O^F))+N[8]+1770035416&4294967295)<<7&4294967295|C>>>25))+((C=F+(O^R&(V^O))+N[9]+2336552879&4294967295)<<12&4294967295|C>>>20))+((C=O+(V^F&(R^V))+N[10]+4294925233&4294967295)<<17&4294967295|C>>>15))+((C=V+(R^O&(F^R))+N[11]+2304563134&4294967295)<<22&4294967295|C>>>10))+((C=R+(F^V&(O^F))+N[12]+1804603682&4294967295)<<7&4294967295|C>>>25))+((C=F+(O^R&(V^O))+N[13]+4254626195&4294967295)<<12&4294967295|C>>>20))+((C=O+(V^F&(R^V))+N[14]+2792965006&4294967295)<<17&4294967295|C>>>15))+((C=V+(R^O&(F^R))+N[15]+1236535329&4294967295)<<22&4294967295|C>>>10))+((C=R+(O^F&(V^O))+N[1]+4129170786&4294967295)<<5&4294967295|C>>>27))+((C=F+(V^O&(R^V))+N[6]+3225465664&4294967295)<<9&4294967295|C>>>23))+((C=O+(R^V&(F^R))+N[11]+643717713&4294967295)<<14&4294967295|C>>>18))+((C=V+(F^R&(O^F))+N[0]+3921069994&4294967295)<<20&4294967295|C>>>12))+((C=R+(O^F&(V^O))+N[5]+3593408605&4294967295)<<5&4294967295|C>>>27))+((C=F+(V^O&(R^V))+N[10]+38016083&4294967295)<<9&4294967295|C>>>23))+((C=O+(R^V&(F^R))+N[15]+3634488961&4294967295)<<14&4294967295|C>>>18))+((C=V+(F^R&(O^F))+N[4]+3889429448&4294967295)<<20&4294967295|C>>>12))+((C=R+(O^F&(V^O))+N[9]+568446438&4294967295)<<5&4294967295|C>>>27))+((C=F+(V^O&(R^V))+N[14]+3275163606&4294967295)<<9&4294967295|C>>>23))+((C=O+(R^V&(F^R))+N[3]+4107603335&4294967295)<<14&4294967295|C>>>18))+((C=V+(F^R&(O^F))+N[8]+1163531501&4294967295)<<20&4294967295|C>>>12))+((C=R+(O^F&(V^O))+N[13]+2850285829&4294967295)<<5&4294967295|C>>>27))+((C=F+(V^O&(R^V))+N[2]+4243563512&4294967295)<<9&4294967295|C>>>23))+((C=O+(R^V&(F^R))+N[7]+1735328473&4294967295)<<14&4294967295|C>>>18))+((C=V+(F^R&(O^F))+N[12]+2368359562&4294967295)<<20&4294967295|C>>>12))+((C=R+(V^O^F)+N[5]+4294588738&4294967295)<<4&4294967295|C>>>28))+((C=F+(R^V^O)+N[8]+2272392833&4294967295)<<11&4294967295|C>>>21))+((C=O+(F^R^V)+N[11]+1839030562&4294967295)<<16&4294967295|C>>>16))+((C=V+(O^F^R)+N[14]+4259657740&4294967295)<<23&4294967295|C>>>9))+((C=R+(V^O^F)+N[1]+2763975236&4294967295)<<4&4294967295|C>>>28))+((C=F+(R^V^O)+N[4]+1272893353&4294967295)<<11&4294967295|C>>>21))+((C=O+(F^R^V)+N[7]+4139469664&4294967295)<<16&4294967295|C>>>16))+((C=V+(O^F^R)+N[10]+3200236656&4294967295)<<23&4294967295|C>>>9))+((C=R+(V^O^F)+N[13]+681279174&4294967295)<<4&4294967295|C>>>28))+((C=F+(R^V^O)+N[0]+3936430074&4294967295)<<11&4294967295|C>>>21))+((C=O+(F^R^V)+N[3]+3572445317&4294967295)<<16&4294967295|C>>>16))+((C=V+(O^F^R)+N[6]+76029189&4294967295)<<23&4294967295|C>>>9))+((C=R+(V^O^F)+N[9]+3654602809&4294967295)<<4&4294967295|C>>>28))+((C=F+(R^V^O)+N[12]+3873151461&4294967295)<<11&4294967295|C>>>21))+((C=O+(F^R^V)+N[15]+530742520&4294967295)<<16&4294967295|C>>>16))+((C=V+(O^F^R)+N[2]+3299628645&4294967295)<<23&4294967295|C>>>9))+((C=R+(O^(V|~F))+N[0]+4096336452&4294967295)<<6&4294967295|C>>>26))+((C=F+(V^(R|~O))+N[7]+1126891415&4294967295)<<10&4294967295|C>>>22))+((C=O+(R^(F|~V))+N[14]+2878612391&4294967295)<<15&4294967295|C>>>17))+((C=V+(F^(O|~R))+N[5]+4237533241&4294967295)<<21&4294967295|C>>>11))+((C=R+(O^(V|~F))+N[12]+1700485571&4294967295)<<6&4294967295|C>>>26))+((C=F+(V^(R|~O))+N[3]+2399980690&4294967295)<<10&4294967295|C>>>22))+((C=O+(R^(F|~V))+N[10]+4293915773&4294967295)<<15&4294967295|C>>>17))+((C=V+(F^(O|~R))+N[1]+2240044497&4294967295)<<21&4294967295|C>>>11))+((C=R+(O^(V|~F))+N[8]+1873313359&4294967295)<<6&4294967295|C>>>26))+((C=F+(V^(R|~O))+N[15]+4264355552&4294967295)<<10&4294967295|C>>>22))+((C=O+(R^(F|~V))+N[6]+2734768916&4294967295)<<15&4294967295|C>>>17))+((C=V+(F^(O|~R))+N[13]+1309151649&4294967295)<<21&4294967295|C>>>11))+((F=(R=V+((C=R+(O^(V|~F))+N[4]+4149444226&4294967295)<<6&4294967295|C>>>26))+((C=F+(V^(R|~O))+N[11]+3174756917&4294967295)<<10&4294967295|C>>>22))^((O=F+((C=O+(R^(F|~V))+N[2]+718787259&4294967295)<<15&4294967295|C>>>17))|~R))+N[9]+3951481745&4294967295,D.g[0]=D.g[0]+R&4294967295,D.g[1]=D.g[1]+(O+(C<<21&4294967295|C>>>11))&4294967295,D.g[2]=D.g[2]+O&4294967295,D.g[3]=D.g[3]+F&4294967295}function l(D,R){this.h=R;for(var V=[],N=!0,O=D.length-1;0<=O;O--){var F=0|D[O];N&&F==R||(V[O]=F,N=!1)}this.g=V}(function e(D,R){function V(){}V.prototype=R.prototype,D.D=R.prototype,D.prototype=new V,D.prototype.constructor=D,D.C=function(N,O,F){for(var C=Array(arguments.length-2),Dr=2;Dr<arguments.length;Dr++)C[Dr-2]=arguments[Dr];return R.prototype[O].apply(N,C)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(D,R){void 0===R&&(R=D.length);for(var V=R-this.blockSize,N=this.B,O=this.h,F=0;F<R;){if(0==O)for(;F<=V;)i(this,D,F),F+=this.blockSize;if("string"==typeof D){for(;F<R;)if(N[O++]=D.charCodeAt(F++),O==this.blockSize){i(this,N),O=0;break}}else for(;F<R;)if(N[O++]=D[F++],O==this.blockSize){i(this,N),O=0;break}}this.h=O,this.o+=R},n.prototype.v=function(){var D=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);D[0]=128;for(var R=1;R<D.length-8;++R)D[R]=0;var V=8*this.o;for(R=D.length-8;R<D.length;++R)D[R]=255&V,V/=256;for(this.u(D),D=Array(16),R=V=0;4>R;++R)for(var N=0;32>N;N+=8)D[V++]=this.g[R]>>>N&255;return D};var h={};function f(D){return-128<=D&&128>D?function s(D,R){var V=h;return Object.prototype.hasOwnProperty.call(V,D)?V[D]:V[D]=R(D)}(D,function(R){return new l([0|R],0>R?-1:0)}):new l([0|D],0>D?-1:0)}function m(D){if(isNaN(D)||!isFinite(D))return T;if(0>D)return G(m(-D));for(var R=[],V=1,N=0;D>=V;N++)R[N]=D/V|0,V*=4294967296;return new l(R,0)}var T=f(0),P=f(1),k=f(16777216);function z(D){if(0!=D.h)return!1;for(var R=0;R<D.g.length;R++)if(0!=D.g[R])return!1;return!0}function $(D){return-1==D.h}function G(D){for(var R=D.g.length,V=[],N=0;N<R;N++)V[N]=~D.g[N];return new l(V,~D.h).add(P)}function Z(D,R){return D.add(G(R))}function oe(D,R){for(;(65535&D[R])!=D[R];)D[R+1]+=D[R]>>>16,D[R]&=65535,R++}function ae(D,R){this.g=D,this.h=R}function ie(D,R){if(z(R))throw Error("division by zero");if(z(D))return new ae(T,T);if($(D))return R=ie(G(D),R),new ae(G(R.g),G(R.h));if($(R))return R=ie(D,G(R)),new ae(G(R.g),R.h);if(30<D.g.length){if($(D)||$(R))throw Error("slowDivide_ only works with positive integers.");for(var V=P,N=R;0>=N.l(D);)V=pe(V),N=pe(N);var O=ce(V,1),F=ce(N,1);for(N=ce(N,2),V=ce(V,2);!z(N);){var C=F.add(N);0>=C.l(D)&&(O=O.add(V),F=C),N=ce(N,1),V=ce(V,1)}return R=Z(D,O.j(R)),new ae(O,R)}for(O=T;0<=D.l(R);){for(V=Math.max(1,Math.floor(D.m()/R.m())),N=48>=(N=Math.ceil(Math.log(V)/Math.LN2))?1:Math.pow(2,N-48),C=(F=m(V)).j(R);$(C)||0<C.l(D);)C=(F=m(V-=N)).j(R);z(F)&&(F=P),O=O.add(F),D=Z(D,C)}return new ae(O,D)}function pe(D){for(var R=D.g.length+1,V=[],N=0;N<R;N++)V[N]=D.i(N)<<1|D.i(N-1)>>>31;return new l(V,D.h)}function ce(D,R){var V=R>>5;R%=32;for(var N=D.g.length-V,O=[],F=0;F<N;F++)O[F]=0<R?D.i(F+V)>>>R|D.i(F+V+1)<<32-R:D.i(F+V);return new l(O,D.h)}(r=l.prototype).m=function(){if($(this))return-G(this).m();for(var D=0,R=1,V=0;V<this.g.length;V++){var N=this.i(V);D+=(0<=N?N:4294967296+N)*R,R*=4294967296}return D},r.toString=function(D){if(2>(D=D||10)||36<D)throw Error("radix out of range: "+D);if(z(this))return"0";if($(this))return"-"+G(this).toString(D);for(var R=m(Math.pow(D,6)),V=this,N="";;){var O=ie(V,R).g,F=((0<(V=Z(V,O.j(R))).g.length?V.g[0]:V.h)>>>0).toString(D);if(z(V=O))return F+N;for(;6>F.length;)F="0"+F;N=F+N}},r.i=function(D){return 0>D?0:D<this.g.length?this.g[D]:this.h},r.l=function(D){return $(D=Z(this,D))?-1:z(D)?0:1},r.abs=function(){return $(this)?G(this):this},r.add=function(D){for(var R=Math.max(this.g.length,D.g.length),V=[],N=0,O=0;O<=R;O++){var F=N+(65535&this.i(O))+(65535&D.i(O)),C=(F>>>16)+(this.i(O)>>>16)+(D.i(O)>>>16);N=C>>>16,V[O]=(C&=65535)<<16|(F&=65535)}return new l(V,-2147483648&V[V.length-1]?-1:0)},r.j=function(D){if(z(this)||z(D))return T;if($(this))return $(D)?G(this).j(G(D)):G(G(this).j(D));if($(D))return G(this.j(G(D)));if(0>this.l(k)&&0>D.l(k))return m(this.m()*D.m());for(var R=this.g.length+D.g.length,V=[],N=0;N<2*R;N++)V[N]=0;for(N=0;N<this.g.length;N++)for(var O=0;O<D.g.length;O++){var F=this.i(N)>>>16,C=65535&this.i(N),Dr=D.i(O)>>>16,Eu=65535&D.i(O);V[2*N+2*O]+=C*Eu,oe(V,2*N+2*O),V[2*N+2*O+1]+=F*Eu,oe(V,2*N+2*O+1),V[2*N+2*O+1]+=C*Dr,oe(V,2*N+2*O+1),V[2*N+2*O+2]+=F*Dr,oe(V,2*N+2*O+2)}for(N=0;N<R;N++)V[N]=V[2*N+1]<<16|V[2*N];for(N=R;N<2*R;N++)V[N]=0;return new l(V,0)},r.A=function(D){return ie(this,D).h},r.and=function(D){for(var R=Math.max(this.g.length,D.g.length),V=[],N=0;N<R;N++)V[N]=this.i(N)&D.i(N);return new l(V,this.h&D.h)},r.or=function(D){for(var R=Math.max(this.g.length,D.g.length),V=[],N=0;N<R;N++)V[N]=this.i(N)|D.i(N);return new l(V,this.h|D.h)},r.xor=function(D){for(var R=Math.max(this.g.length,D.g.length),V=[],N=0;N<R;N++)V[N]=this.i(N)^D.i(N);return new l(V,this.h^D.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ci=ht.Md5=n,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.A,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=m,l.fromString=function I(D,R){if(0==D.length)throw Error("number format error: empty string");if(2>(R=R||10)||36<R)throw Error("radix out of range: "+R);if("-"==D.charAt(0))return G(I(D.substring(1),R));if(0<=D.indexOf("-"))throw Error('number format error: interior "-" character');for(var V=m(Math.pow(R,8)),N=T,O=0;O<D.length;O+=8){var F=Math.min(8,D.length-O),C=parseInt(D.substring(O,O+F),R);8>F?(F=m(Math.pow(R,F)),N=N.j(F).add(m(C))):N=(N=N.j(V)).add(m(C))}return N},It=ht.Integer=l}).apply(typeof zr<"u"?zr:typeof self<"u"?self:typeof window<"u"?window:{});var Fn,Vi,un,Un,zt,Wr,Kr,Gr,or,Ln=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Nt={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(u,p,g){return u==Array.prototype||u==Object.prototype||(u[p]=g.value),u},n=function t(u){u=["object"==typeof globalThis&&globalThis,u,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ln&&Ln];for(var p=0;p<u.length;++p){var g=u[p];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}(this);!function i(u,p){if(p)e:{var g=n;u=u.split(".");for(var E=0;E<u.length-1;E++){var L=u[E];if(!(L in g))break e;g=g[L]}(p=p(E=g[u=u[u.length-1]]))!=E&&null!=p&&e(g,u,{configurable:!0,writable:!0,value:p})}}("Array.prototype.values",function(u){return u||function(){return function s(u,p){u instanceof String&&(u+="");var g=0,E=!1,L={next:function(){if(!E&&g<u.length){var q=g++;return{value:p(q,u[q]),done:!1}}return E=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}(this,function(p,g){return g})}});var l=l||{},h=this||self;function f(u){var p=typeof u;return"array"==(p="object"!=p?p:u?Array.isArray(u)?"array":p:"null")||"object"==p&&"number"==typeof u.length}function m(u){var p=typeof u;return"object"==p&&null!=u||"function"==p}function I(u,p,g){return u.call.apply(u.bind,arguments)}function T(u,p,g){if(!u)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,E),u.apply(p,L)}}return function(){return u.apply(p,arguments)}}function P(u,p,g){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?I:T).apply(null,arguments)}function k(u,p){var g=Array.prototype.slice.call(arguments,1);return function(){var E=g.slice();return E.push.apply(E,arguments),u.apply(this,E)}}function z(u,p){function g(){}g.prototype=p.prototype,u.aa=p.prototype,u.prototype=new g,u.prototype.constructor=u,u.Qb=function(E,L,q){for(var X=Array(arguments.length-2),ze=2;ze<arguments.length;ze++)X[ze-2]=arguments[ze];return p.prototype[L].apply(E,X)}}function $(u){const p=u.length;if(0<p){const g=Array(p);for(let E=0;E<p;E++)g[E]=u[E];return g}return[]}function G(u,p){for(let g=1;g<arguments.length;g++){const E=arguments[g];if(f(E)){const L=u.length||0,q=E.length||0;u.length=L+q;for(let X=0;X<q;X++)u[L+X]=E[X]}else u.push(E)}}function oe(u){return/^[\s\xa0]*$/.test(u)}function ae(){var u=h.navigator;return u&&(u=u.userAgent)?u:""}function ie(u){return ie[" "](u),u}ie[" "]=function(){};var pe=!(-1==ae().indexOf("Gecko")||-1!=ae().toLowerCase().indexOf("webkit")&&-1==ae().indexOf("Edge")||-1!=ae().indexOf("Trident")||-1!=ae().indexOf("MSIE")||-1!=ae().indexOf("Edge"));function ce(u,p,g){for(const E in u)p.call(g,u[E],E,u)}function R(u){const p={};for(const g in u)p[g]=u[g];return p}const V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(u,p){let g,E;for(let L=1;L<arguments.length;L++){for(g in E=arguments[L],E)u[g]=E[g];for(let q=0;q<V.length;q++)g=V[q],Object.prototype.hasOwnProperty.call(E,g)&&(u[g]=E[g])}}function O(u){var p=1;u=u.split(":");const g=[];for(;0<p&&u.length;)g.push(u.shift()),p--;return u.length&&g.push(u.join(":")),g}function F(u){h.setTimeout(()=>{throw u},0)}function C(){var u=mf;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}var Eu=new class Z{constructor(p,g){this.i=p,this.j=g,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}(()=>new RI,u=>u.reset());class RI{constructor(){this.next=this.g=this.h=null}set(p,g){this.h=p,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Tu,Au=!1,mf=new class Dr{constructor(){this.h=this.g=null}add(p,g){const E=Eu.get();E.set(p,g),this.h?this.h.next=E:this.g=E,this.h=E}},Vm=()=>{const u=h.Promise.resolve(void 0);Tu=()=>{u.then(PI)}};var PI=()=>{for(var u;u=C();){try{u.h.call(u.g)}catch(g){F(g)}var p=Eu;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Au=!1};function Ti(){this.s=this.s,this.C=this.C}function bt(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Ti.prototype.s=!1,Ti.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ti.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},bt.prototype.h=function(){this.defaultPrevented=!0};var SI=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};h.addEventListener("test",g,p),h.removeEventListener("test",g,p)}catch{}return u}();function wu(u,p){if(bt.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var g=this.type=u.type,E=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(pe){e:{try{ie(p.nodeName);var L=!0;break e}catch{}L=!1}L||(p=null)}}else"mouseover"==g?p=u.fromElement:"mouseout"==g&&(p=u.toElement);this.relatedTarget=p,E?(this.clientX=void 0!==E.clientX?E.clientX:E.pageX,this.clientY=void 0!==E.clientY?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=void 0!==u.clientX?u.clientX:u.pageX,this.clientY=void 0!==u.clientY?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType="string"==typeof u.pointerType?u.pointerType:bI[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&wu.aa.h.call(this)}}z(wu,bt);var bI={2:"touch",3:"pen",4:"mouse"};wu.prototype.h=function(){wu.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Ru="closure_listenable_"+(1e6*Math.random()|0),CI=0;function VI(u,p,g,E,L){this.listener=u,this.proxy=null,this.src=p,this.type=g,this.capture=!!E,this.ha=L,this.key=++CI,this.da=this.fa=!1}function Ac(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function wc(u){this.src=u,this.g={},this.h=0}function _f(u,p){var g=p.type;if(g in u.g){var q,E=u.g[g],L=Array.prototype.indexOf.call(E,p,void 0);(q=0<=L)&&Array.prototype.splice.call(E,L,1),q&&(Ac(p),0==u.g[g].length&&(delete u.g[g],u.h--))}}function gf(u,p,g,E){for(var L=0;L<u.length;++L){var q=u[L];if(!q.da&&q.listener==p&&q.capture==!!g&&q.ha==E)return L}return-1}wc.prototype.add=function(u,p,g,E,L){var q=u.toString();(u=this.g[q])||(u=this.g[q]=[],this.h++);var X=gf(u,p,E,L);return-1<X?(p=u[X],g||(p.fa=!1)):((p=new VI(p,this.src,q,!!E,L)).fa=g,u.push(p)),p};var yf="closure_lm_"+(1e6*Math.random()|0),If={};function xm(u,p,g,E,L){if(E&&E.once)return Nm(u,p,g,E,L);if(Array.isArray(p)){for(var q=0;q<p.length;q++)xm(u,p[q],g,E,L);return null}return g=Af(g),u&&u[Ru]?u.K(p,g,m(E)?!!E.capture:!!E,L):Dm(u,p,g,!1,E,L)}function Dm(u,p,g,E,L,q){if(!p)throw Error("Invalid event type");var X=m(L)?!!L.capture:!!L,ze=Ef(u);if(ze||(u[yf]=ze=new wc(u)),(g=ze.add(p,g,E,X,q)).proxy)return g;if(E=function xI(){const p=DI;return function u(g){return p.call(u.src,u.listener,g)}}(),g.proxy=E,E.src=u,E.listener=g,u.addEventListener)SI||(L=X),void 0===L&&(L=!1),u.addEventListener(p.toString(),E,L);else if(u.attachEvent)u.attachEvent(Om(p.toString()),E);else{if(!u.addListener||!u.removeListener)throw Error("addEventListener and attachEvent are unavailable.");u.addListener(E)}return g}function Nm(u,p,g,E,L){if(Array.isArray(p)){for(var q=0;q<p.length;q++)Nm(u,p[q],g,E,L);return null}return g=Af(g),u&&u[Ru]?u.L(p,g,m(E)?!!E.capture:!!E,L):Dm(u,p,g,!0,E,L)}function km(u,p,g,E,L){if(Array.isArray(p))for(var q=0;q<p.length;q++)km(u,p[q],g,E,L);else E=m(E)?!!E.capture:!!E,g=Af(g),u&&u[Ru]?(u=u.i,(p=String(p).toString())in u.g&&-1<(g=gf(q=u.g[p],g,E,L))&&(Ac(q[g]),Array.prototype.splice.call(q,g,1),0==q.length&&(delete u.g[p],u.h--))):u&&(u=Ef(u))&&(p=u.g[p.toString()],u=-1,p&&(u=gf(p,g,E,L)),(g=-1<u?p[u]:null)&&vf(g))}function vf(u){if("number"!=typeof u&&u&&!u.da){var p=u.src;if(p&&p[Ru])_f(p.i,u);else{var g=u.type,E=u.proxy;p.removeEventListener?p.removeEventListener(g,E,u.capture):p.detachEvent?p.detachEvent(Om(g),E):p.addListener&&p.removeListener&&p.removeListener(E),(g=Ef(p))?(_f(g,u),0==g.h&&(g.src=null,p[yf]=null)):Ac(u)}}}function Om(u){return u in If?If[u]:If[u]="on"+u}function DI(u,p){if(u.da)u=!0;else{p=new wu(p,this);var g=u.listener,E=u.ha||u.src;u.fa&&vf(u),u=g.call(E,p)}return u}function Ef(u){return(u=u[yf])instanceof wc?u:null}var Tf="__closure_events_fn_"+(1e9*Math.random()>>>0);function Af(u){return"function"==typeof u?u:(u[Tf]||(u[Tf]=function(p){return u.handleEvent(p)}),u[Tf])}function Ct(){Ti.call(this),this.i=new wc(this),this.M=this,this.F=null}function Ft(u,p){var g,E=u.F;if(E)for(g=[];E;E=E.F)g.push(E);if(u=u.M,E=p.type||p,"string"==typeof p)p=new bt(p,u);else if(p instanceof bt)p.target=p.target||u;else{var L=p;N(p=new bt(E,u),L)}if(L=!0,g)for(var q=g.length-1;0<=q;q--){var X=p.g=g[q];L=Rc(X,E,!0,p)&&L}if(L=Rc(X=p.g=u,E,!0,p)&&L,L=Rc(X,E,!1,p)&&L,g)for(q=0;q<g.length;q++)L=Rc(X=p.g=g[q],E,!1,p)&&L}function Rc(u,p,g,E){if(!(p=u.i.g[String(p)]))return!0;p=p.concat();for(var L=!0,q=0;q<p.length;++q){var X=p[q];if(X&&!X.da&&X.capture==g){var ze=X.listener,Et=X.ha||X.src;X.fa&&_f(u.i,X),L=!1!==ze.call(Et,E)&&L}}return L&&!E.defaultPrevented}function Mm(u,p,g){if("function"==typeof u)g&&(u=P(u,g));else{if(!u||"function"!=typeof u.handleEvent)throw Error("Invalid listener argument");u=P(u.handleEvent,u)}return 2147483647<Number(p)?-1:h.setTimeout(u,p||0)}function Lm(u){u.g=Mm(()=>{u.g=null,u.i&&(u.i=!1,Lm(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}z(Ct,Ti),Ct.prototype[Ru]=!0,Ct.prototype.removeEventListener=function(u,p,g,E){km(this,u,p,g,E)},Ct.prototype.N=function(){if(Ct.aa.N.call(this),this.i){var p,u=this.i;for(p in u.g){for(var g=u.g[p],E=0;E<g.length;E++)Ac(g[E]);delete u.g[p],u.h--}}this.F=null},Ct.prototype.K=function(u,p,g,E){return this.i.add(String(u),p,!1,g,E)},Ct.prototype.L=function(u,p,g,E){return this.i.add(String(u),p,!0,g,E)};class NI extends Ti{constructor(p,g){super(),this.m=p,this.l=g,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Lm(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pu(u){Ti.call(this),this.h=u,this.g={}}z(Pu,Ti);var Fm=[];function Um(u){ce(u.g,function(p,g){this.g.hasOwnProperty(g)&&vf(p)},u),u.g={}}Pu.prototype.N=function(){Pu.aa.N.call(this),Um(this)},Pu.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wf=h.JSON.stringify,kI=h.JSON.parse,OI=class{stringify(u){return h.JSON.stringify(u,void 0)}parse(u){return h.JSON.parse(u,void 0)}};function Rf(){}function qm(){}Rf.prototype.h=null;var Su={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Pf(){bt.call(this,"d")}function Sf(){bt.call(this,"c")}z(Pf,bt),z(Sf,bt);var ms={},zm=null;function Pc(){return zm=zm||new Ct}function Wm(u){bt.call(this,ms.La,u)}function bu(u){const p=Pc();Ft(p,new Wm(p))}function Km(u,p){bt.call(this,ms.STAT_EVENT,u),this.stat=p}function Ut(u){const p=Pc();Ft(p,new Km(p,u))}function Gm(u,p){bt.call(this,ms.Ma,u),this.size=p}function Cu(u,p){if("function"!=typeof u)throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){u()},p)}function Vu(){this.g=!0}function Xo(u,p,g,E){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+function UI(u,p){if(!u.g)return p;if(!p)return null;try{var g=JSON.parse(p);if(g)for(u=0;u<g.length;u++)if(Array.isArray(g[u])){var E=g[u];if(!(2>E.length)){var L=E[1];if(Array.isArray(L)&&!(1>L.length)){var q=L[0];if("noop"!=q&&"stop"!=q&&"close"!=q)for(var X=1;X<L.length;X++)L[X]=""}}}return wf(g)}catch{return p}}(u,g)+(E?" "+E:"")})}ms.La="serverreachability",z(Wm,bt),ms.STAT_EVENT="statevent",z(Km,bt),ms.Ma="timingevent",z(Gm,bt),Vu.prototype.xa=function(){this.g=!1},Vu.prototype.info=function(){};var bf,Sc={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},jm={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function bc(){}function Ai(u,p,g,E){this.j=u,this.i=p,this.l=g,this.R=E||1,this.U=new Pu(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new $m}function $m(){this.i=null,this.g="",this.h=!1}z(bc,Rf),bc.prototype.g=function(){return new XMLHttpRequest},bc.prototype.i=function(){return{}},bf=new bc;var Qm={},Cf={};function Vf(u,p,g){u.L=1,u.v=Dc(Nr(p)),u.m=g,u.P=!0,Hm(u,null)}function Hm(u,p){u.F=Date.now(),Cc(u),u.A=Nr(u.v);var g=u.A,E=u.R;Array.isArray(E)||(E=[String(E)]),l_(g.i,"t",E),u.C=0,g=u.j.J,u.h=new $m,u.g=S_(u.j,g?p:null,!u.m),0<u.O&&(u.M=new NI(P(u.Y,u,u.g),u.O)),p=u.U,g=u.g,E=u.ca;var L="readystatechange";Array.isArray(L)||(L&&(Fm[0]=L.toString()),L=Fm);for(var q=0;q<L.length;q++){var X=xm(g,L[q],E||p.handleEvent,!1,p.h||p);if(!X)break;p.g[X.key]=X}p=u.H?R(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),bu(),function MI(u,p,g,E,L,q){u.info(function(){if(u.g)if(q)for(var X="",ze=q.split("&"),Et=0;Et<ze.length;Et++){var Ve=ze[Et].split("=");if(1<Ve.length){var Vt=Ve[0];Ve=Ve[1];var xt=Vt.split("_");X=2<=xt.length&&"type"==xt[1]?X+(Vt+"=")+Ve+"&":X+(Vt+"=redacted&")}}else X=null;else X=q;return"XMLHTTP REQ ("+E+") [attempt "+L+"]: "+p+"\n"+g+"\n"+X})}(u.i,u.u,u.A,u.l,u.R,u.m)}function Jm(u){return!!u.g&&"GET"==u.u&&2!=u.L&&u.j.Ca}function BI(u,p){var g=u.C,E=p.indexOf("\n",g);return-1==E?Cf:(g=Number(p.substring(g,E)),isNaN(g)?Qm:(E+=1)+g>p.length?Cf:(p=p.slice(E,E+g),u.C=E+g,p))}function Cc(u){u.S=Date.now()+u.I,Ym(u,u.I)}function Ym(u,p){if(null!=u.B)throw Error("WatchDog timer not null");u.B=Cu(P(u.ba,u),p)}function xf(u){u.B&&(h.clearTimeout(u.B),u.B=null)}function xu(u){0==u.j.G||u.J||A_(u.j,u)}function _s(u){xf(u);var p=u.M;p&&"function"==typeof p.ma&&p.ma(),u.M=null,Um(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Df(u,p){try{var g=u.j;if(0!=g.G&&(g.g==u||Nf(g.h,u)))if(!u.K&&Nf(g.h,u)&&3==g.G){try{var E=g.Da.g.parse(p)}catch{E=null}if(Array.isArray(E)&&3==E.length){var L=E;if(0==L[0]){e:if(!g.u){if(g.g){if(!(g.g.F+3e3<u.F))break e;Lc(g),Oc(g)}Lf(g),Ut(18)}}else g.za=L[1],0<g.za-g.T&&37500>L[2]&&g.F&&0==g.v&&!g.C&&(g.C=Cu(P(g.Za,g),6e3));if(1>=e_(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else ys(g,11)}else if((u.K||g.g==u)&&Lc(g),!oe(p))for(L=g.Da.g.parse(p),p=0;p<L.length;p++){let Ve=L[p];if(g.T=Ve[0],Ve=Ve[1],2==g.G)if("c"==Ve[0]){g.K=Ve[1],g.ia=Ve[2];const Vt=Ve[3];null!=Vt&&(g.la=Vt,g.j.info("VER="+g.la));const xt=Ve[4];null!=xt&&(g.Aa=xt,g.j.info("SVER="+g.Aa));const ta=Ve[5];null!=ta&&"number"==typeof ta&&0<ta&&(g.L=E=1.5*ta,g.j.info("backChannelRequestTimeoutMs_="+E)),E=g;const xn=u.g;if(xn){const Uc=xn.g?xn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Uc){var q=E.h;q.g||-1==Uc.indexOf("spdy")&&-1==Uc.indexOf("quic")&&-1==Uc.indexOf("h2")||(q.j=q.l,q.g=new Set,q.h&&(kf(q,q.h),q.h=null))}if(E.D){const Uf=xn.g?xn.g.getResponseHeader("X-HTTP-Session-Id"):null;Uf&&(E.ya=Uf,He(E.I,E.D,Uf))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-u.F,g.j.info("Handshake RTT: "+g.R+"ms"));var X=u;if((E=g).qa=P_(E,E.J?E.ia:null,E.W),X.K){t_(E.h,X);var ze=X,Et=E.L;Et&&(ze.I=Et),ze.B&&(xf(ze),Cc(ze)),E.g=X}else E_(E);0<g.i.length&&Mc(g)}else"stop"!=Ve[0]&&"close"!=Ve[0]||ys(g,7);else 3==g.G&&("stop"==Ve[0]||"close"==Ve[0]?"stop"==Ve[0]?ys(g,7):Mf(g):"noop"!=Ve[0]&&g.l&&g.l.ta(Ve),g.v=0)}bu()}catch{}}Ai.prototype.ca=function(u){u=u.target;const p=this.M;p&&3==kr(u)?p.j():this.Y(u)},Ai.prototype.Y=function(u){try{if(u==this.g)e:{const xt=kr(this.g);var p=this.g.Ba();if(this.g.Z(),!(3>xt)&&(3!=xt||this.g&&(this.h.h||this.g.oa()||__(this.g)))){this.J||4!=xt||7==p||bu(),xf(this);var g=this.g.Z();this.X=g;t:if(Jm(this)){var E=__(this.g);u="";var L=E.length,q=4==kr(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){_s(this),xu(this);var X="";break t}this.h.i=new h.TextDecoder}for(p=0;p<L;p++)this.h.h=!0,u+=this.h.i.decode(E[p],{stream:!(q&&p==L-1)});E.length=0,this.h.g+=u,this.C=0,X=this.h.g}else X=this.g.oa();if(this.o=200==g,function LI(u,p,g,E,L,q,X){u.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+L+"]: "+p+"\n"+g+"\n"+q+" "+X})}(this.i,this.u,this.A,this.l,this.R,xt,g),this.o){if(this.T&&!this.K){t:{if(this.g){var ze,Et=this.g;if((ze=Et.g?Et.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!oe(ze)){var Ve=ze;break t}}Ve=null}if(!(g=Ve)){this.o=!1,this.s=3,Ut(12),_s(this),xu(this);break e}Xo(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Df(this,g)}if(this.P){let xn;for(g=!0;!this.J&&this.C<X.length;){if(xn=BI(this,X),xn==Cf){4==xt&&(this.s=4,Ut(14),g=!1),Xo(this.i,this.l,null,"[Incomplete Response]");break}if(xn==Qm){this.s=4,Ut(15),Xo(this.i,this.l,X,"[Invalid Chunk]"),g=!1;break}Xo(this.i,this.l,xn,null),Df(this,xn)}if(Jm(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=xt||0!=X.length||this.h.h||(this.s=1,Ut(16),g=!1),this.o=this.o&&g,g){if(0<X.length&&!this.W){this.W=!0;var Vt=this.j;Vt.g==this&&Vt.ba&&!Vt.M&&(Vt.j.info("Great, no buffering proxy detected. Bytes received: "+X.length),Ff(Vt),Vt.M=!0,Ut(11))}}else Xo(this.i,this.l,X,"[Invalid Chunked Response]"),_s(this),xu(this)}else Xo(this.i,this.l,X,null),Df(this,X);4==xt&&_s(this),this.o&&!this.J&&(4==xt?A_(this.j,this):(this.o=!1,Cc(this)))}else(function rv(u){const p={};u=(u.g&&2<=kr(u)&&u.g.getAllResponseHeaders()||"").split("\r\n");for(let E=0;E<u.length;E++){if(oe(u[E]))continue;var g=O(u[E]);const L=g[0];if("string"!=typeof(g=g[1]))continue;g=g.trim();const q=p[L]||[];p[L]=q,q.push(g)}!function D(u,p){for(const g in u)p.call(void 0,u[g],g,u)}(p,function(E){return E.join(", ")})})(this.g),400==g&&0<X.indexOf("Unknown SID")?(this.s=3,Ut(12)):(this.s=0,Ut(13)),_s(this),xu(this)}}}catch{}},Ai.prototype.cancel=function(){this.J=!0,_s(this)},Ai.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(function FI(u,p){u.info(function(){return"TIMEOUT: "+p})}(this.i,this.A),2!=this.L&&(bu(),Ut(17)),_s(this),this.s=2,xu(this)):Ym(this,this.S-u)};var qI=class{constructor(u,p){this.g=u,this.map=p}};function Xm(u){this.l=u||10,u=h.PerformanceNavigationTiming?0<(u=h.performance.getEntriesByType("navigation")).length&&("hq"==u[0].nextHopProtocol||"h2"==u[0].nextHopProtocol):!!(h.chrome&&h.chrome.loadTimes&&h.chrome.loadTimes()&&h.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Zm(u){return!!u.h||!!u.g&&u.g.size>=u.j}function e_(u){return u.h?1:u.g?u.g.size:0}function Nf(u,p){return u.h?u.h==p:!!u.g&&u.g.has(p)}function kf(u,p){u.g?u.g.add(p):u.h=p}function t_(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}function n_(u){if(null!=u.h)return u.i.concat(u.h.D);if(null!=u.g&&0!==u.g.size){let p=u.i;for(const g of u.g.values())p=p.concat(g.D);return p}return $(u.i)}function r_(u,p){if(u.forEach&&"function"==typeof u.forEach)u.forEach(p,void 0);else if(f(u)||"string"==typeof u)Array.prototype.forEach.call(u,p,void 0);else for(var g=function WI(u){if(u.na&&"function"==typeof u.na)return u.na();if(!u.V||"function"!=typeof u.V){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(f(u)||"string"==typeof u){var p=[];u=u.length;for(var g=0;g<u;g++)p.push(g);return p}p=[],g=0;for(const E in u)p[g++]=E;return p}}}(u),E=function zI(u){if(u.V&&"function"==typeof u.V)return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if("string"==typeof u)return u.split("");if(f(u)){for(var p=[],g=u.length,E=0;E<g;E++)p.push(u[E]);return p}for(E in p=[],g=0,u)p[g++]=u[E];return p}(u),L=E.length,q=0;q<L;q++)p.call(void 0,E[q],g&&g[q],u)}Xm.prototype.cancel=function(){if(this.i=n_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const u of this.g.values())u.cancel();this.g.clear()}};var i_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gs(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof gs){this.h=u.h,Vc(this,u.j),this.o=u.o,this.g=u.g,xc(this,u.s),this.l=u.l;var p=u.i,g=new ku;g.i=p.i,p.g&&(g.g=new Map(p.g),g.h=p.h),s_(this,g),this.m=u.m}else u&&(p=String(u).match(i_))?(this.h=!1,Vc(this,p[1]||"",!0),this.o=Du(p[2]||""),this.g=Du(p[3]||"",!0),xc(this,p[4]),this.l=Du(p[5]||"",!0),s_(this,p[6]||"",!0),this.m=Du(p[7]||"")):(this.h=!1,this.i=new ku(null,this.h))}function Nr(u){return new gs(u)}function Vc(u,p,g){u.j=g?Du(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function xc(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function s_(u,p,g){p instanceof ku?(u.i=p,function JI(u,p){p&&!u.j&&(wi(u),u.i=null,u.g.forEach(function(g,E){var L=E.toLowerCase();E!=L&&(a_(this,E),l_(this,L,g))},u)),u.j=p}(u.i,u.h)):(g||(p=Nu(p,QI)),u.i=new ku(p,u.h))}function He(u,p,g){u.i.set(p,g)}function Dc(u){return He(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Du(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Nu(u,p,g){return"string"==typeof u?(u=encodeURI(u).replace(p,GI),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function GI(u){return"%"+((u=u.charCodeAt(0))>>4&15).toString(16)+(15&u).toString(16)}gs.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Nu(p,o_,!0),":");var g=this.g;return(g||"file"==p)&&(u.push("//"),(p=this.o)&&u.push(Nu(p,o_,!0),"@"),u.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(g=this.s)&&u.push(":",String(g))),(g=this.l)&&(this.g&&"/"!=g.charAt(0)&&u.push("/"),u.push(Nu(g,"/"==g.charAt(0)?$I:jI,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",Nu(g,HI)),u.join("")};var o_=/[#\/\?@]/g,jI=/[#\?:]/g,$I=/[#\?]/g,QI=/[#\?@]/g,HI=/#/g;function ku(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function wi(u){u.g||(u.g=new Map,u.h=0,u.i&&function KI(u,p){if(u){u=u.split("&");for(var g=0;g<u.length;g++){var E=u[g].indexOf("="),L=null;if(0<=E){var q=u[g].substring(0,E);L=u[g].substring(E+1)}else q=u[g];p(q,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}(u.i,function(p,g){u.add(decodeURIComponent(p.replace(/\+/g," ")),g)}))}function a_(u,p){wi(u),p=Zo(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function u_(u,p){return wi(u),p=Zo(u,p),u.g.has(p)}function l_(u,p,g){a_(u,p),0<g.length&&(u.i=null,u.g.set(Zo(u,p),$(g)),u.h+=g.length)}function Zo(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Ri(u,p,g,E,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),E(g)}catch{}}function ZI(){this.g=new OI}function ev(u,p,g){const E=g||"";try{r_(u,function(L,q){let X=L;m(L)&&(X=wf(L)),p.push(E+q+"="+encodeURIComponent(X))})}catch(L){throw p.push(E+"type="+encodeURIComponent("_badmap")),L}}function Ou(u){this.l=u.Ub||null,this.j=u.eb||!1}function Nc(u,p){Ct.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function c_(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}function Mu(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Lu(u)}function Lu(u){u.onreadystatechange&&u.onreadystatechange.call(u)}function h_(u){let p="";return ce(u,function(g,E){p+=E,p+=":",p+=g,p+="\r\n"}),p}function Of(u,p,g){e:{for(E in g){var E=!1;break e}E=!0}E||(g=h_(g),"string"==typeof u?null!=g&&encodeURIComponent(String(g)):He(u,p,g))}function nt(u){Ct.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ku.prototype).add=function(u,p){wi(this),this.i=null,u=Zo(this,u);var g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(p),this.h+=1,this},r.forEach=function(u,p){wi(this),this.g.forEach(function(g,E){g.forEach(function(L){u.call(p,L,E,this)},this)},this)},r.na=function(){wi(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),g=[];for(let E=0;E<p.length;E++){const L=u[E];for(let q=0;q<L.length;q++)g.push(p[E])}return g},r.V=function(u){wi(this);let p=[];if("string"==typeof u)u_(this,u)&&(p=p.concat(this.g.get(Zo(this,u))));else{u=Array.from(this.g.values());for(let g=0;g<u.length;g++)p=p.concat(u[g])}return p},r.set=function(u,p){return wi(this),this.i=null,u_(this,u=Zo(this,u))&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},r.get=function(u,p){return u&&0<(u=this.V(u)).length?String(u[0]):p},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var g=0;g<p.length;g++){var E=p[g];const q=encodeURIComponent(String(E)),X=this.V(E);for(E=0;E<X.length;E++){var L=q;""!==X[E]&&(L+="="+encodeURIComponent(String(X[E]))),u.push(L)}}return this.i=u.join("&")},z(Ou,Rf),Ou.prototype.g=function(){return new Nc(this.l,this.j)},Ou.prototype.i=function(u){return function(){return u}}({}),z(Nc,Ct),(r=Nc.prototype).open=function(u,p){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Lu(this)},r.send=function(u){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||h).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mu(this)),this.readyState=0},r.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Lu(this)),this.g&&(this.readyState=3,Lu(this),this.g)))if("arraybuffer"===this.responseType)u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof h.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;c_(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Mu(this):Lu(this),3==this.readyState&&c_(this)}},r.Ra=function(u){this.g&&(this.response=this.responseText=u,Mu(this))},r.Qa=function(u){this.g&&(this.response=u,Mu(this))},r.ga=function(){this.g&&Mu(this)},r.setRequestHeader=function(u,p){this.u.append(u,p)},r.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var g=p.next();!g.done;)u.push((g=g.value)[0]+": "+g[1]),g=p.next();return u.join("\r\n")},Object.defineProperty(Nc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(u){this.m=u?"include":"same-origin"}}),z(nt,Ct);var tv=/^https?$/i,nv=["POST","PUT"];function d_(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,f_(u),kc(u)}function f_(u){u.A||(u.A=!0,Ft(u,"complete"),Ft(u,"error"))}function p_(u){if(u.h&&typeof l<"u"&&(!u.v[1]||4!=kr(u)||2!=u.Z()))if(u.u&&4==kr(u))Mm(u.Ea,0,u);else if(Ft(u,"readystatechange"),4==kr(u)){u.h=!1;try{const X=u.Z();e:switch(X){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var g;if(!(g=p)){var E;if(E=0===X){var L=String(u.D).match(i_)[1]||null;!L&&h.self&&h.self.location&&(L=h.self.location.protocol.slice(0,-1)),E=!tv.test(L?L.toLowerCase():"")}g=E}if(g)Ft(u,"complete"),Ft(u,"success");else{u.m=6;try{var q=2<kr(u)?u.g.statusText:""}catch{q=""}u.l=q+" ["+u.Z()+"]",f_(u)}}finally{kc(u)}}}function kc(u,p){if(u.g){m_(u);const g=u.g,E=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Ft(u,"ready");try{g.onreadystatechange=E}catch{}}}function m_(u){u.I&&(h.clearTimeout(u.I),u.I=null)}function kr(u){return u.g?u.g.readyState:0}function __(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Fu(u,p,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||p}function g_(u){this.Aa=0,this.i=[],this.j=new Vu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Fu("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Fu("baseRetryDelayMs",5e3,u),this.cb=Fu("retryDelaySeedMs",1e4,u),this.Wa=Fu("forwardChannelMaxRetries",2,u),this.wa=Fu("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Xm(u&&u.concurrentRequestLimit),this.Da=new ZI,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Mf(u){if(y_(u),3==u.G){var p=u.U++,g=Nr(u.I);if(He(g,"SID",u.K),He(g,"RID",p),He(g,"TYPE","terminate"),Uu(u,g),(p=new Ai(u,u.j,p)).L=2,p.v=Dc(Nr(g)),g=!1,h.navigator&&h.navigator.sendBeacon)try{g=h.navigator.sendBeacon(p.v.toString(),"")}catch{}!g&&h.Image&&((new Image).src=p.v,g=!0),g||(p.g=S_(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Cc(p)}R_(u)}function Oc(u){u.g&&(Ff(u),u.g.cancel(),u.g=null)}function y_(u){Oc(u),u.u&&(h.clearTimeout(u.u),u.u=null),Lc(u),u.h.cancel(),u.s&&("number"==typeof u.s&&h.clearTimeout(u.s),u.s=null)}function Mc(u){if(!Zm(u.h)&&!u.s){u.s=!0;var p=u.Ga;Tu||Vm(),Au||(Tu(),Au=!0),mf.add(p,u),u.B=0}}function I_(u,p){var g;g=p?p.l:u.U++;const E=Nr(u.I);He(E,"SID",u.K),He(E,"RID",g),He(E,"AID",u.T),Uu(u,E),u.m&&u.o&&Of(E,u.m,u.o),g=new Ai(u,u.j,g,u.B+1),null===u.m&&(g.H=u.o),p&&(u.i=p.D.concat(u.i)),p=v_(u,g,1e3),g.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),kf(u.h,g),Vf(g,E,p)}function Uu(u,p){u.H&&ce(u.H,function(g,E){He(p,E,g)}),u.l&&r_({},function(g,E){He(p,E,g)})}function v_(u,p,g){g=Math.min(u.i.length,g);var E=u.l?P(u.l.Na,u.l,u):null;e:{var L=u.i;let q=-1;for(;;){const X=["count="+g];-1==q?0<g?(q=L[0].g,X.push("ofs="+q)):q=0:X.push("ofs="+q);let ze=!0;for(let Et=0;Et<g;Et++){let Ve=L[Et].g;const Vt=L[Et].map;if(Ve-=q,0>Ve)q=Math.max(0,L[Et].g-100),ze=!1;else try{ev(Vt,X,"req"+Ve+"_")}catch{E&&E(Vt)}}if(ze){E=X.join("&");break e}}}return u=u.i.splice(0,g),p.D=u,E}function E_(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;Tu||Vm(),Au||(Tu(),Au=!0),mf.add(p,u),u.v=0}}function Lf(u){return!(u.g||u.u||3<=u.v||(u.Y++,u.u=Cu(P(u.Fa,u),w_(u,u.v)),u.v++,0))}function Ff(u){null!=u.A&&(h.clearTimeout(u.A),u.A=null)}function T_(u){u.g=new Ai(u,u.j,"rpc",u.Y),null===u.m&&(u.g.H=u.o),u.g.O=0;var p=Nr(u.qa);He(p,"RID","rpc"),He(p,"SID",u.K),He(p,"AID",u.T),He(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&He(p,"TO",u.ja),He(p,"TYPE","xmlhttp"),Uu(u,p),u.m&&u.o&&Of(p,u.m,u.o),u.L&&(u.g.I=u.L);var g=u.g;u=u.ia,g.L=1,g.v=Dc(Nr(p)),g.m=null,g.P=!0,Hm(g,u)}function Lc(u){null!=u.C&&(h.clearTimeout(u.C),u.C=null)}function A_(u,p){var g=null;if(u.g==p){Lc(u),Ff(u),u.g=null;var E=2}else{if(!Nf(u.h,p))return;g=p.D,t_(u.h,p),E=1}if(0!=u.G)if(p.o)if(1==E){g=p.m?p.m.length:0,p=Date.now()-p.F;var L=u.B;Ft(E=Pc(),new Gm(E,g)),Mc(u)}else E_(u);else if(3==(L=p.s)||0==L&&0<p.X||!(1==E&&function iv(u,p){return!(e_(u.h)>=u.h.j-(u.s?1:0)||(u.s?(u.i=p.D.concat(u.i),0):1==u.G||2==u.G||u.B>=(u.Va?0:u.Wa)||(u.s=Cu(P(u.Ga,u,p),w_(u,u.B)),u.B++,0)))}(u,p)||2==E&&Lf(u)))switch(g&&0<g.length&&(p=u.h,p.i=p.i.concat(g)),L){case 1:ys(u,5);break;case 4:ys(u,10);break;case 3:ys(u,6);break;default:ys(u,2)}}function w_(u,p){let g=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(g*=2),g*p}function ys(u,p){if(u.j.info("Error code "+p),2==p){var g=P(u.fb,u),E=u.Xa;const L=!E;E=new gs(E||"//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||Vc(E,"https"),Dc(E),L?function YI(u,p){const g=new Vu;if(h.Image){const E=new Image;E.onload=k(Ri,g,"TestLoadImage: loaded",!0,p,E),E.onerror=k(Ri,g,"TestLoadImage: error",!1,p,E),E.onabort=k(Ri,g,"TestLoadImage: abort",!1,p,E),E.ontimeout=k(Ri,g,"TestLoadImage: timeout",!1,p,E),h.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=u}else p(!1)}(E.toString(),g):function XI(u,p){new Vu;const E=new AbortController,L=setTimeout(()=>{E.abort(),Ri(0,0,!1,p)},1e4);fetch(u,{signal:E.signal}).then(q=>{clearTimeout(L),Ri(0,0,!!q.ok,p)}).catch(()=>{clearTimeout(L),Ri(0,0,!1,p)})}(E.toString(),g)}else Ut(2);u.G=0,u.l&&u.l.sa(p),R_(u),y_(u)}function R_(u){if(u.G=0,u.ka=[],u.l){const p=n_(u.h);(0!=p.length||0!=u.i.length)&&(G(u.ka,p),G(u.ka,u.i),u.h.i.length=0,$(u.i),u.i.length=0),u.l.ra()}}function P_(u,p,g){var E=g instanceof gs?Nr(g):new gs(g);if(""!=E.g)p&&(E.g=p+"."+E.g),xc(E,E.s);else{var L=h.location;E=L.protocol,p=p?p+"."+L.hostname:L.hostname,L=+L.port;var q=new gs(null);E&&Vc(q,E),p&&(q.g=p),L&&xc(q,L),g&&(q.l=g),E=q}return p=u.ya,(g=u.D)&&p&&He(E,g,p),He(E,"VER",u.la),Uu(u,E),E}function S_(u,p,g){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return(p=new nt(u.Ca&&!u.pa?new Ou({eb:g}):u.pa)).Ha(u.J),p}function b_(){}function Fc(){}function on(u,p){Ct.call(this),this.g=new g_(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!oe(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!oe(p)&&(this.g.D=p,null!==(u=this.h)&&p in u&&p in(u=this.h)&&delete u[p]),this.j=new ea(this)}function C_(u){Pf.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const g in p){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,p=null!==p&&u in p?p[u]:void 0),this.data=p}else this.data=u}function V_(){Sf.call(this),this.status=1}function ea(u){this.g=u}(r=nt.prototype).Ha=function(u){this.J=u},r.ea=function(u,p,g,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():bf.g(),this.v=function Bm(u){return u.h||(u.h=u.i())}(this.o?this.o:bf),this.g.onreadystatechange=P(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(q){return void d_(this,q)}if(u=g||"",g=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var L in E)g.set(L,E[L]);else{if("function"!=typeof E.keys||"function"!=typeof E.get)throw Error("Unknown input type for opt_headers: "+String(E));for(const q of E.keys())g.set(q,E.get(q))}E=Array.from(g.keys()).find(q=>"content-type"==q.toLowerCase()),L=h.FormData&&u instanceof h.FormData,!(0<=Array.prototype.indexOf.call(nv,p,void 0))||E||L||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[q,X]of g)this.g.setRequestHeader(q,X);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{m_(this),this.u=!0,this.g.send(u),this.u=!1}catch(q){d_(this,q)}},r.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Ft(this,"complete"),Ft(this,"abort"),kc(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),kc(this,!0)),nt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?p_(this):this.bb())},r.bb=function(){p_(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<kr(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&0==p.indexOf(u)&&(p=p.substring(u.length)),kI(p)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=g_.prototype).la=8,r.G=1,r.connect=function(u,p,g,E){Ut(0),this.W=u,this.H=p||{},g&&void 0!==E&&(this.H.OSID=g,this.H.OAID=E),this.F=this.X,this.I=P_(this,null,this.W),Mc(this)},r.Ga=function(u){if(this.s)if(this.s=null,1==this.G){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const L=new Ai(this,this.j,u);let q=this.o;if(this.S&&(q?(q=R(q),N(q,this.S)):q=this.S),null!==this.m||this.O||(L.H=q,q=null),this.P)e:{for(var p=0,g=0;g<this.i.length;g++){var E=this.i[g];if(void 0===(E="__data__"in E.map&&"string"==typeof(E=E.map.__data__)?E.length:void 0))break;if(4096<(p+=E)){p=g;break e}if(4096===p||g===this.i.length-1){p=g+1;break e}}p=1e3}else p=1e3;p=v_(this,L,p),He(g=Nr(this.I),"RID",u),He(g,"CVER",22),this.D&&He(g,"X-HTTP-Session-Id",this.D),Uu(this,g),q&&(this.O?p="headers="+encodeURIComponent(String(h_(q)))+"&"+p:this.m&&Of(g,this.m,q)),kf(this.h,L),this.Ua&&He(g,"TYPE","init"),this.P?(He(g,"$req",p),He(g,"SID","null"),L.T=!0,Vf(L,g,null)):Vf(L,g,p),this.G=2}}else 3==this.G&&(u?I_(this,u):0==this.i.length||Zm(this.h)||I_(this))},r.Fa=function(){if(this.u=null,T_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Cu(P(this.ab,this),u)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ut(10),Oc(this),T_(this))},r.Za=function(){null!=this.C&&(this.C=null,Oc(this),Lf(this),Ut(19))},r.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Ut(2)):(this.j.info("Failed to ping google.com"),Ut(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=b_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Fc.prototype.g=function(u,p){return new on(u,p)},z(on,Ct),on.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},on.prototype.close=function(){Mf(this.g)},on.prototype.o=function(u){var p=this.g;if("string"==typeof u){var g={};g.__data__=u,u=g}else this.u&&((g={}).__data__=wf(u),u=g);p.i.push(new qI(p.Ya++,u)),3==p.G&&Mc(p)},on.prototype.N=function(){this.g.l=null,delete this.j,Mf(this.g),delete this.g,on.aa.N.call(this)},z(C_,Pf),z(V_,Sf),z(ea,b_),ea.prototype.ua=function(){Ft(this.g,"a")},ea.prototype.ta=function(u){Ft(this.g,new C_(u))},ea.prototype.sa=function(u){Ft(this.g,new V_)},ea.prototype.ra=function(){Ft(this.g,"b")},Fc.prototype.createWebChannel=Fc.prototype.g,on.prototype.send=on.prototype.o,on.prototype.open=on.prototype.m,on.prototype.close=on.prototype.close,or=Nt.createWebChannelTransport=function(){return new Fc},Gr=Nt.getStatEventTarget=function(){return Pc()},Kr=Nt.Event=ms,Wr=Nt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Sc.NO_ERROR=0,Sc.TIMEOUT=8,Sc.HTTP_ERROR=6,zt=Nt.ErrorCode=Sc,jm.COMPLETE="complete",Un=Nt.EventType=jm,qm.EventType=Su,Su.OPEN="a",Su.CLOSE="b",Su.ERROR="c",Su.MESSAGE="d",Ct.prototype.listen=Ct.prototype.K,un=Nt.WebChannel=qm,Vi=Nt.FetchXmlHttpFactory=Ou,nt.prototype.listenOnce=nt.prototype.L,nt.prototype.getLastError=nt.prototype.Ka,nt.prototype.getLastErrorCode=nt.prototype.Ba,nt.prototype.getStatus=nt.prototype.Z,nt.prototype.getResponseJson=nt.prototype.Oa,nt.prototype.getResponseText=nt.prototype.oa,nt.prototype.send=nt.prototype.ea,nt.prototype.setWithCredentials=nt.prototype.Ha,Fn=Nt.XhrIo=nt}).apply(typeof Ln<"u"?Ln:typeof self<"u"?self:typeof window<"u"?window:{});const jr="@firebase/firestore";class _e{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_e.UNAUTHENTICATED=new _e(null),_e.GOOGLE_CREDENTIALS=new _e("google-credentials-uid"),_e.FIRST_PARTY=new _e("first-party-uid"),_e.MOCK_USER=new _e("mock-user");let Wt="10.13.0";const Kt=new At.Vy("@firebase/firestore");function Bn(){return Kt.logLevel}function K(r,...e){if(Kt.logLevel<=At.$b.DEBUG){const t=e.map(ar);Kt.debug(`Firestore (${Wt}): ${r}`,...t)}}function Me(r,...e){if(Kt.logLevel<=At.$b.ERROR){const t=e.map(ar);Kt.error(`Firestore (${Wt}): ${r}`,...t)}}function dt(r,...e){if(Kt.logLevel<=At.$b.WARN){const t=e.map(ar);Kt.warn(`Firestore (${Wt}): ${r}`,...t)}}function ar(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function ne(r="Unexpected state"){const e=`FIRESTORE (${Wt}) INTERNAL ASSERTION FAILED: `+r;throw Me(e),new Error(e)}function se(r,e){r||ne()}function J(r,e){return r}const B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class A extends me.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class S{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class b{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class W{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(_e.UNAUTHENTICATED))}shutdown(){}}class te{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class de{constructor(e){this.t=e,this.currentUser=_e.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=m=>this.i!==i?(i=this.i,t(m)):Promise.resolve();let l=new S;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new S,e.enqueueRetryable(()=>s(this.currentUser))};const h=()=>{const m=l;e.enqueueRetryable((0,y.A)(function*(){yield m.promise,yield s(n.currentUser)}))},f=m=>{K("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(m=>f(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?f(m):(K("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new S)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(K("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(se("string"==typeof n.accessToken),new b(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return se(null===e||"string"==typeof e),new _e(e)}}class Pe{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=_e.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class be{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Pe(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(_e.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class $e{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ot{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&K("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const l=s.token!==this.R;return this.R=s.token,K("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{K("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):K("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(se("string"==typeof t.token),this.R=t.token,new $e(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function we(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class jt{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=we(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function he(r,e){return r<e?-1:r>e?1:0}function ur(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Rs(r){return r+"\0"}class Ue{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new A(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new A(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new A(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new A(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ue.fromMillis(Date.now())}static fromDate(e){return Ue.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ue(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?he(this.nanoseconds,e.nanoseconds):he(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ue{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ue(e)}static min(){return new ue(new Ue(0,0))}static max(){return new ue(new Ue(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class qn{constructor(e,t,n){void 0===t?t=0:t>e.length&&ne(),void 0===n?n=e.length-t:n>e.length-t&&ne(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===qn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof qn?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),l=t.get(i);if(s<l)return-1;if(s>l)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ee extends qn{construct(e,t,n){return new Ee(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new A(B.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new Ee(t)}static emptyPath(){return new Ee([])}}const Bc=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Be extends qn{construct(e,t,n){return new Be(e,t,n)}static isValidIdentifier(e){return Bc.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Be.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Be(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new A(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let l=!1;for(;i<e.length;){const h=e[i];if("\\"===h){if(i+1===e.length)throw new A(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[i+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new A(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=f,i+=2}else"`"===h?(l=!l,i++):"."!==h||l?(n+=h,i++):(s(),i++)}if(s(),l)throw new A(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Be(t)}static emptyPath(){return new Be([])}}class Y{constructor(e){this.path=e}static fromPath(e){return new Y(Ee.fromString(e))}static fromName(e){return new Y(Ee.fromString(e).popFirst(5))}static empty(){return new Y(Ee.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ee.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ee.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Y(new Ee(e.slice()))}}class lr{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function oa(r){return r.fields.find(e=>2===e.kind)}function cr(r){return r.fields.filter(e=>2!==e.kind)}lr.UNKNOWN_ID=-1;class hr{constructor(e,t){this.fieldPath=e,this.kind=t}}class $r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new $r(0,ft.min())}}function Ke(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=ue.fromTimestamp(1e9===n?new Ue(t+1,0):new Ue(t,n));return new ft(i,Y.empty(),e)}function ua(r){return new ft(r.readTime,r.key,-1)}class ft{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ft(ue.min(),Y.empty(),-1)}static max(){return new ft(ue.max(),Y.empty(),-1)}}function la(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=Y.comparator(r.documentKey,e.documentKey),0!==t?t:he(r.largestBatchId,e.largestBatchId))}const Ps="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Bu{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function zn(r){return ca.apply(this,arguments)}function ca(){return(ca=(0,y.A)(function*(r){if(r.code!==B.FAILED_PRECONDITION||r.message!==Ps)throw r;K("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ne(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,n)=>{t(e)})}static reject(e){return new M((t,n)=>{n(e)})}static waitFor(e){return new M((t,n)=>{let i=0,s=0,l=!1;e.forEach(h=>{++i,h.next(()=>{++s,l&&s===i&&t()},f=>n(f))}),l=!0,s===i&&t()})}static or(e){let t=M.resolve(!1);for(const n of e)t=t.next(i=>i?M.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new M((n,i)=>{const s=e.length,l=new Array(s);let h=0;for(let f=0;f<s;f++){const m=f;t(e[m]).next(I=>{l[m]=I,++h,h===s&&n(l)},I=>i(I))}})}static doWhile(e,t){return new M((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class Ss{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new S,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new dr(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=fa(n.target.error);this.V.reject(new dr(e,i))}}static open(e,t,n,i){try{return new Ss(t,e.transaction(i,n))}catch(s){throw new dr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(K("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new da(t)}}class ln{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===ln.S((0,me.ZQ)())&&Me("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return K("SimpleDb","Removing database:",e),fr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,me.zW)())return!1;if(ln.v())return!0;const e=(0,me.ZQ)(),t=ln.S(e),n=0<t&&t<10,i=ha(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,y.A)(function*(){return t.db||(K("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=l=>{n(l.target.result)},s.onblocked=()=>{i(new dr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=l=>{const h=l.target.error;i("VersionError"===h.name?new A(B.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new A(B.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new dr(e,h))},s.onupgradeneeded=l=>{K("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',l.oldVersion),t.p.O(l.target.result,s.transaction,l.oldVersion,t.version).next(()=>{K("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,y.A)(function*(){const l="readonly"===t;let h=0;for(;;){++h;try{s.db=yield s.M(e);const f=Ss.open(s.db,e,l?"readonly":"readwrite",n),m=i(f).next(I=>(f.g(),I)).catch(I=>(f.abort(I),M.reject(I))).toPromise();return m.catch(()=>{}),yield f.m,m}catch(f){const m=f,I="FirebaseError"!==m.name&&h<3;if(K("SimpleDb","Transaction failed with error:",m.message,"Retrying:",I),s.close(),!I)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function ha(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class qu{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return fr(this.B.delete())}}class dr extends A{constructor(e,t){super(B.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function $t(r){return"IndexedDbTransactionError"===r.name}class da{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(K("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(K("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),fr(n)}add(e){return K("SimpleDb","ADD",this.store.name,e,e),fr(this.store.add(e))}get(e){return fr(this.store.get(e)).next(t=>(void 0===t&&(t=null),K("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return K("SimpleDb","DELETE",this.store.name,e),fr(this.store.delete(e))}count(){return K("SimpleDb","COUNT",this.store.name),fr(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new M((l,h)=>{s.onerror=f=>{h(f.target.error)},s.onsuccess=f=>{l(f.target.result)}})}{const s=this.cursor(n),l=[];return this.W(s,(h,f)=>{l.push(f)}).next(()=>l)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new M((i,s)=>{n.onerror=l=>{s(l.target.error)},n.onsuccess=l=>{i(l.target.result)}})}j(e,t){K("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,l,h)=>h.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new M((n,i)=>{t.onerror=s=>{const l=fa(s.target.error);i(l)},t.onsuccess=s=>{const l=s.target.result;l?e(l.primaryKey,l.value).next(h=>{h?l.continue():n()}):n()}})}W(e,t){const n=[];return new M((i,s)=>{e.onerror=l=>{s(l.target.error)},e.onsuccess=l=>{const h=l.target.result;if(!h)return void i();const f=new qu(h),m=t(h.primaryKey,h.value,f);if(m instanceof M){const I=m.catch(T=>(f.done(),M.reject(T)));n.push(I)}f.isDone?i():null===f.K?h.continue():h.continue(f.K)}}).next(()=>M.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function fr(r){return new M((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=fa(n.target.error);t(i)}})}let bs=!1;function fa(r){const e=ln.S((0,me.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new A("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return bs||(bs=!0,setTimeout(()=>{throw n},0)),n}}return r}class zc{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;K("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,y.A)(function*(){t.task=null;try{K("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){$t(n)?K("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield zn(n)}yield t.X(6e4)}))}}class zu{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,y.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return M.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(l=>{if(null!==l&&!n.has(l))return K("IndexBackfiller",`Processing collection: ${l}`),this.ne(e,l,i).next(h=>{i-=h,n.add(l)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const l=s.changes;return this.localStore.indexManager.updateIndexEntries(e,l).next(()=>this.re(i,s)).next(h=>(K("IndexBackfiller",`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h))).next(()=>l.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const l=ua(s);la(l,n)>0&&(n=l)}),new ft(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let wt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function xi(r){return null==r}function Qr(r){return 0===r&&1/r==-1/0}function Wu(r){return"number"==typeof r&&Number.isInteger(r)&&!Qr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Ye(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Cs(e)),e=Ku(r.get(t),e);return Cs(e)}function Ku(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Cs(r){return r+"\x01\x01"}function cn(r){const e=r.length;if(se(e>=2),2===e)return se("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),Ee.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const l=r.indexOf("\x01",s);switch((l<0||l>t)&&ne(),r.charAt(l+1)){case"\x01":const h=r.substring(s,l);let f;0===i.length?f=h:(i+=h,f=i,i=""),n.push(f);break;case"\x10":i+=r.substring(s,l),i+="\0";break;case"\x11":i+=r.substring(s,l+1);break;default:ne()}s=l+2}return new Ee(n)}const Vs=["userId","batchId"];function xs(r,e){return[r,Ye(e)]}function Ds(r,e,t){return[r,Ye(e),t]}const Wc={},pa=["prefixPath","collectionGroup","readTime","documentId"],Kc=["prefixPath","collectionGroup","documentId"],ma=["collectionGroup","readTime","prefixPath","documentId"],Ns=["canonicalId","targetId"],_a=["targetId","path"],Gc=["path","targetId"],ga=["collectionId","parent"],jc=["indexId","uid"],ya=["uid","sequenceNumber"],$c=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ia=["indexId","uid","orderedDocumentKey"],Qc=["userId","collectionPath","documentId"],va=["userId","collectionPath","largestBatchId"],Hc=["userId","collectionGroup","largestBatchId"],ks=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Jc=[...ks,"documentOverlays"],Os=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Hr=Os,en=[...Hr,"indexConfiguration","indexState","indexEntries"],Ea=en,Yc=[...en,"globals"];class Qt extends Bu{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function it(r,e){const t=J(r);return ln.F(t._e,e)}function Ms(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Wn(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Gu(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Ne{constructor(e,t){this.comparator=e,this.root=t||pt.EMPTY}insert(e,t){return new Ne(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,pt.BLACK,null,null))}remove(e){return new Ne(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Fs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Fs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Fs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Fs(this.root,e,this.comparator,!0)}}class Fs{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pt{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:pt.RED,this.left=null!=i?i:pt.EMPTY,this.right=null!=s?s:pt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new pt(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return pt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return pt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ne();const e=this.left.check();if(e!==this.right.check())throw ne();return e+(this.isRed()?0:1)}}pt.EMPTY=null,pt.RED=!0,pt.BLACK=!1,pt.EMPTY=new class{constructor(){this.size=0}get key(){throw ne()}get value(){throw ne()}get color(){throw ne()}get left(){throw ne()}get right(){throw ne()}copy(e,t,n,i,s){return this}insert(e,t,n){return new pt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ce{constructor(e){this.comparator=e,this.data=new Ne(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Kn(this.data.getIterator())}getIteratorFrom(e){return new Kn(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Ce)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ce(this.comparator);return t.data=e,t}}class Kn{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Jr(r){return r.hasNext()?r.getNext():void 0}class Rt{constructor(e){this.fields=e,e.sort(Be.comparator)}static empty(){return new Rt([])}unionWith(e){let t=new Ce(Be.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Rt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ur(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Yr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ge{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Yr("Invalid base64 string: "+s):s}}(e);return new Ge(t)}static fromUint8Array(e){const t=function(i){let s="";for(let l=0;l<i.length;++l)s+=String.fromCharCode(i[l]);return s}(e);return new Ge(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return he(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ge.EMPTY_BYTE_STRING=new Ge("");const gn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pt(r){if(se(!!r),"string"==typeof r){let e=0;const t=gn.exec(r);if(se(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ke(r.seconds),nanos:ke(r.nanos)}}function ke(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function yn(r){return"string"==typeof r?Ge.fromBase64String(r):Ge.fromUint8Array(r)}function Us(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Bs(r){const e=r.mapValue.fields.__previous_value__;return Us(e)?Bs(e):e}function Di(r){const e=Pt(r.mapValue.fields.__local_write_time__.timestampValue);return new Ue(e.seconds,e.nanos)}class Xr{constructor(e,t,n,i,s,l,h,f,m){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=l,this.autoDetectLongPolling=h,this.longPollingOptions=f,this.useFetchStreams=m}}class Gn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Gn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Gn&&e.projectId===this.projectId&&e.database===this.database}}const tn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},qs={nullValue:"NULL_VALUE"};function In(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Us(r)?4:Ta(r)?9007199254740991:Mi(r)?10:11:ne()}function Ht(r,e){if(r===e)return!0;const t=In(r);if(t!==In(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Di(r).isEqual(Di(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const l=Pt(i.timestampValue),h=Pt(s.timestampValue);return l.seconds===h.seconds&&l.nanos===h.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,yn(r.bytesValue).isEqual(yn(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return ke(i.geoPointValue.latitude)===ke(s.geoPointValue.latitude)&&ke(i.geoPointValue.longitude)===ke(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ke(i.integerValue)===ke(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const l=ke(i.doubleValue),h=ke(s.doubleValue);return l===h?Qr(l)===Qr(h):isNaN(l)&&isNaN(h)}return!1}(r,e);case 9:return ur(r.arrayValue.values||[],e.arrayValue.values||[],Ht);case 10:case 11:return function(i,s){const l=i.mapValue.fields||{},h=s.mapValue.fields||{};if(Ms(l)!==Ms(h))return!1;for(const f in l)if(l.hasOwnProperty(f)&&(void 0===h[f]||!Ht(l[f],h[f])))return!1;return!0}(r,e);default:return ne()}var s}function _t(r,e){return void 0!==(r.values||[]).find(t=>Ht(t,e))}function vn(r,e){if(r===e)return 0;const t=In(r),n=In(e);if(t!==n)return he(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return he(r.booleanValue,e.booleanValue);case 2:return function(s,l){const h=ke(s.integerValue||s.doubleValue),f=ke(l.integerValue||l.doubleValue);return h<f?-1:h>f?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1}(r,e);case 3:return ju(r.timestampValue,e.timestampValue);case 4:return ju(Di(r),Di(e));case 5:return he(r.stringValue,e.stringValue);case 6:return function(s,l){const h=yn(s),f=yn(l);return h.compareTo(f)}(r.bytesValue,e.bytesValue);case 7:return function(s,l){const h=s.split("/"),f=l.split("/");for(let m=0;m<h.length&&m<f.length;m++){const I=he(h[m],f[m]);if(0!==I)return I}return he(h.length,f.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,l){const h=he(ke(s.latitude),ke(l.latitude));return 0!==h?h:he(ke(s.longitude),ke(l.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return zs(r.arrayValue,e.arrayValue);case 10:return function(s,l){var h,f,m,I;const k=null===(h=(s.fields||{}).value)||void 0===h?void 0:h.arrayValue,z=null===(f=(l.fields||{}).value)||void 0===f?void 0:f.arrayValue,$=he((null===(m=null==k?void 0:k.values)||void 0===m?void 0:m.length)||0,(null===(I=null==z?void 0:z.values)||void 0===I?void 0:I.length)||0);return 0!==$?$:zs(k,z)}(r.mapValue,e.mapValue);case 11:return function(s,l){if(s===tn.mapValue&&l===tn.mapValue)return 0;if(s===tn.mapValue)return 1;if(l===tn.mapValue)return-1;const h=s.fields||{},f=Object.keys(h),m=l.fields||{},I=Object.keys(m);f.sort(),I.sort();for(let T=0;T<f.length&&T<I.length;++T){const P=he(f[T],I[T]);if(0!==P)return P;const k=vn(h[f[T]],m[I[T]]);if(0!==k)return k}return he(f.length,I.length)}(r.mapValue,e.mapValue);default:throw ne()}}function ju(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return he(r,e);const t=Pt(r),n=Pt(e),i=he(t.seconds,n.seconds);return 0!==i?i:he(t.nanos,n.nanos)}function zs(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=vn(t[i],n[i]);if(s)return s}return he(t.length,n.length)}function En(r){return Ws(r)}function Ws(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Pt(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?yn(r.bytesValue).toBase64():"referenceValue"in r?Y.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=Ws(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const l of n)s?s=!1:i+=",",i+=`${l}:${Ws(t.fields[l])}`;return i+"}"}(r.mapValue):ne()}function pr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function ki(r){return!!r&&"integerValue"in r}function mr(r){return!!r&&"arrayValue"in r}function Ks(r){return!!r&&"nullValue"in r}function Oi(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Zr(r){return!!r&&"mapValue"in r}function Mi(r){var e,t;return"__vector__"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function _r(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Wn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=_r(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=_r(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Ta(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}const Gs={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function js(r){return"nullValue"in r?qs:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?pr(Gn.empty(),Y.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Mi(r)?Gs:{mapValue:{}}:ne()}function Aa(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?pr(Gn.empty(),Y.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Gs:"mapValue"in r?Mi(r)?{mapValue:{}}:tn:ne()}function wa(r,e){const t=vn(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function $s(r,e){const t=vn(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class at{constructor(e){this.value=e}static empty(){return new at({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Zr(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_r(t)}setAll(e){let t=Be.emptyPath(),n={},i=[];e.forEach((l,h)=>{if(!t.isImmediateParentOf(h)){const f=this.getFieldsMap(t);this.applyChanges(f,n,i),n={},i=[],t=h.popLast()}l?n[h.lastSegment()]=_r(l):i.push(h.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Zr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ht(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Zr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Wn(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new at(_r(this.value))}}function Qs(r){const e=[];return Wn(r.fields,(t,n)=>{const i=new Be([t]);if(Zr(n)){const s=Qs(n.mapValue).fields;if(0===s.length)e.push(i);else for(const l of s)e.push(i.child(l))}else e.push(i)}),new Rt(e)}class qe{constructor(e,t,n,i,s,l,h){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=l,this.documentState=h}static newInvalidDocument(e){return new qe(e,0,ue.min(),ue.min(),ue.min(),at.empty(),0)}static newFoundDocument(e,t,n,i){return new qe(e,1,t,ue.min(),n,i,0)}static newNoDocument(e,t){return new qe(e,2,t,ue.min(),ue.min(),at.empty(),0)}static newUnknownDocument(e,t){return new qe(e,3,t,ue.min(),ue.min(),at.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ue.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=at.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=at.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof qe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class hn{constructor(e,t){this.position=e,this.inclusive=t}}function $u(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],l=r.position[i];if(n=s.field.isKeyField()?Y.comparator(Y.fromName(l.referenceValue),t.key):vn(l,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Hs(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Ht(r.position[t],e.position[t]))return!1;return!0}class Tn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ra(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Js{}class Ie extends Js{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ba(e,t,n):"array-contains"===t?new Va(e,n):"in"===t?new Yu(e,n):"not-in"===t?new Zc(e,n):"array-contains-any"===t?new xa(e,n):new Ie(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Xc(e,n):new Ca(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(vn(t,this.value)):null!==t&&In(this.value)===In(t)&&this.matchesComparison(vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ne()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Se extends Js{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Se(e,t)}matches(e){return jn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function jn(r){return"and"===r.op}function Pa(r){return"or"===r.op}function Li(r){return Qu(r)&&jn(r)}function Qu(r){for(const e of r.filters)if(e instanceof Se)return!1;return!0}function Fi(r){if(r instanceof Ie)return r.field.canonicalString()+r.op.toString()+En(r.value);if(Li(r))return r.filters.map(e=>Fi(e)).join(",");{const e=r.filters.map(t=>Fi(t)).join(",");return`${r.op}(${e})`}}function Hu(r,e){return r instanceof Ie?(n=r,(i=e)instanceof Ie&&n.op===i.op&&n.field.isEqual(i.field)&&Ht(n.value,i.value)):r instanceof Se?function(n,i){return i instanceof Se&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,l,h)=>s&&Hu(l,i.filters[h]),!0)}(r,e):void ne();var n,i}function Ys(r,e){const t=r.filters.concat(e);return Se.create(t,r.op)}function Sa(r){return r instanceof Ie?`${(t=r).field.canonicalString()} ${t.op} ${En(t.value)}`:r instanceof Se?function(t){return t.op.toString()+" {"+t.getFilters().map(Sa).join(" ,")+"}"}(r):"Filter";var t}class ba extends Ie{constructor(e,t,n){super(e,t,n),this.key=Y.fromName(n.referenceValue)}matches(e){const t=Y.comparator(e.key,this.key);return this.matchesComparison(t)}}class Xc extends Ie{constructor(e,t){super(e,"in",t),this.keys=Ju(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Ca extends Ie{constructor(e,t){super(e,"not-in",t),this.keys=Ju(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ju(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>Y.fromName(n.referenceValue))}class Va extends Ie{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return mr(t)&&_t(t.arrayValue,this.value)}}class Yu extends Ie{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&_t(this.value.arrayValue,t)}}class Zc extends Ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(_t(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!_t(this.value.arrayValue,t)}}class xa extends Ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!mr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>_t(this.value.arrayValue,n))}}class eh{constructor(e,t=null,n=[],i=[],s=null,l=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=l,this.endAt=h,this.ue=null}}function Da(r,e=null,t=[],n=[],i=null,s=null,l=null){return new eh(r,e,t,n,i,s,l)}function An(r){const e=J(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Fi(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),xi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>En(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>En(n)).join(",")),e.ue=t}return e.ue}function Ui(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Ra(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Hu(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Hs(r.startAt,e.startAt)&&Hs(r.endAt,e.endAt)}function ei(r){return Y.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function Xs(r,e){return r.filters.filter(t=>t instanceof Ie&&t.field.isEqual(e))}function Zs(r,e,t){let n=qs,i=!0;for(const s of Xs(r,e)){let l=qs,h=!0;switch(s.op){case"<":case"<=":l=js(s.value);break;case"==":case"in":case">=":l=s.value;break;case">":l=s.value,h=!1;break;case"!=":case"not-in":l=qs}wa({value:n,inclusive:i},{value:l,inclusive:h})<0&&(n=l,i=h)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const l=t.position[s];wa({value:n,inclusive:i},{value:l,inclusive:t.inclusive})<0&&(n=l,i=t.inclusive);break}return{value:n,inclusive:i}}function Xu(r,e,t){let n=tn,i=!0;for(const s of Xs(r,e)){let l=tn,h=!0;switch(s.op){case">=":case">":l=Aa(s.value),h=!1;break;case"==":case"in":case"<=":l=s.value;break;case"<":l=s.value,h=!1;break;case"!=":case"not-in":l=tn}$s({value:n,inclusive:i},{value:l,inclusive:h})>0&&(n=l,i=h)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const l=t.position[s];$s({value:n,inclusive:i},{value:l,inclusive:t.inclusive})>0&&(n=l,i=t.inclusive);break}return{value:n,inclusive:i}}class nn{constructor(e,t=null,n=[],i=[],s=null,l="F",h=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=l,this.startAt=h,this.endAt=f,this.ce=null,this.le=null,this.he=null}}function Zu(r,e,t,n,i,s,l,h){return new nn(r,e,t,n,i,s,l,h)}function $n(r){return new nn(r)}function el(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Bi(r){return null!==r.collectionGroup}function ti(r){const e=J(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let h=new Ce(Be.comparator);return l.filters.forEach(f=>{f.getFlattenedFilters().forEach(m=>{m.isInequality()&&(h=h.add(m.field))})}),h})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Tn(s,n))}),t.has(Be.keyField().canonicalString())||e.ce.push(new Tn(Be.keyField(),n))}return e.ce}function ut(r){const e=J(r);return e.le||(e.le=function nl(r,e){if("F"===r.limitType)return Da(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new Tn(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new hn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new hn(r.startAt.position,r.startAt.inclusive):null;return Da(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,ti(r))),e.le}function eo(r,e){const t=r.filters.concat([e]);return new nn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function ni(r,e,t){return new nn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function qi(r,e){return Ui(ut(r),ut(e))&&r.limitType===e.limitType}function gr(r){return`${An(ut(r))}|lt:${r.limitType}`}function yr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Sa(i)).join(", ")}]`),xi(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(l=i).field.canonicalString()} (${l.dir})`;var l}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>En(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>En(i)).join(",")),`Target(${n})`}(ut(r))}; limitType=${r.limitType})`}function zi(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):Y.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of ti(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(l,h,f){const m=$u(l,h,f);return l.inclusive?m<=0:m<0}(n.startAt,ti(n),i)||n.endAt&&!function(l,h,f){const m=$u(l,h,f);return l.inclusive?m>=0:m>0}(n.endAt,ti(n),i)));var n,i}function rl(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function il(r){return(e,t)=>{let n=!1;for(const i of ti(r)){const s=th(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function th(r,e,t){const n=r.field.isKeyField()?Y.comparator(e.key,t.key):function(s,l,h){const f=l.data.field(s),m=h.data.field(s);return null!==f&&null!==m?vn(f,m):ne()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return ne()}}class wn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Wn(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return Gu(this.inner)}size(){return this.innerSize}}const qf=new Ne(Y.comparator);function Ot(){return qf}const nh=new Ne(Y.comparator);function Ir(...r){let e=nh;for(const t of r)e=e.insert(t.key,t);return e}function sl(r){let e=nh;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function dn(){return to()}function rh(){return to()}function to(){return new wn(r=>r.toString(),(r,e)=>r.isEqual(e))}const zf=new Ne(Y.comparator),Wf=new Ce(Y.comparator);function ge(...r){let e=Wf;for(const t of r)e=e.add(t);return e}const Kf=new Ce(he);function Wi(){return Kf}function Rn(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qr(e)?"-0":e}}function no(r){return{integerValue:""+r}}function ol(r,e){return Wu(e)?no(e):Rn(r,e)}class ro{constructor(){this._=void 0}}function ih(r,e,t){return r instanceof ri?function(i,s){const l={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Us(s)&&(s=Bs(s)),s&&(l.fields.__previous_value__=s),{mapValue:l}}(t,e):r instanceof Pn?io(r,e):r instanceof vr?Ki(r,e):function(i,s){const l=al(i,s),h=ul(l)+ul(i.Pe);return ki(l)&&ki(i.Pe)?no(h):Rn(i.serializer,h)}(r,e)}function Gf(r,e,t){return r instanceof Pn?io(r,e):r instanceof vr?Ki(r,e):t}function al(r,e){return r instanceof Er?ki(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class ri extends ro{}class Pn extends ro{constructor(e){super(),this.elements=e}}function io(r,e){const t=ll(e);for(const n of r.elements)t.some(i=>Ht(i,n))||t.push(n);return{arrayValue:{values:t}}}class vr extends ro{constructor(e){super(),this.elements=e}}function Ki(r,e){let t=ll(e);for(const n of r.elements)t=t.filter(i=>!Ht(i,n));return{arrayValue:{values:t}}}class Er extends ro{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function ul(r){return ke(r.integerValue||r.doubleValue)}function ll(r){return mr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class so{constructor(e,t){this.field=e,this.transform=t}}class jf{constructor(e,t){this.version=e,this.transformResults=t}}class Le{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Le}static exists(e){return new Le(void 0,e)}static updateTime(e){return new Le(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oo(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class ao{}function ii(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new oi(r.key,Le.none()):new si(r.key,r.data,Le.none());{const t=r.data,n=at.empty();let i=new Ce(Be.comparator);for(let s of e.fields)if(!i.has(s)){let l=t.field(s);null===l&&s.length>1&&(s=s.popLast(),l=t.field(s)),null===l?n.delete(s):n.set(s,l),i=i.add(s)}return new rn(r.key,n,new Rt(i.toArray()),Le.none())}}function sh(r,e,t){r instanceof si?function(i,s,l){const h=i.value.clone(),f=dl(i.fieldTransforms,s,l.transformResults);h.setAll(f),s.convertToFoundDocument(l.version,h).setHasCommittedMutations()}(r,e,t):r instanceof rn?function(i,s,l){if(!oo(i.precondition,s))return void s.convertToUnknownDocument(l.version);const h=dl(i.fieldTransforms,s,l.transformResults),f=s.data;f.setAll(hl(i)),f.setAll(h),s.convertToFoundDocument(l.version,f).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function je(r,e,t,n){return r instanceof si?function(s,l,h,f){if(!oo(s.precondition,l))return h;const m=s.value.clone(),I=Na(s.fieldTransforms,f,l);return m.setAll(I),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),null}(r,e,t,n):r instanceof rn?function(s,l,h,f){if(!oo(s.precondition,l))return h;const m=Na(s.fieldTransforms,f,l),I=l.data;return I.setAll(hl(s)),I.setAll(m),l.convertToFoundDocument(l.version,I).setHasLocalMutations(),null===h?null:h.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(T=>T.field))}(r,e,t,n):(h=t,oo(r.precondition,l=e)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):h);var l,h}function oh(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=al(n.transform,i||null);null!=s&&(null===t&&(t=at.empty()),t.set(n.field,s))}return t||null}function uo(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&ur(n,i,(s,l)=>function cl(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Pn&&i instanceof Pn||n instanceof vr&&i instanceof vr?ur(n.elements,i.elements,Ht):n instanceof Er&&i instanceof Er?Ht(n.Pe,i.Pe):n instanceof ri&&i instanceof ri);var n,i}(s,l))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class si extends ao{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class rn extends ao{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function hl(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function dl(r,e,t){const n=new Map;se(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],l=s.transform,h=e.data.field(s.field);n.set(s.field,Gf(l,h,t[i]))}return n}function Na(r,e,t){const n=new Map;for(const i of r){const s=i.transform,l=t.data.field(i.field);n.set(i.field,ih(s,l,e))}return n}class oi extends ao{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ai extends ao{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class lo{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&sh(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=je(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=je(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=rh();return this.mutations.forEach(i=>{const s=e.get(i.key),l=s.overlayedDocument;let h=this.applyToLocalView(l,s.mutatedFields);h=t.has(i.key)?null:h;const f=ii(l,h);null!==f&&n.set(i.key,f),l.isValidDocument()||l.convertToNoDocument(ue.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ge())}isEqual(e){return this.batchId===e.batchId&&ur(this.mutations,e.mutations,(t,n)=>uo(t,n))&&ur(this.baseMutations,e.baseMutations,(t,n)=>uo(t,n))}}class Tr{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){se(e.mutations.length===n.length);let i=function(){return zf}();const s=e.mutations;for(let l=0;l<s.length;l++)i=i.insert(s[l].key,n[l].version);return new Tr(e,t,n,i)}}class ui{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ka{constructor(e,t){this.count=e,this.unchangedNames=t}}var Xe,Te;function pl(r){switch(r){default:return ne();case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0}}function co(r){if(void 0===r)return Me("GRPC error has no .code"),B.UNKNOWN;switch(r){case Xe.OK:return B.OK;case Xe.CANCELLED:return B.CANCELLED;case Xe.UNKNOWN:return B.UNKNOWN;case Xe.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case Xe.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case Xe.INTERNAL:return B.INTERNAL;case Xe.UNAVAILABLE:return B.UNAVAILABLE;case Xe.UNAUTHENTICATED:return B.UNAUTHENTICATED;case Xe.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case Xe.NOT_FOUND:return B.NOT_FOUND;case Xe.ALREADY_EXISTS:return B.ALREADY_EXISTS;case Xe.PERMISSION_DENIED:return B.PERMISSION_DENIED;case Xe.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case Xe.ABORTED:return B.ABORTED;case Xe.OUT_OF_RANGE:return B.OUT_OF_RANGE;case Xe.UNIMPLEMENTED:return B.UNIMPLEMENTED;case Xe.DATA_LOSS:return B.DATA_LOSS;default:return ne()}}(Te=Xe||(Xe={}))[Te.OK=0]="OK",Te[Te.CANCELLED=1]="CANCELLED",Te[Te.UNKNOWN=2]="UNKNOWN",Te[Te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Te[Te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Te[Te.NOT_FOUND=5]="NOT_FOUND",Te[Te.ALREADY_EXISTS=6]="ALREADY_EXISTS",Te[Te.PERMISSION_DENIED=7]="PERMISSION_DENIED",Te[Te.UNAUTHENTICATED=16]="UNAUTHENTICATED",Te[Te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Te[Te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Te[Te.ABORTED=10]="ABORTED",Te[Te.OUT_OF_RANGE=11]="OUT_OF_RANGE",Te[Te.UNIMPLEMENTED=12]="UNIMPLEMENTED",Te[Te.INTERNAL=13]="INTERNAL",Te[Te.UNAVAILABLE=14]="UNAVAILABLE",Te[Te.DATA_LOSS=15]="DATA_LOSS";function ml(){return new TextEncoder}const ah=new It([4294967295,4294967295],0);function uh(r){const e=ml().encode(r),t=new Ci;return t.update(e),new Uint8Array(t.digest())}function Oa(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new It([t,n],0),new It([i,s],0)]}class Ma{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ji(`Invalid padding: ${t}`);if(n<0)throw new ji(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new ji(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ji(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=It.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(It.fromNumber(n)));return 1===i.compare(ah)&&(i=new It([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=uh(e),[n,i]=Oa(t);for(let s=0;s<this.hashCount;s++){const l=this.Ee(n,i,s);if(!this.de(l))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),l=new Ma(s,i,t);return n.forEach(h=>l.insert(h)),l}insert(e){if(0===this.Ie)return;const t=uh(e),[n,i]=Oa(t);for(let s=0;s<this.hashCount;s++){const l=this.Ee(n,i,s);this.Ae(l)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ji extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class $i{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Qi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new $i(ue.min(),i,new Ne(he),Ot(),ge())}}class Qi{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Qi(n,t,ge(),ge(),ge())}}class ho{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class Hi{constructor(e,t){this.targetId=e,this.me=t}}class _l{constructor(e,t,n=Ge.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class gl{constructor(){this.fe=0,this.ge=yl(),this.pe=Ge.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ge(),t=ge(),n=ge();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:ne()}}),new Qi(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=yl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,se(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class lh{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ot(),this.qe=fo(),this.Qe=new Ne(he)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:ne()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(ei(s))if(0===n){const l=new Y(s.path);this.Ue(t,l,qe.newNoDocument(l,ue.min()))}else se(1===n);else{const l=this.Ye(t);if(l!==n){const h=this.Ze(e),f=h?this.Xe(h,e,l):1;0!==f&&(this.je(t),this.Qe=this.Qe.insert(t,2===f?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let l,h;try{l=yn(n).toUint8Array()}catch(f){if(f instanceof Yr)return dt("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{h=new Ma(l,i,s)}catch(f){return dt(f instanceof ji?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return 0===h.Ie?null:h}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const l=this.Le.tt(),h=`projects/${l.projectId}/databases/${l.database}/documents/${s.path.canonicalString()}`;e.mightContain(h)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,l)=>{const h=this.Je(l);if(h){if(s.current&&ei(h.target)){const f=new Y(h.target.path);null!==this.ke.get(f)||this.it(l,f)||this.Ue(l,f,qe.newNoDocument(f,e))}s.be&&(t.set(l,s.ve()),s.Ce())}});let n=ge();this.qe.forEach((s,l)=>{let h=!0;l.forEachWhile(f=>{const m=this.Je(f);return!m||"TargetPurposeLimboResolution"===m.purpose||(h=!1,!1)}),h&&(n=n.add(s))}),this.ke.forEach((s,l)=>l.setReadTime(e));const i=new $i(e,t,this.Qe,this.ke,n);return this.ke=Ot(),this.qe=fo(),this.Qe=new Ne(he),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new gl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ce(he),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||K("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new gl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function fo(){return new Ne(Y.comparator)}function yl(){return new Ne(Y.comparator)}const ch={asc:"ASCENDING",desc:"DESCENDING"},hh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dh={and:"AND",or:"OR"};class Il{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function La(r,e){return r.useProto3Json||xi(e)?e:{value:e}}function li(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function vl(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function Fa(r,e){return li(r,e.toTimestamp())}function Ze(r){return se(!!r),ue.fromTimestamp(function(t){const n=Pt(t);return new Ue(n.seconds,n.nanos)}(r))}function Ji(r,e){return Ua(r,e).canonicalString()}function Ua(r,e){const t=(i=r,new Ee(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function po(r){const e=Ee.fromString(r);return se(vo(e)),e}function Yi(r,e){return Ji(r.databaseId,e.path)}function Jt(r,e){const t=po(e);if(t.get(1)!==r.databaseId.projectId)throw new A(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new A(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new Y(_o(t))}function Xi(r,e){return Ji(r.databaseId,e)}function mo(r){const e=po(r);return 4===e.length?Ee.emptyPath():_o(e)}function Ba(r){return new Ee(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function _o(r){return se(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function El(r,e,t){return{name:Yi(r,e),fields:t.value.mapValue.fields}}function Qn(r,e,t){const n=Jt(r,e.name),i=Ze(e.updateTime),s=e.createTime?Ze(e.createTime):ue.min(),l=new at({mapValue:{fields:e.fields}}),h=qe.newFoundDocument(n,i,s,l);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function Zi(r,e){let t;if(e instanceof si)t={update:El(r,e.key,e.value)};else if(e instanceof oi)t={delete:Yi(r,e.key)};else if(e instanceof rn)t={update:El(r,e.key,e.data),updateMask:_h(e.fieldMask)};else{if(!(e instanceof ai))return ne();t={verify:Yi(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,l){const h=l.transform;if(h instanceof ri)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof Pn)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof vr)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof Er)return{fieldPath:l.field.canonicalString(),increment:h.Pe};throw ne()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Fa(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:ne()),t;var s}function za(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?Le.updateTime(Ze(s.updateTime)):void 0!==s.exists?Le.exists(s.exists):Le.none():Le.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(l,h){let f=null;"setToServerValue"in h?(se("REQUEST_TIME"===h.setToServerValue),f=new ri):"appendMissingElements"in h?f=new Pn(h.appendMissingElements.values||[]):"removeAllFromArray"in h?f=new vr(h.removeAllFromArray.values||[]):"increment"in h?f=new Er(l,h.increment):ne();const m=Be.fromServerFormat(h.fieldPath);return new so(m,f)}(r,i)):[];var s;if(e.update){const i=Jt(r,e.update.name),s=new at({mapValue:{fields:e.update.fields}});if(e.updateMask){const l=new Rt((e.updateMask.fieldPaths||[]).map(I=>Be.fromServerFormat(I)));return new rn(i,s,l,t,n)}return new si(i,s,t,n)}if(e.delete){const i=Jt(r,e.delete);return new oi(i,t)}if(e.verify){const i=Jt(r,e.verify);return new ai(i,t)}return ne()}function Ka(r,e){return{documents:[Xi(r,e.path)]}}function go(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Xi(r,i);const s=function(m){if(0!==m.length)return Al(Se.create(m,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const l=function(m){if(0!==m.length)return m.map(I=>{return{field:Hn((P=I).field),direction:mh(P.dir)};var P})}(e.orderBy);l&&(t.structuredQuery.orderBy=l);const h=La(r,e.limit);return null!==h&&(t.structuredQuery.limit=h),e.startAt&&(t.structuredQuery.startAt={before:(m=e.startAt).inclusive,values:m.position}),e.endAt&&(t.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{_t:t,parent:i};var m}function yo(r){let e=mo(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){se(1===n);const I=t.from[0];I.allDescendants?i=I.collectionId:e=e.child(I.collectionId)}let s=[];t.where&&(s=function(T){const P=Io(T);return P instanceof Se&&Li(P)?P.getFilters():[P]}(t.where));let l=[];t.orderBy&&(l=t.orderBy.map(P=>{return new Tn(fn((z=P).field),function(G){switch(G){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(z.direction));var z}));let h=null;t.limit&&(h=function(T){let P;return P="object"==typeof T?T.value:T,xi(P)?null:P}(t.limit));let f=null;var T;t.startAt&&(f=new hn((T=t.startAt).values||[],!!T.before));let m=null;return t.endAt&&(m=function(T){return new hn(T.values||[],!T.before)}(t.endAt)),Zu(e,i,l,s,h,"F",f,m)}function Io(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=fn(t.unaryFilter.field);return Ie.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=fn(t.unaryFilter.field);return Ie.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=fn(t.unaryFilter.field);return Ie.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=fn(t.unaryFilter.field);return Ie.create(l,"!=",{nullValue:"NULL_VALUE"});default:return ne()}}(r):void 0!==r.fieldFilter?Ie.create(fn((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ne()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return Se.create(t.compositeFilter.filters.map(n=>Io(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return ne()}}(t.compositeFilter.op))}(r):ne();var t}function mh(r){return ch[r]}function Ga(r){return hh[r]}function ja(r){return dh[r]}function Hn(r){return{fieldPath:r.canonicalString()}}function fn(r){return Be.fromServerFormat(r.fieldPath)}function Al(r){return r instanceof Ie?function(t){if("=="===t.op){if(Oi(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NAN"}};if(Ks(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Oi(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NOT_NAN"}};if(Ks(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hn(t.field),op:Ga(t.op),value:t.value}}}(r):r instanceof Se?function(t){const n=t.getFilters().map(i=>Al(i));return 1===n.length?n[0]:{compositeFilter:{op:ja(t.op),filters:n}}}(r):ne()}function _h(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vo(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class sn{constructor(e,t,n,i,s=ue.min(),l=ue.min(),h=Ge.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=h,this.expectedCount=f}withSequenceNumber(e){return new sn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new sn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new sn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new sn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Eo{constructor(e){this.ct=e}}function $a(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:es(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:Yi(s=r.ct,(l=e).key),fields:l.data.value.mapValue.fields,updateTime:li(s,l.version.toTimestamp()),createTime:li(s,l.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Jn(e.version)};else{if(!e.isUnknownDocument())return ne();n.unknownDocument={path:t.path.toArray(),version:Jn(e.version)}}var s,l;return n}function es(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Jn(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ar(r){const e=new Ue(r.seconds,r.nanoseconds);return ue.fromTimestamp(e)}function wr(r,e){const t=(e.baseMutations||[]).map(s=>za(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>za(r.ct,s)),i=Ue.fromMillis(e.localWriteTimeMs);return new lo(e.batchId,i,t,n)}function Rr(r){const e=Ar(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?Ar(r.lastLimboFreeSnapshotVersion):ue.min();let n;return n=void 0!==r.query.documents?(se(1===(s=r.query).documents.length),ut($n(mo(s.documents[0])))):function(s){return ut(yo(s))}(r.query),new sn(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Ge.fromBase64String(r.resumeToken));var s}function wl(r,e){const t=Jn(e.snapshotVersion),n=Jn(e.lastLimboFreeSnapshotVersion);let i;i=ei(e.target)?Ka(r.ct,e.target):go(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:An(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Qa(r){const e=yo({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?ni(e,e.limit,"L"):e}function ts(r,e){return new ui(e.largestBatchId,za(r.ct,e.overlayMutation))}function Rl(r,e){const t=e.path.lastSegment();return[r,Ye(e.path.popLast()),t]}function Pl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Jn(n.readTime),documentKey:Ye(n.documentKey.path),largestBatchId:n.largestBatchId}}class Ha{getBundleMetadata(e,t){return Sl(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:Ar(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Sl(e).put({bundleId:(i=t).id,createTime:Jn(Ze(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return To(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:Qa(s.bundledQuery),readTime:Ar(s.readTime)};var s})}saveNamedQuery(e,t){return To(e).put({name:(i=t).name,readTime:Jn(Ze(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Sl(r){return it(r,"bundles")}function To(r){return it(r,"namedQueries")}class ci{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new ci(e,t.uid||"")}getOverlay(e,t){return Pr(e).get(Rl(this.userId,t)).next(n=>n?ts(this.serializer,n):null)}getOverlays(e,t){const n=dn();return M.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,l)=>{const h=new ui(t,l);i.push(this.ht(e,h))}),M.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(l=>i.add(Ye(l.getCollectionPath())));const s=[];return i.forEach(l=>{const h=IDBKeyRange.bound([this.userId,l,n],[this.userId,l,n+1],!1,!0);s.push(Pr(e).j("collectionPathOverlayIndex",h))}),M.waitFor(s)}getOverlaysForCollection(e,t,n){const i=dn(),s=Ye(t),l=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Pr(e).U("collectionPathOverlayIndex",l).next(h=>{for(const f of h){const m=ts(this.serializer,f);i.set(m.getKey(),m)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=dn();let l;const h=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Pr(e).J({index:"collectionGroupOverlayIndex",range:h},(f,m,I)=>{const T=ts(this.serializer,m);s.size()<i||T.largestBatchId===l?(s.set(T.getKey(),T),l=T.largestBatchId):I.done()}).next(()=>s)}ht(e,t){return Pr(e).put(function(i,s,l){const[h,f,m]=Rl(s,l.mutation.key);return{userId:s,collectionPath:f,documentId:m,collectionGroup:l.mutation.key.getCollectionGroup(),largestBatchId:l.largestBatchId,overlayMutation:Zi(i.ct,l.mutation)}}(this.serializer,this.userId,t))}}function Pr(r){return it(r,"documentOverlays")}class bl{Pt(e){return it(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=null==t?void 0:t.value;return n?Ge.fromUint8Array(n):Ge.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Sn{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ke(e.integerValue));else if("doubleValue"in e){const n=ke(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Qr(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Pt(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(yn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Ta(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Mi(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ne()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;const s=e.fields||{};this.dt(t,53);const l="value",h=(null===(i=null===(n=s[l].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(ke(h)),this.Vt(l,t),this.Tt(s[l],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),Y.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function yh(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function Ja(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const l=yh(255&n[s]);if(i+=l,8!==l)break}return i}(r);return Math.ceil(e/8)}Sn.vt=new Sn;class Cl{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{const i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const t=this.qt(e),n=Ja(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){const t=this.qt(e),n=Ja(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(s){const l=new DataView(new ArrayBuffer(8));return l.setFloat64(0,s,!1),new Uint8Array(l.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class Vl{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class Ih{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class hi{constructor(){this.jt=new Cl,this.Ht=new Vl(this.jt),this.Jt=new Ih(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class bn{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new bn(this.indexId,this.documentKey,this.arrayValue,n)}}function Yn(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=xl(r.arrayValue,e.arrayValue),0!==t?t:(t=xl(r.directionalValue,e.directionalValue),0!==t?t:Y.comparator(r.documentKey,e.documentKey)))}function xl(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class Dl{constructor(e){this.Xt=new Ce((t,n)=>Be.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(se(e.collectionGroup===this.collectionId),this.nn)return!1;const t=oa(e);if(void 0!==t&&!this.sn(t))return!1;const n=cr(e);let i=new Set,s=0,l=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){const h=this.Xt.getIterator().getNext();if(!i.has(h.field.canonicalString())){const f=n[s];if(!this.on(h,f)||!this._n(this.en[l++],f))return!1}++s}for(;s<n.length;++s)if(l>=this.en.length||!this._n(this.en[l++],n[s]))return!1;return!0}an(){if(this.nn)return null;let e=new Ce(Be.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new hr(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new hr(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new hr(n.field,"asc"===n.dir?0:1)));return new lr(lr.UNKNOWN_ID,this.collectionId,t,$r.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Ao(r){var e,t;if(se(r instanceof Ie||r instanceof Se),r instanceof Ie){if(r instanceof Yu){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Ie.create(r.field,"==",s)))||[];return Se.create(i,"or")}return r}const n=r.filters.map(i=>Ao(i));return Se.create(n,r.op)}function vh(r){if(0===r.getFilters().length)return[];const e=di(Ao(r));return se(Nl(e)),Ya(e)||wo(e)?[e]:e.getFilters()}function Ya(r){return r instanceof Ie}function wo(r){return r instanceof Se&&Li(r)}function Nl(r){return Ya(r)||wo(r)||function(t){if(t instanceof Se&&Pa(t)){for(const n of t.getFilters())if(!Ya(n)&&!wo(n))return!1;return!0}return!1}(r)}function di(r){if(se(r instanceof Ie||r instanceof Se),r instanceof Ie)return r;if(1===r.filters.length)return di(r.filters[0]);const e=r.filters.map(n=>di(n));let t=Se.create(e,r.op);return t=Ro(t),Nl(t)?t:(se(t instanceof Se),se(jn(t)),se(t.filters.length>1),t.filters.reduce((n,i)=>Xa(n,i)))}function Xa(r,e){let t;return se(r instanceof Ie||r instanceof Se),se(e instanceof Ie||e instanceof Se),t=r instanceof Ie?e instanceof Ie?Se.create([r,e],"and"):kl(r,e):e instanceof Ie?kl(e,r):function(i,s){if(se(i.filters.length>0&&s.filters.length>0),jn(i)&&jn(s))return Ys(i,s.getFilters());const l=Pa(i)?i:s,h=Pa(i)?s:i,f=l.filters.map(m=>Xa(m,h));return Se.create(f,"or")}(r,e),Ro(t)}function kl(r,e){if(jn(e))return Ys(e,r.getFilters());{const t=e.filters.map(n=>Xa(r,n));return Se.create(t,"or")}}function Ro(r){if(se(r instanceof Ie||r instanceof Se),r instanceof Ie)return r;const e=r.getFilters();if(1===e.length)return Ro(e[0]);if(Qu(r))return r;const t=e.map(i=>Ro(i)),n=[];return t.forEach(i=>{i instanceof Ie?n.push(i):i instanceof Se&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:Se.create(n,r.op)}class Eh{constructor(){this.un=new Za}addToCollectionParentIndex(e,t){return this.un.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(ft.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(ft.min())}updateCollectionGroup(e,t,n){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class Za{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Ce(Ee.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Ce(Ee.comparator)).toArray()}}const Po=new Uint8Array(0);class Th{constructor(e,t){this.databaseId=t,this.cn=new Za,this.ln=new wn(n=>An(n),(n,i)=>Ui(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const s={collectionId:n,parent:Ye(i)};return Ol(e).put(s)}return M.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Rs(t),""],!1,!0);return Ol(e).U(i).next(s=>{for(const l of s){if(l.collectionId!==t)break;n.push(cn(l.parent))}return n})}addFieldIndex(e,t){const n=ns(e),i={indexId:(h=t).indexId,collectionGroup:h.collectionGroup,fields:h.fields.map(f=>[f.fieldPath.canonicalString(),f.kind])};var h;delete i.indexId;const s=n.add(i);if(t.indexState){const l=fi(e);return s.next(h=>{l.put(Pl(h,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=ns(e),i=fi(e),s=Xn(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=ns(e),n=Xn(e),i=fi(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return M.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new Dl(n).an();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=Xn(e);let i=!0;const s=new Map;return M.forEach(this.hn(t),l=>this.Pn(e,l).next(h=>{i&&(i=!!h),s.set(l,h)})).next(()=>{if(i){let l=ge();const h=[];return M.forEach(s,(f,m)=>{var ae;K("IndexedDbIndexManager",`Using index ${ae=f,`id=${ae.indexId}|cg=${ae.collectionGroup}|f=${ae.fields.map(ie=>`${ie.fieldPath}:${ie.kind}`).join(",")}`} to execute ${An(t)}`);const I=function(ae,ie){const pe=oa(ie);if(void 0===pe)return null;for(const ce of Xs(ae,pe.fieldPath))switch(ce.op){case"array-contains-any":return ce.value.arrayValue.values||[];case"array-contains":return[ce.value]}return null}(m,f),T=function(ae,ie){const pe=new Map;for(const ce of cr(ie))for(const D of Xs(ae,ce.fieldPath))switch(D.op){case"==":case"in":pe.set(ce.fieldPath.canonicalString(),D.value);break;case"not-in":case"!=":return pe.set(ce.fieldPath.canonicalString(),D.value),Array.from(pe.values())}return null}(m,f),P=function(ae,ie){const pe=[];let ce=!0;for(const D of cr(ie)){const R=0===D.kind?Zs(ae,D.fieldPath,ae.startAt):Xu(ae,D.fieldPath,ae.startAt);pe.push(R.value),ce&&(ce=R.inclusive)}return new hn(pe,ce)}(m,f),k=function(ae,ie){const pe=[];let ce=!0;for(const D of cr(ie)){const R=0===D.kind?Xu(ae,D.fieldPath,ae.endAt):Zs(ae,D.fieldPath,ae.endAt);pe.push(R.value),ce&&(ce=R.inclusive)}return new hn(pe,ce)}(m,f),z=this.In(f,m,P),$=this.In(f,m,k),G=this.Tn(f,m,T),Z=this.En(f.indexId,I,z,P.inclusive,$,k.inclusive,G);return M.forEach(Z,oe=>n.G(oe,t.limit).next(ae=>{ae.forEach(ie=>{const pe=Y.fromSegments(ie.documentKey);l.has(pe)||(l=l.add(pe),h.push(pe))})}))}).next(()=>h)}return M.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:vh(Se.create(e.filters,"and")).map(n=>Da(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,l,h){const f=(null!=t?t.length:1)*Math.max(n.length,s.length),m=f/(null!=t?t.length:1),I=[];for(let T=0;T<f;++T){const P=t?this.dn(t[T/m]):Po,k=this.An(e,P,n[T%m],i),z=this.Rn(e,P,s[T%m],l),$=h.map(G=>this.An(e,P,G,!0));I.push(...this.createRange(k,z,$))}return I}An(e,t,n,i){const s=new bn(e,Y.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){const s=new bn(e,Y.empty(),t,n);return i?s.Zt():s}Pn(e,t){const n=new Dl(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let l=null;for(const h of s)n.rn(h)&&(!l||h.fields.length>l.fields.length)&&(l=h);return l})}getIndexType(e,t){let n=2;const i=this.hn(t);return M.forEach(i,s=>this.Pn(e,s).next(l=>{l?0!==n&&l.fields.length<function(f){let m=new Ce(Be.comparator),I=!1;for(const T of f.filters)for(const P of T.getFlattenedFilters())P.field.isKeyField()||("array-contains"===P.op||"array-contains-any"===P.op?I=!0:m=m.add(P.field));for(const T of f.orderBy)T.field.isKeyField()||(m=m.add(T.field));return m.size+(I?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Vn(e,t){const n=new hi;for(const i of cr(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const l=n.Yt(i.kind);Sn.vt.It(s,l)}return n.zt()}dn(e){const t=new hi;return Sn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new hi;return Sn.vt.It(pr(this.databaseId,t),n.Yt(function(s){const l=cr(s);return 0===l.length?0:l[l.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(null===n)return[];let i=[];i.push(new hi);let s=0;for(const l of cr(e)){const h=n[s++];for(const f of i)if(this.fn(t,l.fieldPath)&&mr(h))i=this.gn(i,l,h);else{const m=f.Yt(l.kind);Sn.vt.It(h,m)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const i=[...e],s=[];for(const l of n.arrayValue.values||[])for(const h of i){const f=new hi;f.seed(h.zt()),Sn.vt.It(l,f.Yt(t.kind)),s.push(f)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof Ie&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=ns(e),i=fi(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const l=[];return M.forEach(s,h=>i.get([h.indexId,this.uid]).next(f=>{l.push(function(I,T){const P=T?new $r(T.sequenceNumber,new ft(Ar(T.readTime),new Y(cn(T.documentKey)),T.largestBatchId)):$r.empty(),k=I.fields.map(([z,$])=>new hr(Be.fromServerFormat(z),$));return new lr(I.indexId,I.collectionGroup,k,P)}(h,f))})).next(()=>l)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:he(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=ns(e),s=fi(e);return this.yn(e).next(l=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>M.forEach(h,f=>s.put(Pl(f.indexId,this.uid,l,n)))))}updateIndexEntries(e,t){const n=new Map;return M.forEach(t,(i,s)=>{const l=n.get(i.collectionGroup);return(l?M.resolve(l):this.getFieldIndexes(e,i.collectionGroup)).next(h=>(n.set(i.collectionGroup,h),M.forEach(h,f=>this.wn(e,i,f).next(m=>{const I=this.Sn(s,f);return m.isEqual(I)?M.resolve():this.bn(e,s,f,m,I)}))))})}Dn(e,t,n,i){return Xn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return Xn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const i=Xn(e);let s=new Ce(Yn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(l,h)=>{s=s.add(new bn(n.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>s)}Sn(e,t){let n=new Ce(Yn);const i=this.Vn(t,e);if(null==i)return n;const s=oa(t);if(null!=s){const l=e.data.field(s.fieldPath);if(mr(l))for(const h of l.arrayValue.values||[])n=n.add(new bn(t.indexId,e.key,this.dn(h),i))}else n=n.add(new bn(t.indexId,e.key,Po,i));return n}bn(e,t,n,i,s){K("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const l=[];return function(f,m,I,T,P){const k=f.getIterator(),z=m.getIterator();let $=Jr(k),G=Jr(z);for(;$||G;){let Z=!1,oe=!1;if($&&G){const ae=I($,G);ae<0?oe=!0:ae>0&&(Z=!0)}else null!=$?oe=!0:Z=!0;Z?(T(G),G=Jr(z)):oe?(P($),$=Jr(k)):($=Jr(k),G=Jr(z))}}(i,s,Yn,h=>{l.push(this.Dn(e,t,n,h))},h=>{l.push(this.vn(e,t,n,h))}),M.waitFor(l)}yn(e){let t=1;return fi(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((l,h)=>Yn(l,h)).filter((l,h,f)=>!h||0!==Yn(l,f[h-1]));const i=[];i.push(e);for(const l of n){const h=Yn(l,e),f=Yn(l,t);if(0===h)i[0]=e.Zt();else if(h>0&&f<0)i.push(l),i.push(l.Zt());else if(f>0)break}i.push(t);const s=[];for(let l=0;l<i.length;l+=2){if(this.Cn(i[l],i[l+1]))return[];s.push(IDBKeyRange.bound([i[l].indexId,this.uid,i[l].arrayValue,i[l].directionalValue,Po,[]],[i[l+1].indexId,this.uid,i[l+1].arrayValue,i[l+1].directionalValue,Po,[]]))}return s}Cn(e,t){return Yn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ml)}getMinOffset(e,t){return M.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||ne())).next(Ml)}}function Ol(r){return it(r,"collectionParents")}function Xn(r){return it(r,"indexEntries")}function ns(r){return it(r,"indexConfiguration")}function fi(r){return it(r,"indexState")}function Ml(r){se(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;la(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new ft(e.readTime,e.documentKey,t)}const Ll={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class gt{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new gt(e,gt.DEFAULT_COLLECTION_PERCENTILE,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function eu(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],l=IDBKeyRange.only(t.batchId);let h=0;const f=n.J({range:l},(I,T,P)=>(h++,P.delete()));s.push(f.next(()=>{se(1===h)}));const m=[];for(const I of t.mutations){const T=Ds(e,I.key.path,t.batchId);s.push(i.delete(T)),m.push(I.key)}return M.waitFor(s).next(()=>m)}function So(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw ne();e=r.noDocument}return JSON.stringify(e).length}gt.DEFAULT_COLLECTION_PERCENTILE=10,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gt.DEFAULT=new gt(41943040,gt.DEFAULT_COLLECTION_PERCENTILE,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gt.DISABLED=new gt(-1,0,0);class bo{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){se(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new bo(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Zn(e).J({index:"userMutationsIndex",range:n},(i,s,l)=>{t=!1,l.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=pi(e),l=Zn(e);return l.add({}).next(h=>{se("number"==typeof h);const f=new lo(h,t,n,i),m=function(k,z,$){const G=$.baseMutations.map(oe=>Zi(k.ct,oe)),Z=$.mutations.map(oe=>Zi(k.ct,oe));return{userId:z,batchId:$.batchId,localWriteTimeMs:$.localWriteTime.toMillis(),baseMutations:G,mutations:Z}}(this.serializer,this.userId,f),I=[];let T=new Ce((P,k)=>he(P.canonicalString(),k.canonicalString()));for(const P of i){const k=Ds(this.userId,P.key.path,h);T=T.add(P.key.path.popLast()),I.push(l.put(m)),I.push(s.put(k,Wc))}return T.forEach(P=>{I.push(this.indexManager.addToCollectionParentIndex(e,P))}),e.addOnCommittedListener(()=>{this.Fn[h]=f.keys()}),M.waitFor(I).next(()=>f)})}lookupMutationBatch(e,t){return Zn(e).get(t).next(n=>n?(se(n.userId===this.userId),wr(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?M.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Zn(e).J({index:"userMutationsIndex",range:i},(l,h,f)=>{h.userId===this.userId&&(se(h.batchId>=n),s=wr(this.serializer,h)),f.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Zn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,l)=>{n=s.batchId,l.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Zn(e).U("userMutationsIndex",t).next(n=>n.map(i=>wr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=xs(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return pi(e).J({range:i},(l,h,f)=>{const[m,I,T]=l,P=cn(I);if(m===this.userId&&t.path.isEqual(P))return Zn(e).get(T).next(k=>{if(!k)throw ne();se(k.userId===this.userId),s.push(wr(this.serializer,k))});f.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ce(he);const i=[];return t.forEach(s=>{const l=xs(this.userId,s.path),h=IDBKeyRange.lowerBound(l),f=pi(e).J({range:h},(m,I,T)=>{const[P,k,z]=m,$=cn(k);P===this.userId&&s.path.isEqual($)?n=n.add(z):T.done()});i.push(f)}),M.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=xs(this.userId,n),l=IDBKeyRange.lowerBound(s);let h=new Ce(he);return pi(e).J({range:l},(f,m,I)=>{const[T,P,k]=f,z=cn(P);T===this.userId&&n.isPrefixOf(z)?z.length===i&&(h=h.add(k)):I.done()}).next(()=>this.xn(e,h))}xn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(Zn(e).get(s).next(l=>{if(null===l)throw ne();se(l.userId===this.userId),n.push(wr(this.serializer,l))}))}),M.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return eu(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),M.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return M.resolve();const n=IDBKeyRange.lowerBound(function(l){return[l]}(this.userId)),i=[];return pi(e).J({range:n},(s,l,h)=>{if(s[0]===this.userId){const f=cn(s[1]);i.push(f)}else h.done()}).next(()=>{se(0===i.length)})})}containsKey(e,t){return Fl(e,this.userId,t)}Nn(e){return Co(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Fl(r,e,t){const n=xs(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let l=!1;return pi(r).J({range:s,H:!0},(h,f,m)=>{const[I,T,P]=h;I===e&&T===i&&(l=!0),m.done()}).next(()=>l)}function Zn(r){return it(r,"mutations")}function pi(r){return it(r,"documentMutations")}function Co(r){return it(r,"mutationQueues")}class Cn{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Cn(0)}static kn(){return new Cn(-1)}}class Ah{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new Cn(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>ue.fromTimestamp(new Ue(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>er(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(se(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return er(e).J((l,h)=>{const f=Rr(h);f.sequenceNumber<=t&&null===n.get(f.targetId)&&(i++,s.push(this.removeTargetData(e,f)))}).next(()=>M.waitFor(s)).next(()=>i)}forEachTarget(e,t){return er(e).J((n,i)=>{const s=Rr(i);t(s)})}qn(e){return Ul(e).get("targetGlobalKey").next(t=>(se(null!==t),t))}Qn(e,t){return Ul(e).put("targetGlobalKey",t)}Kn(e,t){return er(e).put(wl(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=An(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return er(e).J({range:i,index:"queryTargetsIndex"},(l,h,f)=>{const m=Rr(h);Ui(t,m.target)&&(s=m,f.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Vn(e);return t.forEach(l=>{const h=Ye(l.path);i.push(s.put({targetId:n,path:h})),i.push(this.referenceDelegate.addReference(e,n,l))}),M.waitFor(i)}removeMatchingKeys(e,t,n){const i=Vn(e);return M.forEach(t,s=>{const l=Ye(s.path);return M.waitFor([i.delete([n,l]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Vn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Vn(e);let s=ge();return i.J({range:n,H:!0},(l,h,f)=>{const m=cn(l[1]),I=new Y(m);s=s.add(I)}).next(()=>s)}containsKey(e,t){const n=Ye(t.path),i=IDBKeyRange.bound([n],[Rs(n)],!1,!0);let s=0;return Vn(e).J({index:"documentTargetsIndex",H:!0,range:i},([l,h],f,m)=>{0!==l&&(s++,m.done())}).next(()=>s>0)}ot(e,t){return er(e).get(t).next(n=>n?Rr(n):null)}}function er(r){return it(r,"targets")}function Ul(r){return it(r,"targetGlobal")}function Vn(r){return it(r,"targetDocuments")}function tu([r,e],[t,n]){const i=he(r,t);return 0===i?he(e,n):i}class nu{constructor(e){this.Un=e,this.buffer=new Ce(tu),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();tu(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Bl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){var t=this;K("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,y.A)(function*(){t.jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){$t(n)?K("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield zn(n)}yield t.Hn(3e5)}))}}class $f{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return M.resolve(wt.oe);const n=new nu(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(Ll)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ll):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,l,h,f,m;const I=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(T=>(T>this.params.maximumSequenceNumbersToCollect?(K("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${T}`),i=this.params.maximumSequenceNumbersToCollect):i=T,l=Date.now(),this.nthSequenceNumber(e,i))).next(T=>(n=T,h=Date.now(),this.removeTargets(e,n,t))).next(T=>(s=T,f=Date.now(),this.removeOrphanedDocuments(e,n))).next(T=>(m=Date.now(),Bn()<=At.$b.DEBUG&&K("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${l-I}ms\n\tDetermined least recently used ${i} in `+(h-l)+`ms\n\tRemoved ${s} targets in `+(f-h)+`ms\n\tRemoved ${T} documents in `+(m-f)+`ms\nTotal Duration: ${m-I}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:T})))}}class ql{constructor(e,t){this.db=e,this.garbageCollector=function Vo(r,e){return new $f(r,e)}(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return Sr(e,n)}removeReference(e,t,n){return Sr(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Sr(e,t)}nr(e,t){return function(i,s){let l=!1;return Co(i).Y(h=>Fl(i,h,s).next(f=>(f&&(l=!0),M.resolve(!f)))).next(()=>l)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.tr(e,(l,h)=>{if(h<=t){const f=this.nr(e,l).next(m=>{if(!m)return s++,n.getEntry(e,l).next(()=>(n.removeEntry(l,ue.min()),Vn(e).delete([0,Ye(l.path)])))});i.push(f)}}).next(()=>M.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Sr(e,t)}tr(e,t){const n=Vn(e);let i,s=wt.oe;return n.J({index:"documentTargetsIndex"},([l,h],{path:f,sequenceNumber:m})=>{0===l?(s!==wt.oe&&t(new Y(cn(i)),s),s=m,i=f):s=wt.oe}).next(()=>{s!==wt.oe&&t(new Y(cn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Sr(r,e){return Vn(r).put((i=r.currentSequenceNumber,{targetId:0,path:Ye(e.path),sequenceNumber:i}));var i}class ru{constructor(){this.changes=new wn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?M.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zl{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return br(e).put(n)}removeEntry(e,t,n){return br(e).delete(function(s,l){const h=s.path.toArray();return[h.slice(0,h.length-2),h[h.length-2],es(l),h[h.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=qe.newInvalidDocument(t);return br(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(rs(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:qe.newInvalidDocument(t)};return br(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(rs(t))},(i,s)=>{n={document:this.ir(t,s),size:So(s)}}).next(()=>n)}getEntries(e,t){let n=Ot();return this._r(e,t,(i,s)=>{const l=this.ir(i,s);n=n.insert(i,l)}).next(()=>n)}ar(e,t){let n=Ot(),i=new Ne(Y.comparator);return this._r(e,t,(s,l)=>{const h=this.ir(s,l);n=n.insert(s,h),i=i.insert(s,So(l))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return M.resolve();let i=new Ce(Gl);t.forEach(f=>i=i.add(f));const s=IDBKeyRange.bound(rs(i.first()),rs(i.last())),l=i.getIterator();let h=l.getNext();return br(e).J({index:"documentKeyIndex",range:s},(f,m,I)=>{const T=Y.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;h&&Gl(h,T)<0;)n(h,null),h=l.getNext();h&&h.isEqual(T)&&(n(h,m),h=l.hasNext()?l.getNext():null),h?I.$(rs(h)):I.done()}).next(()=>{for(;h;)n(h,null),h=l.hasNext()?l.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const l=t.path,h=[l.popLast().toArray(),l.lastSegment(),es(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],f=[l.popLast().toArray(),l.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return br(e).U(IDBKeyRange.bound(h,f,!0)).next(m=>{null==s||s.incrementDocumentReadCount(m.length);let I=Ot();for(const T of m){const P=this.ir(Y.fromSegments(T.prefixPath.concat(T.collectionGroup,T.documentId)),T);P.isFoundDocument()&&(zi(t,P)||i.has(P.key))&&(I=I.insert(P.key,P))}return I})}getAllFromCollectionGroup(e,t,n,i){let s=Ot();const l=iu(t,n),h=iu(t,ft.max());return br(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(l,h,!0)},(f,m,I)=>{const T=this.ir(Y.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(T.key,T),s.size===i&&I.done()}).next(()=>s)}newChangeBuffer(e){return new wh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Kl(e).get("remoteDocumentGlobalKey").next(t=>(se(!!t),t))}rr(e,t){return Kl(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const n=function gh(r,e){let t;if(e.document)t=Qn(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=Y.fromSegments(e.noDocument.path),i=Ar(e.noDocument.readTime);t=qe.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ne();{const n=Y.fromSegments(e.unknownDocument.path),i=Ar(e.unknownDocument.version);t=qe.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Ue(i[0],i[1]);return ue.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(ue.min()))return n}return qe.newInvalidDocument(e)}}function Wl(r){return new zl(r)}class wh extends ru{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new wn(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new Ce((s,l)=>he(s.canonicalString(),l.canonicalString()));return this.changes.forEach((s,l)=>{const h=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,h.readTime)),l.isValidDocument()){const f=$a(this.cr.serializer,l);i=i.add(s.path.popLast());const m=So(f);n+=m-h.size,t.push(this.cr.addEntry(e,s,f))}else if(n-=h.size,this.trackRemovals){const f=$a(this.cr.serializer,l.convertToNoDocument(ue.min()));t.push(this.cr.addEntry(e,s,f))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),M.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,l)=>{this.lr.set(s,{size:l,readTime:n.get(s).readTime})}),n))}}function Kl(r){return it(r,"remoteDocumentGlobal")}function br(r){return it(r,"remoteDocumentsV14")}function rs(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function iu(r,e){const t=e.documentKey.path.toArray();return[r,es(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Gl(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=he(t[s],n[s]),i)return i;return i=he(t.length,n.length),i||(i=he(t[t.length-2],n[n.length-2]),i||he(t[t.length-1],n[n.length-1]))}class Rh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class jl{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&je(n.mutation,i,Rt.empty(),Ue.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ge()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ge()){const i=dn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let l=Ir();return s.forEach((h,f)=>{l=l.insert(h,f.overlayedDocument)}),l}))}getOverlayedDocuments(e,t){const n=dn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ge()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((l,h)=>{t.set(l,h)})})}computeViews(e,t,n,i){let s=Ot();const l=to(),h=to();return t.forEach((f,m)=>{const I=n.get(m.key);i.has(m.key)&&(void 0===I||I.mutation instanceof rn)?s=s.insert(m.key,m):void 0!==I?(l.set(m.key,I.mutation.getFieldMask()),je(I.mutation,m,I.mutation.getFieldMask(),Ue.now())):l.set(m.key,Rt.empty())}),this.recalculateAndSaveOverlays(e,s).next(f=>(f.forEach((m,I)=>l.set(m,I)),t.forEach((m,I)=>{var T;return h.set(m,new Rh(I,null!==(T=l.get(m))&&void 0!==T?T:null))}),h))}recalculateAndSaveOverlays(e,t){const n=to();let i=new Ne((l,h)=>l-h),s=ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(l=>{for(const h of l)h.keys().forEach(f=>{const m=t.get(f);if(null===m)return;let I=n.get(f)||Rt.empty();I=h.applyToLocalView(m,I),n.set(f,I);const T=(i.get(h.batchId)||ge()).add(f);i=i.insert(h.batchId,T)})}).next(()=>{const l=[],h=i.getReverseIterator();for(;h.hasNext();){const f=h.getNext(),m=f.key,I=f.value,T=rh();I.forEach(P=>{if(!s.has(P)){const k=ii(t.get(P),n.get(P));null!==k&&T.set(P,k),s=s.add(P)}}),l.push(this.documentOverlayCache.saveOverlays(e,m,T))}return M.waitFor(l)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return Y.isDocumentKey((l=t).path)&&null===l.collectionGroup&&0===l.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Bi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var l}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const l=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):M.resolve(dn());let h=-1,f=s;return l.next(m=>M.forEach(m,(I,T)=>(h<T.largestBatchId&&(h=T.largestBatchId),s.get(I)?M.resolve():this.remoteDocumentCache.getEntry(e,I).next(P=>{f=f.insert(I,P)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,f,m,ge())).next(I=>({batchId:h,changes:sl(I)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Y(t)).next(n=>{let i=Ir();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let l=Ir();return this.indexManager.getCollectionParents(e,s).next(h=>M.forEach(h,f=>{const m=(T=t,P=f.child(s),new nn(P,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt));var T,P;return this.getDocumentsMatchingCollectionQuery(e,m,n,i).next(I=>{I.forEach((T,P)=>{l=l.insert(T,P)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(l=>(s=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(l=>{s.forEach((f,m)=>{const I=m.getKey();null===l.get(I)&&(l=l.insert(I,qe.newInvalidDocument(I)))});let h=Ir();return l.forEach((f,m)=>{const I=s.get(f);void 0!==I&&je(I.mutation,m,Rt.empty(),Ue.now()),zi(t,m)&&(h=h.insert(f,m))}),h})}}class c{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return M.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(i=t).id,version:i.version,createTime:Ze(i.createTime)}),M.resolve();var i}getNamedQuery(e,t){return M.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(i=t).name,query:Qa(i.bundledQuery),readTime:Ze(i.readTime)}),M.resolve();var i}}class o{constructor(){this.overlays=new Ne(Y.comparator),this.Ir=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const n=dn();return M.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),M.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ir.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),M.resolve()}getOverlaysForCollection(e,t,n){const i=dn(),s=t.length+1,l=new Y(t.child("")),h=this.overlays.getIteratorFrom(l);for(;h.hasNext();){const f=h.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&f.largestBatchId>n&&i.set(f.getKey(),f)}return M.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Ne((m,I)=>m-I);const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>n){let I=s.get(m.largestBatchId);null===I&&(I=dn(),s=s.insert(m.largestBatchId,I)),I.set(m.getKey(),m)}}const h=dn(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((m,I)=>h.set(m,I)),!(h.size()>=i)););return M.resolve(h)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const l=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(n.key,new ui(t,n));let s=this.Ir.get(t);void 0===s&&(s=ge(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}}class a{constructor(){this.sessionToken=Ge.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}}class d{constructor(){this.Tr=new Ce(_.Er),this.dr=new Ce(_.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new _(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new _(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new Y(new Ee([])),n=new _(t,e),i=new _(t,e+1),s=[];return this.dr.forEachInRange([n,i],l=>{this.Vr(l),s.push(l.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Y(new Ee([])),n=new _(t,e),i=new _(t,e+1);let s=ge();return this.dr.forEachInRange([n,i],l=>{s=s.add(l.key)}),s}containsKey(e){const t=new _(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class _{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Y.comparator(e.key,t.key)||he(e.wr,t.wr)}static Ar(e,t){return he(e.wr,t.wr)||Y.comparator(e.key,t.key)}}class v{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ce(_.Er)}checkEmpty(e){return M.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.Sr;this.Sr++;const l=new lo(s,t,n,i);this.mutationQueue.push(l);for(const h of i)this.br=this.br.add(new _(h.key,s)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return M.resolve(l)}lookupMutationBatch(e,t){return M.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.vr(t+1),s=i<0?0:i;return M.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new _(t,0),i=new _(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],l=>{const h=this.Dr(l.wr);s.push(h)}),M.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ce(he);return t.forEach(i=>{const s=new _(i,0),l=new _(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,l],h=>{n=n.add(h.wr)})}),M.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;Y.isDocumentKey(s)||(s=s.child(""));const l=new _(new Y(s),0);let h=new Ce(he);return this.br.forEachWhile(f=>{const m=f.key.path;return!!n.isPrefixOf(m)&&(m.length===i&&(h=h.add(f.wr)),!0)},l),M.resolve(this.Cr(h))}Cr(e){const t=[];return e.forEach(n=>{const i=this.Dr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){se(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return M.forEach(t.mutations,i=>{const s=new _(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new _(t,0),i=this.br.firstAfterOrEqual(n);return M.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return M.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class x{constructor(e){this.Mr=e,this.docs=new Ne(Y.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,l=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:l}),this.size+=l-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return M.resolve(n?n.document.mutableCopy():qe.newInvalidDocument(t))}getEntries(e,t){let n=Ot();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():qe.newInvalidDocument(i))}),M.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Ot();const l=t.path,h=new Y(l.child("")),f=this.docs.getIteratorFrom(h);for(;f.hasNext();){const{key:m,value:{document:I}}=f.getNext();if(!l.isPrefixOf(m.path))break;m.path.length>l.length+1||la(ua(I),n)<=0||(i.has(I.key)||zi(t,I))&&(s=s.insert(I.key,I.mutableCopy()))}return M.resolve(s)}getAllFromCollectionGroup(e,t,n,i){ne()}Or(e,t){return M.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new U(this)}getSize(e){return M.resolve(this.size)}}class U extends ru{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),M.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class j{constructor(e){this.persistence=e,this.Nr=new wn(t=>An(t),Ui),this.lastRemoteSnapshotVersion=ue.min(),this.highestTargetId=0,this.Lr=0,this.Br=new d,this.targetCount=0,this.kr=Cn.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),M.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Cn(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.Kn(t),M.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Nr.forEach((l,h)=>{h.sequenceNumber<=t&&null===n.get(h.targetId)&&(this.Nr.delete(l),s.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)}),M.waitFor(s).next(()=>i)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return M.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),M.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(l=>{s.push(i.markPotentiallyOrphaned(e,l))}),M.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return M.resolve(n)}containsKey(e,t){return M.resolve(this.Br.containsKey(t))}}class re{constructor(e,t){this.qr={},this.overlays={},this.Qr=new wt(0),this.Kr=!1,this.Kr=!0,this.$r=new a,this.referenceDelegate=e(this),this.Ur=new j(this),this.indexManager=new Eh,this.remoteDocumentCache=new x(n=>this.referenceDelegate.Wr(n)),this.serializer=new Eo(t),this.Gr=new c(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new o,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new v(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){K("MemoryPersistence","Starting transaction:",e);const i=new le(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return M.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class le extends Bu{constructor(e){super(),this.currentSequenceNumber=e}}class ye{constructor(e){this.persistence=e,this.Jr=new d,this.Yr=null}static Zr(e){return new ye(e)}get Xr(){if(this.Yr)return this.Yr;throw ne()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),M.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),M.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.Xr,n=>{const i=Y.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,ue.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return M.or([()=>M.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class tr{constructor(e){this.serializer=e}O(e,t,n,i){const s=new Ss("createOrUpgrade",t);var f;n<1&&i>=1&&(e.createObjectStore("owner"),(f=e).createObjectStore("mutationQueues",{keyPath:"userId"}),f.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vs,{unique:!0}),f.createObjectStore("documentMutations"),is(e),function(f){f.createObjectStore("remoteDocuments")}(e));let l=M.resolve();return n<3&&i>=3&&(0!==n&&(function(f){f.deleteObjectStore("targetDocuments"),f.deleteObjectStore("targets"),f.deleteObjectStore("targetGlobal")}(e),is(e)),l=l.next(()=>function(f){const m=f.store("targetGlobal"),I={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ue.min().toTimestamp(),targetCount:0};return m.put("targetGlobalKey",I)}(s))),n<4&&i>=4&&(0!==n&&(l=l.next(()=>function(f,m){return m.store("mutations").U().next(I=>{f.deleteObjectStore("mutations"),f.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vs,{unique:!0});const T=m.store("mutations"),P=I.map(k=>T.put(k));return M.waitFor(P)})}(e,s))),l=l.next(()=>{!function(f){f.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(l=l.next(()=>this.ni(s))),n<6&&i>=6&&(l=l.next(()=>(function(f){f.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(l=l.next(()=>this.ii(s))),n<8&&i>=8&&(l=l.next(()=>this.si(e,s))),n<9&&i>=9&&(l=l.next(()=>{!function(f){f.objectStoreNames.contains("remoteDocumentChanges")&&f.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(l=l.next(()=>this.oi(s))),n<11&&i>=11&&(l=l.next(()=>{(function(f){f.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(f){f.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(l=l.next(()=>{!function(f){const m=f.createObjectStore("documentOverlays",{keyPath:Qc});m.createIndex("collectionPathOverlayIndex",va,{unique:!1}),m.createIndex("collectionGroupOverlayIndex",Hc,{unique:!1})}(e)})),n<13&&i>=13&&(l=l.next(()=>function(f){const m=f.createObjectStore("remoteDocumentsV14",{keyPath:pa});m.createIndex("documentKeyIndex",Kc),m.createIndex("collectionGroupIndex",ma)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(l=l.next(()=>this.ai(e,s))),n<15&&i>=15&&(l=l.next(()=>function(f){f.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),f.createObjectStore("indexState",{keyPath:jc}).createIndex("sequenceNumberIndex",ya,{unique:!1}),f.createObjectStore("indexEntries",{keyPath:$c}).createIndex("documentKeyIndex",Ia,{unique:!1})}(e))),n<16&&i>=16&&(l=l.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(l=l.next(()=>{!function(f){f.createObjectStore("globals",{keyPath:"name"})}(e)})),l}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=So(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>M.forEach(i,s=>{const l=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",l).next(h=>M.forEach(h,f=>{se(f.userId===s.userId);const m=wr(this.serializer,f);return eu(e,s.userId,m).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((l,h)=>{const f=new Ee(l),m=[0,Ye(f)];s.push(t.get(m).next(I=>I?M.resolve():t.put({targetId:0,path:Ye(f),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>M.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:ga});const n=t.store("collectionParents"),i=new Za,s=l=>{if(i.add(l)){const h=l.lastSegment(),f=l.popLast();return n.put({collectionId:h,parent:Ye(f)})}};return t.store("remoteDocuments").J({H:!0},(l,h)=>{const f=new Ee(l);return s(f.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([l,h,f],m)=>{const I=cn(h);return s(I.popLast())}))}oi(e){const t=e.store("targets");return t.J((n,i)=>{const s=Rr(i),l=wl(this.serializer,s);return t.put(l)})}_i(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,l)=>{const h=t.store("remoteDocumentsV14"),f=(T=l,T.document?new Y(Ee.fromString(T.document.name).popFirst(5)):T.noDocument?Y.fromSegments(T.noDocument.path):T.unknownDocument?Y.fromSegments(T.unknownDocument.path):ne()).path.toArray(),m={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:l.readTime||[0,0],unknownDocument:l.unknownDocument,noDocument:l.noDocument,document:l.document,hasCommittedMutations:!!l.hasCommittedMutations};var T;i.push(h.put(m))}).next(()=>M.waitFor(i))}ai(e,t){const n=t.store("mutations"),i=Wl(this.serializer),s=new re(ye.Zr,this.serializer.ct);return n.U().next(l=>{const h=new Map;return l.forEach(f=>{var m;let I=null!==(m=h.get(f.userId))&&void 0!==m?m:ge();wr(this.serializer,f).keys().forEach(T=>I=I.add(T)),h.set(f.userId,I)}),M.forEach(h,(f,m)=>{const I=new _e(m),T=ci.lt(this.serializer,I),P=s.getIndexManager(I),k=bo.lt(I,this.serializer,P,s.referenceDelegate);return new jl(i,k,T,P).recalculateAndSaveOverlaysForDocumentKeys(new Qt(t,wt.oe),f).next()})})}}function is(r){r.createObjectStore("targetDocuments",{keyPath:_a}).createIndex("documentTargetsIndex",Gc,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ns,{unique:!0}),r.createObjectStore("targetGlobal")}const xo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ss{constructor(e,t,n,i,s,l,h,f,m,I,T=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=l,this.document=h,this.ci=m,this.li=I,this.hi=T,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=P=>Promise.resolve(),!ss.D())throw new A(B.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ql(this,i),this.Ai=t+"main",this.serializer=new Eo(f),this.Ri=new ln(this.Ai,this.hi,new tr(this.serializer)),this.$r=new bl,this.Ur=new Ah(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Wl(this.serializer),this.Gr=new Ha,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===I&&Me("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new A(B.FAILED_PRECONDITION,xo);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new wt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){var t=this;return this.di=function(){var n=(0,y.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(function(){var t=(0,y.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((0,y.A)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>os(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if($t(e))return K("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return K("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return mi(e).get("owner").next(t=>M.resolve(this.vi(t)))}Ci(e){return os(e).delete(this.clientId)}Fi(){var e=this;return(0,y.A)(function*(){if(e.isPrimary&&!e.Mi(e.Ei,18e5)){e.Ei=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=it(n,"clientMetadata");return i.U().next(s=>{const l=e.xi(s,18e5),h=s.filter(f=>-1===l.indexOf(f));return M.forEach(h,f=>i.delete(f.clientId)).next(()=>h)})}).catch(()=>[]);if(e.Vi)for(const n of t)e.Vi.removeItem(e.Oi(n.clientId))}})()}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?M.resolve(!0):mi(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new A(B.FAILED_PRECONDITION,xo);return!1}}return!(!this.networkEnabled||!this.inForeground)||os(e).U().next(n=>void 0===this.xi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&K("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,y.A)(function*(){e.Kr=!1,e.Li(),e.Ti&&(e.Ti.cancel(),e.Ti=null),e.Bi(),e.ki(),yield e.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new Qt(t,wt.oe);return e.bi(n).next(()=>e.Ci(n))}),e.Ri.close(),e.qi()})()}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>os(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return bo.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Th(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ci.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){K("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=17===(f=this.hi)?Yc:16===f?Ea:15===f?en:14===f?Hr:13===f?Os:12===f?Jc:11===f?ks:void ne();var f;let l;return this.Ri.runTransaction(e,i,s,h=>(l=new Qt(h,this.Qr?this.Qr.next():wt.oe),"readwrite-primary"===t?this.wi(l).next(f=>!!f||this.Si(l)).next(f=>{if(!f)throw Me(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new A(B.FAILED_PRECONDITION,Ps);return n(l)}).next(f=>this.Di(l).next(()=>f)):this.Ki(l).next(()=>n(l)))).then(h=>(l.raiseOnCommittedEvent(),h))}Ki(e){return mi(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new A(B.FAILED_PRECONDITION,xo)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return mi(e).put("owner",t)}static D(){return ln.D()}bi(e){const t=mi(e);return t.get("owner").next(n=>this.vi(n)?(K("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):M.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t||e>n&&(Me(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;(0,me.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return K("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Me("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Me("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function mi(r){return it(r,"owner")}function os(r){return it(r,"clientMetadata")}function as(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Do{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=ge(),i=ge();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Do(e,t.fromCache,n,i)}}class $l{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class No{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,me.nr)()?8:ha((0,me.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Yi(e,t).next(l=>{s.result=l}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(l=>{s.result=l})}).next(()=>{if(s.result)return;const l=new $l;return this.Xi(e,t,l).next(h=>{if(s.result=h,this.zi)return this.es(e,t,l,h.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(Bn()<=At.$b.DEBUG&&K("QueryEngine","SDK will not create cache indexes for query:",yr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),M.resolve()):(Bn()<=At.$b.DEBUG&&K("QueryEngine","Query:",yr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(Bn()<=At.$b.DEBUG&&K("QueryEngine","The SDK decides to create cache indexes for query:",yr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ut(t))):M.resolve())}Yi(e,t){if(el(t))return M.resolve(null);let n=ut(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=ni(t,null,"F"),n=ut(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const l=ge(...s);return this.Ji.getDocuments(e,l).next(h=>this.indexManager.getMinOffset(e,n).next(f=>{const m=this.ts(t,h);return this.ns(t,m,l,f.readTime)?this.Yi(e,ni(t,null,"F")):this.rs(e,m,t,f)}))})))}Zi(e,t,n,i){return el(t)||i.isEqual(ue.min())?M.resolve(null):this.Ji.getDocuments(e,n).next(s=>{const l=this.ts(t,s);return this.ns(t,l,n,i)?M.resolve(null):(Bn()<=At.$b.DEBUG&&K("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),yr(t)),this.rs(e,l,t,Ke(i,-1)).next(h=>h))})}ts(e,t){let n=new Ce(il(e));return t.forEach((i,s)=>{zi(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return Bn()<=At.$b.DEBUG&&K("QueryEngine","Using full collection scan to execute query:",yr(t)),this.Ji.getDocumentsMatchingQuery(e,t,ft.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(l=>{s=s.insert(l.key,l)}),s))}}class Ql{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new Ne(he),this._s=new wn(s=>An(s),Ui),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new jl(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Hl(r,e,t,n){return new Ql(r,e,t,n)}function ko(r,e){return su.apply(this,arguments)}function su(){return(su=(0,y.A)(function*(r,e){const t=J(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const l=[],h=[];let f=ge();for(const m of i){l.push(m.batchId);for(const I of m.mutations)f=f.add(I.key)}for(const m of s){h.push(m.batchId);for(const I of m.mutations)f=f.add(I.key)}return t.localDocuments.getDocuments(n,f).next(m=>({hs:m,removedBatchIds:l,addedBatchIds:h}))})})})).apply(this,arguments)}function Qf(r){const e=J(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Hf(r,e,t){let n=ge(),i=ge();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let l=Ot();return t.forEach((h,f)=>{const m=s.get(h);f.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(h)),f.isNoDocument()&&f.version.isEqual(ue.min())?(e.removeEntry(h,f.readTime),l=l.insert(h,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||0===f.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(f),l=l.insert(h,f)):K("LocalStore","Ignoring outdated watch update for ",h,". Current version:",m.version," Watch version:",f.version)}),{Ps:l,Is:i}})}function N_(r,e){const t=J(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Oo(r,e){const t=J(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,M.resolve(i)):t.Ur.allocateTargetId(n).next(l=>(i=new sn(e,l,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.os.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function Mo(r,e,t){return Ph.apply(this,arguments)}function Ph(){return(Ph=(0,y.A)(function*(r,e,t){const n=J(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,l=>n.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!$t(l))throw l;K("LocalStore",`Failed to update sequence numbers for target ${e}: ${l}`)}n.os=n.os.remove(e),n._s.delete(i.target)})).apply(this,arguments)}function Jl(r,e,t){const n=J(r);let i=ue.min(),s=ge();return n.persistence.runTransaction("Execute query","readwrite",l=>function(f,m,I){const T=J(f),P=T._s.get(I);return void 0!==P?M.resolve(T.os.get(P)):T.Ur.getTargetData(m,I)}(n,l,ut(e)).next(h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(l,h.targetId).next(f=>{s=f})}).next(()=>n.ss.getDocumentsMatchingQuery(l,e,t?i:ue.min(),t?s:ge())).next(h=>(Xf(n,rl(e),h),{documents:h,Ts:s})))}function Jf(r,e){const t=J(r),n=J(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(l=>l?l.target:null))}function Yf(r,e){const t=J(r),n=t.us.get(e)||ue.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,Ke(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Xf(t,e,i),i))}function Xf(r,e,t){let n=r.us.get(e)||ue.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function Sh(){return(Sh=(0,y.A)(function*(r,e,t,n){const i=J(r);let s=ge(),l=Ot();for(const m of t){const I=e.Es(m.metadata.name);m.document&&(s=s.add(I));const T=e.ds(m);T.setReadTime(e.As(m.metadata.readTime)),l=l.insert(I,T)}const h=i.cs.newChangeBuffer({trackRemovals:!0}),f=yield Oo(i,(I=n,ut($n(Ee.fromString(`__bundle__/docs/${I}`)))));var I;return i.persistence.runTransaction("Apply bundle documents","readwrite",m=>Hf(m,h,l).next(I=>(h.apply(m),I)).next(I=>i.Ur.removeMatchingKeysForTargetId(m,f.targetId).next(()=>i.Ur.addMatchingKeys(m,s,f.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(m,I.Ps,I.Is)).next(()=>I.Ps)))})).apply(this,arguments)}function O_(r,e){return bh.apply(this,arguments)}function bh(){return(bh=(0,y.A)(function*(r,e,t=ge()){const n=yield Oo(r,ut(Qa(e.bundledQuery))),i=J(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const l=Ze(e.readTime);if(n.snapshotVersion.compareTo(l)>=0)return i.Gr.saveNamedQuery(s,e);const h=n.withResumeToken(Ge.EMPTY_BYTE_STRING,l);return i.os=i.os.insert(h.targetId,h),i.Ur.updateTargetData(s,h).next(()=>i.Ur.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Ur.addMatchingKeys(s,t,n.targetId)).next(()=>i.Gr.saveNamedQuery(s,e))})})).apply(this,arguments)}function Zf(r,e){return`firestore_clients_${r}_${e}`}function ep(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Ch(r,e){return`firestore_targets_${r}_${e}`}class Yl{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){const i=JSON.parse(n);let s,l="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return l&&i.error&&(l="string"==typeof i.error.message&&"string"==typeof i.error.code,l&&(s=new A(i.error.code,i.error.message))),l?new Yl(e,t,i.state,s):(Me("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ou{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new A(n.error.code,n.error.message))),s?new ou(e,n.state,i):(Me("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=Wi();for(let l=0;i&&l<n.activeTargetIds.length;++l)i=Wu(n.activeTargetIds[l]),s=s.add(n.activeTargetIds[l]);return i?new Xl(e,s):(Me("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Vh{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Vh(t.clientId,t.onlineState):(Me("SharedClientState",`Failed to parse online state: ${e}`),null)}}class xh{constructor(){this.activeTargetIds=Wi()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Dh{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ne(he),this.started=!1,this.bs=[];const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=Zf(this.persistenceKey,this.ps),this.vs=`firestore_sequence_number_${this.persistenceKey}`,this.Ss=this.Ss.insert(this.ps,new xh),this.Cs=new RegExp(`^firestore_clients_${l}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${l}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${l}_(\\d+)$`),this.xs=`firestore_online_state_${this.persistenceKey}`,this.Os=function(f){return`firestore_bundle_loaded_v2_${f}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,y.A)(function*(){const t=yield e.syncEngine.Qi();for(const i of t){if(i===e.ps)continue;const s=e.getItem(Zf(e.persistenceKey,i));if(s){const l=Xl.Rs(i,s);l&&(e.Ss=e.Ss.insert(l.clientId,l))}}e.Ns();const n=e.storage.getItem(e.xs);if(n){const i=e.Ls(n);i&&e.Bs(i)}for(const i of e.bs)e.ws(i);e.bs=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Ch(this.persistenceKey,e));if(n){const i=ou.Rs(e,n);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ch(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return K("SharedClientState","READ",e,t),t}setItem(e,t){K("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){K("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){var t=this;const n=e;if(n.storageArea===this.storage){if(K("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void Me("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable((0,y.A)(function*(){if(t.started){if(null!==n.key)if(t.Cs.test(n.key)){if(null==n.newValue){const i=t.Gs(n.key);return t.zs(i,null)}{const i=t.js(n.key,n.newValue);if(i)return t.zs(i.clientId,i)}}else if(t.Fs.test(n.key)){if(null!==n.newValue){const i=t.Hs(n.key,n.newValue);if(i)return t.Js(i)}}else if(t.Ms.test(n.key)){if(null!==n.newValue){const i=t.Ys(n.key,n.newValue);if(i)return t.Zs(i)}}else if(n.key===t.xs){if(null!==n.newValue){const i=t.Ls(n.newValue);if(i)return t.Bs(i)}}else if(n.key===t.vs){const i=function(l){let h=wt.oe;if(null!=l)try{const f=JSON.parse(l);se("number"==typeof f),h=f}catch(f){Me("SharedClientState","Failed to read sequence number from WebStorage",f)}return h}(n.newValue);i!==wt.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Os){const i=t.Xs(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.eo(s)))}}else t.bs.push(n)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){const i=new Yl(this.currentUser,e,t,n),s=ep(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){const t=ep(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){this.storage.setItem(this.xs,JSON.stringify({clientId:this.ps,onlineState:e}))}$s(e,t,n){const i=Ch(this.persistenceKey,e),s=new ou(e,t,n);this.setItem(i,s.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const n=this.Gs(e);return Xl.Rs(n,t)}Hs(e,t){const n=this.Fs.exec(e),i=Number(n[1]);return Yl.Rs(new _e(void 0!==n[2]?n[2]:null),i,t)}Ys(e,t){const n=this.Ms.exec(e),i=Number(n[1]);return ou.Rs(i,t)}Ls(e){return Vh.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){var t=this;return(0,y.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.no(e.batchId,e.state,e.error);K("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),l=[],h=[];return s.forEach(f=>{i.has(f)||l.push(f)}),i.forEach(f=>{s.has(f)||h.push(f)}),this.syncEngine.io(l,h).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Wi();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class tp{constructor(){this.so=new xh,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new xh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class M_{_o(e){}shutdown(){}}class np{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){K("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){K("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Zl=null;function Nh(){return null===Zl?Zl=268435456+Math.round(2147483648*Math.random()):Zl++,"0x"+Zl.toString(16)}const L_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class F_{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const St="WebChannelConnection";class U_ extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,l){const h=Nh(),f=this.xo(t,n.toUriEncodedString());K("RestConnection",`Sending RPC '${t}' ${h}:`,f,i);const m={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(m,s,l),this.No(t,f,m,i).then(I=>(K("RestConnection",`Received RPC '${t}' ${h}: `,I),I),I=>{throw dt("RestConnection",`RPC '${t}' ${h} failed with error: `,I,"url: ",f,"request:",i),I})}Lo(t,n,i,s,l,h){return this.Mo(t,n,i,s,l)}Oo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Wt,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,l)=>t[l]=s),i&&i.headers.forEach((s,l)=>t[l]=s)}xo(t,n){return`${this.Do}/v1/${n}:${L_[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){const s=Nh();return new Promise((l,h)=>{const f=new Fn;f.setWithCredentials(!0),f.listenOnce(Un.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case zt.NO_ERROR:const I=f.getResponseJson();K(St,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(I)),l(I);break;case zt.TIMEOUT:K(St,`RPC '${e}' ${s} timed out`),h(new A(B.DEADLINE_EXCEEDED,"Request time out"));break;case zt.HTTP_ERROR:const T=f.getStatus();if(K(St,`RPC '${e}' ${s} failed with status:`,T,"response text:",f.getResponseText()),T>0){let P=f.getResponseJson();Array.isArray(P)&&(P=P[0]);const k=null==P?void 0:P.error;if(k&&k.status&&k.message){const z=function(G){const Z=G.toLowerCase().replace(/_/g,"-");return Object.values(B).indexOf(Z)>=0?Z:B.UNKNOWN}(k.status);h(new A(z,k.message))}else h(new A(B.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new A(B.UNAVAILABLE,"Connection failed."));break;default:ne()}}finally{K(St,`RPC '${e}' ${s} completed.`)}});const m=JSON.stringify(i);K(St,`RPC '${e}' ${s} sending request:`,i),f.send(t,"POST",m,n,15)})}Bo(e,t,n){const i=Nh(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=or(),h=Gr(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;void 0!==m&&(f.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(f.xmlHttpFactory=new Vi({})),this.Oo(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;const I=s.join("");K(St,`Creating RPC '${e}' stream ${i}: ${I}`,f);const T=l.createWebChannel(I,f);let P=!1,k=!1;const z=new F_({Io:G=>{k?K(St,`Not sending because RPC '${e}' stream ${i} is closed:`,G):(P||(K(St,`Opening RPC '${e}' stream ${i} transport.`),T.open(),P=!0),K(St,`RPC '${e}' stream ${i} sending:`,G),T.send(G))},To:()=>T.close()}),$=(G,Z,oe)=>{G.listen(Z,ae=>{try{oe(ae)}catch(ie){setTimeout(()=>{throw ie},0)}})};return $(T,un.EventType.OPEN,()=>{k||(K(St,`RPC '${e}' stream ${i} transport opened.`),z.yo())}),$(T,un.EventType.CLOSE,()=>{k||(k=!0,K(St,`RPC '${e}' stream ${i} transport closed`),z.So())}),$(T,un.EventType.ERROR,G=>{k||(k=!0,dt(St,`RPC '${e}' stream ${i} transport errored:`,G),z.So(new A(B.UNAVAILABLE,"The operation could not be completed")))}),$(T,un.EventType.MESSAGE,G=>{var Z;if(!k){const oe=G.data[0];se(!!oe);const ie=oe.error||(null===(Z=oe[0])||void 0===Z?void 0:Z.error);if(ie){K(St,`RPC '${e}' stream ${i} received error:`,ie);const pe=ie.status;let ce=function(V){const N=Xe[V];if(void 0!==N)return co(N)}(pe),D=ie.message;void 0===ce&&(ce=B.INTERNAL,D="Unknown error status: "+pe+" with message "+ie.message),k=!0,z.So(new A(ce,D)),T.close()}else K(St,`RPC '${e}' stream ${i} received:`,oe),z.bo(oe)}}),$(h,Kr.STAT_EVENT,G=>{G.stat===Wr.PROXY?K(St,`RPC '${e}' stream ${i} detected buffering proxy`):G.stat===Wr.NOPROXY&&K(St,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{z.wo()},0),z}}function rp(){return typeof window<"u"?window:null}function ec(){return typeof document<"u"?document:null}function au(r){return new Il(r,!0)}class kh{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&K("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class ip{constructor(e,t,n,i,s,l,h,f){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=h,this.listener=f,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new kh(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,y.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,y.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,y.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===B.RESOURCE_EXHAUSTED?(Me(t.toString()),Me("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===B.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{const i=new A(B.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.e_?this.E_(i):this.onNext(i))})}i_(){var e=this;this.state=5,this.t_.Go((0,y.A)(function*(){e.state=0,e.start()}))}I_(e){return K("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(K("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class B_ extends ip{constructor(e,t,n,i,s,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,l),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function fh(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(m=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===m?1:"REMOVE"===m?2:"CURRENT"===m?3:"RESET"===m?4:ne(),i=e.targetChange.targetIds||[],s=function(m,I){return m.useProto3Json?(se(void 0===I||"string"==typeof I),Ge.fromBase64String(I||"")):(se(void 0===I||I instanceof Buffer||I instanceof Uint8Array),Ge.fromUint8Array(I||new Uint8Array))}(r,e.targetChange.resumeToken),l=e.targetChange.cause,h=l&&function(m){const I=void 0===m.code?B.UNKNOWN:co(m.code);return new A(I,m.message||"")}(l);t=new _l(n,i,s,h||null)}else if("documentChange"in e){const n=e.documentChange,i=Jt(r,n.document.name),s=Ze(n.document.updateTime),l=n.document.createTime?Ze(n.document.createTime):ue.min(),h=new at({mapValue:{fields:n.document.fields}}),f=qe.newFoundDocument(i,s,l,h);t=new ho(n.targetIds||[],n.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const n=e.documentDelete,i=Jt(r,n.document),s=n.readTime?Ze(n.readTime):ue.min(),l=qe.newNoDocument(i,s);t=new ho([],n.removedTargetIds||[],l.key,l)}else if("documentRemove"in e){const n=e.documentRemove,i=Jt(r,n.document);t=new ho([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return ne();{const n=e.filter,{count:i=0,unchangedNames:s}=n,l=new ka(i,s);t=new Hi(n.targetId,l)}}var m;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return ue.min();const l=s.targetChange;return l.targetIds&&l.targetIds.length?ue.min():l.readTime?Ze(l.readTime):ue.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Ba(this.serializer),t.addTarget=function(s,l){let h;const f=l.target;if(h=ei(f)?{documents:Ka(s,f)}:{query:go(s,f)._t},h.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){h.resumeToken=vl(s,l.resumeToken);const m=La(s,l.expectedCount);null!==m&&(h.expectedCount=m)}else if(l.snapshotVersion.compareTo(ue.min())>0){h.readTime=li(s,l.snapshotVersion.toTimestamp());const m=La(s,l.expectedCount);null!==m&&(h.expectedCount=m)}return h}(this.serializer,e);const n=function ph(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ne()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Ba(this.serializer),t.removeTarget=e,this.a_(t)}}class q_ extends ip{constructor(e,t,n,i,s,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,l),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return se(!!e.streamToken),this.lastStreamToken=e.streamToken,se(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){se(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function Wa(r,e){return r&&r.length>0?(se(void 0!==e),r.map(t=>function(i,s){let l=Ze(i.updateTime?i.updateTime:s);return l.isEqual(ue.min())&&(l=Ze(s)),new jf(l,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Ze(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Ba(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Zi(this.serializer,n))};this.a_(t)}}class z_ extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new A(B.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,l])=>this.connection.Mo(e,Ua(t,n),i,s,l)).catch(s=>{throw"FirebaseError"===s.name?(s.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new A(B.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,h])=>this.connection.Lo(e,Ua(t,n),i,l,h,s)).catch(l=>{throw"FirebaseError"===l.name?(l.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new A(B.UNKNOWN,l.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class W_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Me(t),this.D_=!1):K("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class K_{constructor(e,t,n,i,s){var l=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(h=>{n.enqueueAndForget((0,y.A)(function*(){var f;_i(l)&&(K("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,y.A)(function*(I){const T=J(I);T.L_.add(4),yield Lo(T),T.q_.set("Unknown"),T.L_.delete(4),yield uu(T)}),function m(I){return f.apply(this,arguments)})(l))}))}),this.q_=new W_(n,i)}}function uu(r){return Oh.apply(this,arguments)}function Oh(){return(Oh=(0,y.A)(function*(r){if(_i(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function Lo(r){return Mh.apply(this,arguments)}function Mh(){return(Mh=(0,y.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function tc(r,e){const t=J(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Uh(t)?Fh(t):Bo(t).r_()&&Lh(t,e))}function Fo(r,e){const t=J(r),n=Bo(t);t.N_.delete(e),n.r_()&&sp(t,e),0===t.N_.size&&(n.r_()?n.o_():_i(t)&&t.q_.set("Unknown"))}function Lh(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ue.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bo(r).A_(e)}function sp(r,e){r.Q_.xe(e),Bo(r).R_(e)}function Fh(r){r.Q_=new lh({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Bo(r).start(),r.q_.v_()}function Uh(r){return _i(r)&&!Bo(r).n_()&&r.N_.size>0}function _i(r){return 0===J(r).L_.size}function op(r){r.Q_=void 0}function G_(r){return Bh.apply(this,arguments)}function Bh(){return(Bh=(0,y.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function j_(r){return qh.apply(this,arguments)}function qh(){return(qh=(0,y.A)(function*(r){r.N_.forEach((e,t)=>{Lh(r,e)})})).apply(this,arguments)}function $_(r,e){return zh.apply(this,arguments)}function zh(){return(zh=(0,y.A)(function*(r,e){op(r),Uh(r)?(r.q_.M_(e),Fh(r)):r.q_.set("Unknown")})).apply(this,arguments)}function Q_(r,e,t){return Wh.apply(this,arguments)}function Wh(){return Wh=(0,y.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof _l&&2===e.state&&e.cause)try{yield(n=(0,y.A)(function*(s,l){const h=l.cause;for(const f of l.targetIds)s.N_.has(f)&&(yield s.remoteSyncer.rejectListen(f,h),s.N_.delete(f),s.Q_.removeTarget(f))}),function i(s,l){return n.apply(this,arguments)})(r,e)}catch(n){K("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield nc(r,n)}else if(e instanceof ho?r.Q_.Ke(e):e instanceof Hi?r.Q_.He(e):r.Q_.We(e),!t.isEqual(ue.min()))try{const n=yield Qf(r.localStore);t.compareTo(n)>=0&&(yield function(s,l){const h=s.Q_.rt(l);return h.targetChanges.forEach((f,m)=>{if(f.resumeToken.approximateByteSize()>0){const I=s.N_.get(m);I&&s.N_.set(m,I.withResumeToken(f.resumeToken,l))}}),h.targetMismatches.forEach((f,m)=>{const I=s.N_.get(f);if(!I)return;s.N_.set(f,I.withResumeToken(Ge.EMPTY_BYTE_STRING,I.snapshotVersion)),sp(s,f);const T=new sn(I.target,f,m,I.sequenceNumber);Lh(s,T)}),s.remoteSyncer.applyRemoteEvent(h)}(r,t))}catch(n){K("RemoteStore","Failed to raise snapshot:",n),yield nc(r,n)}var n}),Wh.apply(this,arguments)}function nc(r,e,t){return Kh.apply(this,arguments)}function Kh(){return(Kh=(0,y.A)(function*(r,e,t){if(!$t(e))throw e;r.L_.add(1),yield Lo(r),r.q_.set("Offline"),t||(t=()=>Qf(r.localStore)),r.asyncQueue.enqueueRetryable((0,y.A)(function*(){K("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield uu(r)}))})).apply(this,arguments)}function ap(r,e){return e().catch(t=>nc(r,t,e))}function Uo(r){return Gh.apply(this,arguments)}function Gh(){return(Gh=(0,y.A)(function*(r){const e=J(r),t=gi(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;H_(e);)try{const i=yield N_(e.localStore,n);if(null===i){0===e.O_.length&&t.o_();break}n=i.batchId,J_(e,i)}catch(i){yield nc(e,i)}up(e)&&lp(e)})).apply(this,arguments)}function H_(r){return _i(r)&&r.O_.length<10}function J_(r,e){r.O_.push(e);const t=gi(r);t.r_()&&t.V_&&t.m_(e.mutations)}function up(r){return _i(r)&&!gi(r).n_()&&r.O_.length>0}function lp(r){gi(r).start()}function Y_(r){return jh.apply(this,arguments)}function jh(){return(jh=(0,y.A)(function*(r){gi(r).p_()})).apply(this,arguments)}function X_(r){return $h.apply(this,arguments)}function $h(){return($h=(0,y.A)(function*(r){const e=gi(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function Z_(r,e,t){return Qh.apply(this,arguments)}function Qh(){return(Qh=(0,y.A)(function*(r,e,t){const n=r.O_.shift(),i=Tr.from(n,e,t);yield ap(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Uo(r)})).apply(this,arguments)}function eg(r,e){return Hh.apply(this,arguments)}function Hh(){return Hh=(0,y.A)(function*(r,e){var t;e&&gi(r).V_&&(yield(t=(0,y.A)(function*(i,s){if(pl(h=s.code)&&h!==B.ABORTED){const l=i.O_.shift();gi(i).s_(),yield ap(i,()=>i.remoteSyncer.rejectFailedWrite(l.batchId,s)),yield Uo(i)}var h}),function n(i,s){return t.apply(this,arguments)})(r,e)),up(r)&&lp(r)}),Hh.apply(this,arguments)}function cp(r,e){return Jh.apply(this,arguments)}function Jh(){return(Jh=(0,y.A)(function*(r,e){const t=J(r);t.asyncQueue.verifyOperationInProgress(),K("RemoteStore","RemoteStore received new credentials");const n=_i(t);t.L_.add(3),yield Lo(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield uu(t)})).apply(this,arguments)}function Yh(r,e){return Xh.apply(this,arguments)}function Xh(){return(Xh=(0,y.A)(function*(r,e){const t=J(r);e?(t.L_.delete(2),yield uu(t)):e||(t.L_.add(2),yield Lo(t),t.q_.set("Unknown"))})).apply(this,arguments)}function Bo(r){return r.K_||(r.K_=function(t,n,i){const s=J(t);return s.w_(),new B_(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:G_.bind(null,r),Ro:j_.bind(null,r),mo:$_.bind(null,r),d_:Q_.bind(null,r)}),r.B_.push(function(){var e=(0,y.A)(function*(t){t?(r.K_.s_(),Uh(r)?Fh(r):r.q_.set("Unknown")):(yield r.K_.stop(),op(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function gi(r){return r.U_||(r.U_=function(t,n,i){const s=J(t);return s.w_(),new q_(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Y_.bind(null,r),mo:eg.bind(null,r),f_:X_.bind(null,r),g_:Z_.bind(null,r)}),r.B_.push(function(){var e=(0,y.A)(function*(t){t?(r.U_.s_(),yield Uo(r)):(yield r.U_.stop(),r.O_.length>0&&(K("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class Zh{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new S,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(l=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const l=Date.now()+n,h=new Zh(e,t,l,i,s);return h.start(n),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qo(r,e){if(Me("AsyncQueue",`${e}: ${r}`),$t(r))return new A(B.UNAVAILABLE,`${e}: ${r}`);throw r}class zo{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Y.comparator(t.key,n.key):(t,n)=>Y.comparator(t.key,n.key),this.keyedMap=Ir(),this.sortedSet=new Ne(this.comparator)}static emptySet(e){return new zo(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof zo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new zo;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class hp{constructor(){this.W_=new Ne(Y.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ne():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Wo{constructor(e,t,n,i,s,l,h,f,m){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=l,this.syncStateChanged=h,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,n,i,s){const l=[];return t.forEach(h=>{l.push({type:0,doc:h})}),new Wo(e,t,zo.emptySet(t),l,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class tg{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class ng{constructor(){this.queries=dp(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const i=J(t),s=i.queries;i.queries=dp(),s.forEach((l,h)=>{for(const f of h.j_)f.onError(n)})}(this,new A(B.ABORTED,"Firestore shutting down"))}}function dp(){return new wn(r=>gr(r),qi)}function ed(r,e){return td.apply(this,arguments)}function td(){return(td=(0,y.A)(function*(r,e){const t=J(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new tg,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(l){const h=qo(l,`Initialization of query '${yr(e.query)}' failed`);return void e.onError(h)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&id(t)})).apply(this,arguments)}function nd(r,e){return rd.apply(this,arguments)}function rd(){return(rd=(0,y.A)(function*(r,e){const t=J(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const l=s.j_.indexOf(e);l>=0&&(s.j_.splice(l,1),0===s.j_.length?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function rg(r,e){const t=J(r);let n=!1;for(const i of e){const l=t.queries.get(i.query);if(l){for(const h of l.j_)h.X_(i)&&(n=!0);l.z_=i}}n&&id(t)}function ig(r,e,t){const n=J(r),i=n.queries.get(e);if(i)for(const s of i.j_)s.onError(t);n.queries.delete(e)}function id(r){r.Y_.forEach(e=>{e.next()})}var sd,fp;(fp=sd||(sd={})).ea="default",fp.Cache="cache";class od{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new Wo(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=Wo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==sd.Cache}}class sg{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}class pp{constructor(e){this.serializer=e}Es(e){return Jt(this.serializer,e)}ds(e){return e.metadata.exists?Qn(this.serializer,e.document,!1):qe.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ze(e)}}class og{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=mp(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const n=Ee.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,n=new pp(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Es(i.metadata.name);for(const l of i.metadata.queries){const h=(t.get(l)||ge()).add(s);t.set(l,h)}}return t}complete(){var e=this;return(0,y.A)(function*(){const t=yield function k_(r,e,t,n){return Sh.apply(this,arguments)}(e.localStore,new pp(e.serializer),e.documents,e.ca.id),n=e.ha(e.documents);for(const i of e.queries)yield O_(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Pa:e.collectionGroups,Ia:t}})()}}function mp(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class _p{constructor(e){this.key=e}}class gp{constructor(e){this.key=e}}class yp{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ge(),this.mutatedKeys=ge(),this.Aa=il(e),this.Ra=new zo(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new hp,i=t?t.Ra:this.Ra;let s=t?t.mutatedKeys:this.mutatedKeys,l=i,h=!1;const f="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,m="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((I,T)=>{const P=i.get(I),k=zi(this.query,T)?T:null,z=!!P&&this.mutatedKeys.has(P.key),$=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let G=!1;P&&k?P.data.isEqual(k.data)?z!==$&&(n.track({type:3,doc:k}),G=!0):this.ga(P,k)||(n.track({type:2,doc:k}),G=!0,(f&&this.Aa(k,f)>0||m&&this.Aa(k,m)<0)&&(h=!0)):!P&&k?(n.track({type:0,doc:k}),G=!0):P&&!k&&(n.track({type:1,doc:P}),G=!0,(f||m)&&(h=!0)),G&&(k?(l=l.add(k),s=$?s.add(I):s.delete(I)):(l=l.delete(I),s=s.delete(I)))}),null!==this.query.limit)for(;l.size>this.query.limit;){const I="F"===this.query.limitType?l.last():l.first();l=l.delete(I.key),s=s.delete(I.key),n.track({type:1,doc:I})}return{Ra:l,fa:n,ns:h,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const l=e.fa.G_();l.sort((I,T)=>function(k,z){const $=G=>{switch(G){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ne()}};return $(k)-$(z)}(I.type,T.type)||this.Aa(I.doc,T.doc)),this.pa(n),i=null!=i&&i;const h=t&&!i?this.ya():[],f=0===this.da.size&&this.current&&!i?1:0,m=f!==this.Ea;return this.Ea=f,0!==l.length||m?{snapshot:new Wo(this.query,e.Ra,s,l,e.mutatedKeys,0===f,m,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:h}:{wa:h}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new hp,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ge(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new gp(n))}),this.da.forEach(n=>{e.has(n)||t.push(new _p(n))}),t}ba(e){this.Ta=e.Ts,this.da=ge();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Wo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class ag{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ug{constructor(e){this.key=e,this.va=!1}}class lg{constructor(e,t,n,i,s,l){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=l,this.Ca={},this.Fa=new wn(h=>gr(h),qi),this.Ma=new Map,this.xa=new Set,this.Oa=new Ne(Y.comparator),this.Na=new Map,this.La=new d,this.Ba={},this.ka=new Map,this.qa=Cn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function cg(r,e){return ad.apply(this,arguments)}function ad(){return(ad=(0,y.A)(function*(r,e,t=!0){const n=rc(r);let i;const s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Ip(n,e,t,!0),i})).apply(this,arguments)}function hg(r,e){return ud.apply(this,arguments)}function ud(){return(ud=(0,y.A)(function*(r,e){const t=rc(r);yield Ip(t,e,!0,!1)})).apply(this,arguments)}function Ip(r,e,t,n){return ld.apply(this,arguments)}function ld(){return(ld=(0,y.A)(function*(r,e,t,n){const i=yield Oo(r.localStore,ut(e)),s=i.targetId,l=t?r.sharedClientState.addLocalQueryTarget(s):"not-current";let h;return n&&(h=yield cd(r,e,s,"current"===l,i.resumeToken)),r.isPrimaryClient&&t&&tc(r.remoteStore,i),h})).apply(this,arguments)}function cd(r,e,t,n,i){return hd.apply(this,arguments)}function hd(){return hd=(0,y.A)(function*(r,e,t,n,i){r.Ka=(T,P,k)=>{return(z=(0,y.A)(function*(G,Z,oe,ae){let ie=Z.view.ma(oe);ie.ns&&(ie=yield Jl(G.localStore,Z.query,!1).then(({documents:R})=>Z.view.ma(R,ie)));const pe=ae&&ae.targetChanges.get(Z.targetId),ce=ae&&null!=ae.targetMismatches.get(Z.targetId),D=Z.view.applyChanges(ie,G.isPrimaryClient,pe,ce);return Td(G,Z.targetId,D.wa),D.snapshot}),function $(G,Z,oe,ae){return z.apply(this,arguments)})(r,T,P,k);var z};const s=yield Jl(r.localStore,e,!0),l=new yp(e,s.Ts),h=l.ma(s.documents),f=Qi.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),m=l.applyChanges(h,r.isPrimaryClient,f);Td(r,t,m.wa);const I=new ag(e,t,l);return r.Fa.set(e,I),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),m.snapshot}),hd.apply(this,arguments)}function dg(r,e,t){return dd.apply(this,arguments)}function dd(){return(dd=(0,y.A)(function*(r,e,t){const n=J(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(l=>!qi(l,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Mo(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Fo(n.remoteStore,i.targetId),Ko(n,i.targetId)}).catch(zn))):(Ko(n,i.targetId),yield Mo(n.localStore,i.targetId,!0))})).apply(this,arguments)}function fg(r,e){return fd.apply(this,arguments)}function fd(){return(fd=(0,y.A)(function*(r,e){const t=J(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Fo(t.remoteStore,n.targetId))})).apply(this,arguments)}function pd(){return(pd=(0,y.A)(function*(r,e,t){const n=Nd(r);try{const i=yield function(l,h){const f=J(l),m=Ue.now(),I=h.reduce((k,z)=>k.add(z.key),ge());let T,P;return f.persistence.runTransaction("Locally write mutations","readwrite",k=>{let z=Ot(),$=ge();return f.cs.getEntries(k,I).next(G=>{z=G,z.forEach((Z,oe)=>{oe.isValidDocument()||($=$.add(Z))})}).next(()=>f.localDocuments.getOverlayedDocuments(k,z)).next(G=>{T=G;const Z=[];for(const oe of h){const ae=oh(oe,T.get(oe.key).overlayedDocument);null!=ae&&Z.push(new rn(oe.key,ae,Qs(ae.value.mapValue),Le.exists(!0)))}return f.mutationQueue.addMutationBatch(k,m,Z,h)}).next(G=>{P=G;const Z=G.applyToLocalDocumentSet(T,$);return f.documentOverlayCache.saveOverlays(k,G.batchId,Z)})}).then(()=>({batchId:P.batchId,changes:sl(T)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(l,h,f){let m=l.Ba[l.currentUser.toKey()];m||(m=new Ne(he)),m=m.insert(h,f),l.Ba[l.currentUser.toKey()]=m}(n,i.batchId,t),yield Cr(n,i.changes),yield Uo(n.remoteStore)}catch(i){const s=qo(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function vp(r,e){return md.apply(this,arguments)}function md(){return(md=(0,y.A)(function*(r,e){const t=J(r);try{const n=yield function D_(r,e){const t=J(r),n=e.snapshotVersion;let i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const l=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;const h=[];e.targetChanges.forEach((I,T)=>{const P=i.get(T);if(!P)return;h.push(t.Ur.removeMatchingKeys(s,I.removedDocuments,T).next(()=>t.Ur.addMatchingKeys(s,I.addedDocuments,T)));let k=P.withSequenceNumber(s.currentSequenceNumber);var $,G,Z;null!==e.targetMismatches.get(T)?k=k.withResumeToken(Ge.EMPTY_BYTE_STRING,ue.min()).withLastLimboFreeSnapshotVersion(ue.min()):I.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(I.resumeToken,n)),i=i.insert(T,k),G=k,Z=I,(0===($=P).resumeToken.approximateByteSize()||G.snapshotVersion.toMicroseconds()-$.snapshotVersion.toMicroseconds()>=3e8||Z.addedDocuments.size+Z.modifiedDocuments.size+Z.removedDocuments.size>0)&&h.push(t.Ur.updateTargetData(s,k))});let f=Ot(),m=ge();if(e.documentUpdates.forEach(I=>{e.resolvedLimboDocuments.has(I)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(s,I))}),h.push(Hf(s,l,e.documentUpdates).next(I=>{f=I.Ps,m=I.Is})),!n.isEqual(ue.min())){const I=t.Ur.getLastRemoteSnapshotVersion(s).next(T=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));h.push(I)}return M.waitFor(h).next(()=>l.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,f,m)).next(()=>f)}).then(s=>(t.os=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const l=t.Na.get(s);l&&(se(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?l.va=!0:i.modifiedDocuments.size>0?se(l.va):i.removedDocuments.size>0&&(se(l.va),l.va=!1))}),yield Cr(t,n,e)}catch(n){yield zn(n)}})).apply(this,arguments)}function Ep(r,e,t){const n=J(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Fa.forEach((s,l)=>{const h=l.view.Z_(e);h.snapshot&&i.push(h.snapshot)}),function(l,h){const f=J(l);f.onlineState=h;let m=!1;f.queries.forEach((I,T)=>{for(const P of T.j_)P.Z_(h)&&(m=!0)}),m&&id(f)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function mg(r,e,t){return _d.apply(this,arguments)}function _d(){return(_d=(0,y.A)(function*(r,e,t){const n=J(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Na.get(e),s=i&&i.key;if(s){let l=new Ne(Y.comparator);l=l.insert(s,qe.newNoDocument(s,ue.min()));const h=ge().add(s),f=new $i(ue.min(),new Map,new Ne(he),l,h);yield vp(n,f),n.Oa=n.Oa.remove(s),n.Na.delete(e),Ad(n)}else yield Mo(n.localStore,e,!1).then(()=>Ko(n,e,t)).catch(zn)})).apply(this,arguments)}function _g(r,e){return gd.apply(this,arguments)}function gd(){return(gd=(0,y.A)(function*(r,e){const t=J(r),n=e.batch.batchId;try{const i=yield function x_(r,e){const t=J(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(h,f,m,I){const T=m.batch,P=T.keys();let k=M.resolve();return P.forEach(z=>{k=k.next(()=>I.getEntry(f,z)).next($=>{const G=m.docVersions.get(z);se(null!==G),$.version.compareTo(G)<0&&(T.applyToRemoteDocument($,m),$.isValidDocument()&&($.setReadTime(m.commitVersion),I.addEntry($)))})}),k.next(()=>h.mutationQueue.removeMutationBatch(f,T))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(h){let f=ge();for(let m=0;m<h.mutationResults.length;++m)h.mutationResults[m].transformResults.length>0&&(f=f.add(h.batch.mutations[m].key));return f}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);Ed(t,n,null),vd(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Cr(t,i)}catch(i){yield zn(i)}})).apply(this,arguments)}function gg(r,e,t){return yd.apply(this,arguments)}function yd(){return(yd=(0,y.A)(function*(r,e,t){const n=J(r);try{const i=yield function(l,h){const f=J(l);return f.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let I;return f.mutationQueue.lookupMutationBatch(m,h).next(T=>(se(null!==T),I=T.keys(),f.mutationQueue.removeMutationBatch(m,T))).next(()=>f.mutationQueue.performConsistencyCheck(m)).next(()=>f.documentOverlayCache.removeOverlaysForBatchId(m,I,h)).next(()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,I)).next(()=>f.localDocuments.getDocuments(m,I))})}(n.localStore,e);Ed(n,e,t),vd(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Cr(n,i)}catch(i){yield zn(i)}})).apply(this,arguments)}function Id(){return(Id=(0,y.A)(function*(r,e){const t=J(r);_i(t.remoteStore)||K("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(l){const h=J(l);return h.persistence.runTransaction("Get highest unacknowledged batch id","readonly",f=>h.mutationQueue.getHighestUnacknowledgedBatchId(f))}(t.localStore);if(-1===n)return void e.resolve();const i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){const i=qo(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function vd(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function Ed(r,e,t){const n=J(r);let i=n.Ba[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function Ko(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Tp(r,n)})}function Tp(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(Fo(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),Ad(r))}function Td(r,e,t){for(const n of t)n instanceof _p?(r.La.addReference(n.key,e),Ig(r,n)):n instanceof gp?(K("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Tp(r,n.key)):ne()}function Ig(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(K("SyncEngine","New document in limbo: "+t),r.xa.add(n),Ad(r))}function Ad(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new Y(Ee.fromString(e)),n=r.qa.next();r.Na.set(n,new ug(t)),r.Oa=r.Oa.insert(t,n),tc(r.remoteStore,new sn(ut($n(t.path)),n,"TargetPurposeLimboResolution",wt.oe))}}function Cr(r,e,t){return wd.apply(this,arguments)}function wd(){return wd=(0,y.A)(function*(r,e,t){const n=J(r),i=[],s=[],l=[];var h;n.Fa.isEmpty()||(n.Fa.forEach((h,f)=>{l.push(n.Ka(f,e,t).then(m=>{var I;if((m||t)&&n.isPrimaryClient){const T=m?!m.fromCache:null===(I=null==t?void 0:t.targetChanges.get(f.targetId))||void 0===I?void 0:I.current;n.sharedClientState.updateQueryState(f.targetId,T?"current":"not-current")}if(m){i.push(m);const T=Do.Wi(f.targetId,m);s.push(T)}}))}),yield Promise.all(l),n.Ca.d_(i),yield(h=(0,y.A)(function*(m,I){const T=J(m);try{yield T.persistence.runTransaction("notifyLocalViewChanges","readwrite",P=>M.forEach(I,k=>M.forEach(k.$i,z=>T.persistence.referenceDelegate.addReference(P,k.targetId,z)).next(()=>M.forEach(k.Ui,z=>T.persistence.referenceDelegate.removeReference(P,k.targetId,z)))))}catch(P){if(!$t(P))throw P;K("LocalStore","Failed to update sequence numbers: "+P)}for(const P of I){const k=P.targetId;if(!P.fromCache){const z=T.os.get(k),G=z.withLastLimboFreeSnapshotVersion(z.snapshotVersion);T.os=T.os.insert(k,G)}}}),function f(m,I){return h.apply(this,arguments)})(n.localStore,s))}),wd.apply(this,arguments)}function vg(r,e){return Rd.apply(this,arguments)}function Rd(){return(Rd=(0,y.A)(function*(r,e){const t=J(r);if(!t.currentUser.isEqual(e)){K("SyncEngine","User change. New user:",e.toKey());const n=yield ko(t.localStore,e);t.currentUser=e,(s=t).ka.forEach(h=>{h.forEach(f=>{f.reject(new A(B.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Cr(t,n.hs)}var s})).apply(this,arguments)}function Eg(r,e){const t=J(r),n=t.Na.get(e);if(n&&n.va)return ge().add(n.key);{let i=ge();const s=t.Ma.get(e);if(!s)return i;for(const l of s){const h=t.Fa.get(l);i=i.unionWith(h.view.Va)}return i}}function Tg(r,e){return Pd.apply(this,arguments)}function Pd(){return(Pd=(0,y.A)(function*(r,e){const t=J(r),n=yield Jl(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&Td(t,e.targetId,i.wa),i})).apply(this,arguments)}function Ag(r,e){return Sd.apply(this,arguments)}function Sd(){return(Sd=(0,y.A)(function*(r,e){const t=J(r);return Yf(t.localStore,e).then(n=>Cr(t,n))})).apply(this,arguments)}function wg(r,e,t,n){return bd.apply(this,arguments)}function bd(){return(bd=(0,y.A)(function*(r,e,t,n){const i=J(r),s=yield function(h,f){const m=J(h),I=J(m.mutationQueue);return m.persistence.runTransaction("Lookup mutation documents","readonly",T=>I.Mn(T,f).next(P=>P?m.localDocuments.getDocuments(T,P):M.resolve(null)))}(i.localStore,e);var f;null!==s?("pending"===t?yield Uo(i.remoteStore):"acknowledged"===t||"rejected"===t?(Ed(i,e,n||null),vd(i,e),f=e,J(J(i.localStore).mutationQueue).On(f)):ne(),yield Cr(i,s)):K("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function Cd(){return(Cd=(0,y.A)(function*(r,e){const t=J(r);if(rc(t),Nd(t),!0===e&&!0!==t.Qa){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Ap(t,n.toArray());t.Qa=!0,yield Yh(t.remoteStore,!0);for(const s of i)tc(t.remoteStore,s)}else if(!1===e&&!1!==t.Qa){const n=[];let i=Promise.resolve();t.Ma.forEach((s,l)=>{t.sharedClientState.isLocalQueryTarget(l)?n.push(l):i=i.then(()=>(Ko(t,l),Mo(t.localStore,l,!0))),Fo(t.remoteStore,l)}),yield i,yield Ap(t,n),function(l){const h=J(l);h.Na.forEach((f,m)=>{Fo(h.remoteStore,m)}),h.La.pr(),h.Na=new Map,h.Oa=new Ne(Y.comparator)}(t),t.Qa=!1,yield Yh(t.remoteStore,!1)}})).apply(this,arguments)}function Ap(r,e,t){return Vd.apply(this,arguments)}function Vd(){return(Vd=(0,y.A)(function*(r,e,t){const n=J(r),i=[],s=[];for(const l of e){let h;const f=n.Ma.get(l);if(f&&0!==f.length){h=yield Oo(n.localStore,ut(f[0]));for(const m of f){const I=n.Fa.get(m),T=yield Tg(n,I);T.snapshot&&s.push(T.snapshot)}}else{const m=yield Jf(n.localStore,l);h=yield Oo(n.localStore,m),yield cd(n,wp(m),l,!1,h.resumeToken)}i.push(h)}return n.Ca.d_(s),i})).apply(this,arguments)}function wp(r){return Zu(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Pg(r){return t=J(r).localStore,J(J(t).persistence).Qi();var t}function Sg(r,e,t,n){return xd.apply(this,arguments)}function xd(){return(xd=(0,y.A)(function*(r,e,t,n){const i=J(r);if(i.Qa)return void K("SyncEngine","Ignoring unexpected query state notification.");const s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const l=yield Yf(i.localStore,rl(s[0])),h=$i.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Ge.EMPTY_BYTE_STRING);yield Cr(i,l,h);break}case"rejected":yield Mo(i.localStore,e,!0),Ko(i,e,n);break;default:ne()}})).apply(this,arguments)}function bg(r,e,t){return Dd.apply(this,arguments)}function Dd(){return(Dd=(0,y.A)(function*(r,e,t){const n=rc(r);if(n.Qa){for(const i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){K("SyncEngine","Adding an already active target "+i);continue}const s=yield Jf(n.localStore,i),l=yield Oo(n.localStore,s);yield cd(n,wp(s),l.targetId,!1,l.resumeToken),tc(n.remoteStore,l)}for(const i of t)n.Ma.has(i)&&(yield Mo(n.localStore,i,!1).then(()=>{Fo(n.remoteStore,i),Ko(n,i)}).catch(zn))}})).apply(this,arguments)}function rc(r){const e=J(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=vp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Eg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=mg.bind(null,e),e.Ca.d_=rg.bind(null,e.eventManager),e.Ca.$a=ig.bind(null,e.eventManager),e}function Nd(r){const e=J(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_g.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=gg.bind(null,e),e}class Go{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,y.A)(function*(){t.serializer=au(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Hl(this.persistence,new No,e.initialUser,this.serializer)}createPersistence(e){return new re(ye.Zr,this.serializer)}createSharedClientState(e){return new tp}terminate(){var e=this;return(0,y.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class kd extends Go{constructor(e,t,n){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,y.A)(function*(){yield t().call(n,e),yield n.Wa.initialize(n,e),yield Nd(n.Wa.syncEngine),yield Uo(n.Wa.remoteStore),yield n.persistence.yi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return Hl(this.persistence,new No,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Bl(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new zu(t,this.persistence);return new zc(e.asyncQueue,n)}createPersistence(e){const t=as(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?gt.withCacheSize(this.cacheSizeBytes):gt.DEFAULT;return new ss(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,rp(),ec(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new tp}}class Rp extends kd{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,y.A)(function*(){yield t().call(n,e);const i=n.Wa.syncEngine;n.sharedClientState instanceof Dh&&(n.sharedClientState.syncEngine={no:wg.bind(null,i),ro:Sg.bind(null,i),io:bg.bind(null,i),Qi:Pg.bind(null,i),eo:Ag.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.yi(function(){var s=(0,y.A)(function*(l){yield function Rg(r,e){return Cd.apply(this,arguments)}(n.Wa.syncEngine,l),n.gcScheduler&&(l&&!n.gcScheduler.started?n.gcScheduler.start():l||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(l&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():l||n.indexBackfillerScheduler.stop())});return function(l){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=rp();if(!Dh.D(t))throw new A(B.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=as(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Dh(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class jo{initialize(e,t){var n=this;return(0,y.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>Ep(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=vg.bind(null,n.syncEngine),yield Yh(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new ng}createDatastore(e){const t=au(e.databaseInfo.databaseId),n=new U_(e.databaseInfo);return new z_(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,l=t=>Ep(this.syncEngine,t,0),h=np.D()?new np:new M_,new K_(n,i,s,l,h);var n,i,s,l,h}createSyncEngine(e,t){return function(i,s,l,h,f,m,I){const T=new lg(i,s,l,h,f,m);return I&&(T.Qa=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,y.A)(function*(){var t,n,i;yield(i=(0,y.A)(function*(l){const h=J(l);K("RemoteStore","RemoteStore shutting down."),h.L_.add(5),yield Lo(h),h.k_.shutdown(),h.q_.set("Unknown")}),function s(l){return i.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}function Pp(r,e=10240){let t=0;return{read:()=>(0,y.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,y.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class ic{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Me("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class xg{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new S,this.buffer=new Uint8Array,this.Ha=new TextDecoder("utf-8"),this.Ja().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==n?void 0:n.aa)}`))},n=>this.metadata.reject(n))}close(){return this.ja.cancel()}getMetadata(){var e=this;return(0,y.A)(function*(){return e.metadata.promise})()}Ua(){var e=this;return(0,y.A)(function*(){return yield e.getMetadata(),e.Ja()})()}Ja(){var e=this;return(0,y.A)(function*(){const t=yield e.Ya();if(null===t)return null;const n=e.Ha.decode(t),i=Number(n);isNaN(i)&&e.Za(`length string (${n}) is not valid number`);const s=yield e.Xa(i);return new sg(JSON.parse(s),t.length+i)})()}eu(){return this.buffer.findIndex(e=>123===e)}Ya(){var e=this;return(0,y.A)(function*(){for(;e.eu()<0&&!(yield e.tu()););if(0===e.buffer.length)return null;const t=e.eu();t<0&&e.Za("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Xa(e){var t=this;return(0,y.A)(function*(){for(;t.buffer.length<e;)(yield t.tu())&&t.Za("Reached the end of bundle when more is expected.");const n=t.Ha.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){var e=this;return(0,y.A)(function*(){const t=yield e.ja.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class Dg{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,y.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new A(B.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,y.A)(function*(l,h){const f=J(l),m={documents:h.map(k=>Yi(f.serializer,k))},I=yield f.Lo("BatchGetDocuments",f.serializer.databaseId,Ee.emptyPath(),m,h.length),T=new Map;I.forEach(k=>{const z=function qa(r,e){return"found"in e?function(n,i){se(!!i.found);const s=Jt(n,i.found.name),l=Ze(i.found.updateTime),h=i.found.createTime?Ze(i.found.createTime):ue.min(),f=new at({mapValue:{fields:i.found.fields}});return qe.newFoundDocument(s,l,h,f)}(r,e):"missing"in e?function(n,i){se(!!i.missing),se(!!i.readTime);const s=Jt(n,i.missing),l=Ze(i.readTime);return qe.newNoDocument(s,l)}(r,e):ne()}(f.serializer,k);T.set(z.key.toString(),z)});const P=[];return h.forEach(k=>{const z=T.get(k.toString());se(!!z),P.push(z)}),P}),function s(l,h){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new oi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,y.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=Y.fromPath(i);e.mutations.push(new ai(s,e.precondition(s)))}),yield(n=(0,y.A)(function*(s,l){const h=J(s),f={writes:l.map(m=>Zi(h.serializer,m))};yield h.Mo("Commit",h.serializer.databaseId,Ee.emptyPath(),f)}),function i(s,l){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ne();t=ue.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new A(B.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ue.min())?Le.exists(!1):Le.updateTime(t):Le.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ue.min()))throw new A(B.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Le.updateTime(t)}return Le.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Ng{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.nu=n.maxAttempts,this.t_=new kh(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){var e=this;this.t_.Go((0,y.A)(function*(){const t=new Dg(e.datastore),n=e.su(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.ou(s)}))}).catch(i=>{e.ou(i)})}))}su(e){try{const t=this.updateFunction(e);return!xi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!pl(t)}return!1}}class kg{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=_e.UNAUTHENTICATED,this.clientId=jt.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var l=(0,y.A)(function*(h){K("FirestoreClient","Received user=",h.uid),yield s.authCredentialListener(h),s.user=h});return function(h){return l.apply(this,arguments)}}()),this.appCheckCredentials.start(n,l=>(K("FirestoreClient","Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new A(B.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new S;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,y.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=qo(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function sc(r,e){return Od.apply(this,arguments)}function Od(){return Od=(0,y.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),K("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,y.A)(function*(s){n.isEqual(s)||(yield ko(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Od.apply(this,arguments)}function Md(r,e){return Ld.apply(this,arguments)}function Ld(){return(Ld=(0,y.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield Fd(r);K("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>cp(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>cp(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function Sp(r){return"FirebaseError"===r.name?r.code===B.FAILED_PRECONDITION||r.code===B.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function Fd(r){return Ud.apply(this,arguments)}function Ud(){return(Ud=(0,y.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){K("FirestoreClient","Using user provided OfflineComponentProvider");try{yield sc(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Sp(t))throw t;dt("Error using user provided cache. Falling back to memory cache: "+t),yield sc(r,new Go)}}else K("FirestoreClient","Using default OfflineComponentProvider"),yield sc(r,new Go);return r._offlineComponents})).apply(this,arguments)}function oc(r){return Bd.apply(this,arguments)}function Bd(){return(Bd=(0,y.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(K("FirestoreClient","Using user provided OnlineComponentProvider"),yield Md(r,r._uninitializedComponentsProvider._online)):(K("FirestoreClient","Using default OnlineComponentProvider"),yield Md(r,new jo))),r._onlineComponents})).apply(this,arguments)}function bp(r){return Fd(r).then(e=>e.persistence)}function $o(r){return Fd(r).then(e=>e.localStore)}function Cp(r){return oc(r).then(e=>e.remoteStore)}function qd(r){return oc(r).then(e=>e.syncEngine)}function Qo(r){return zd.apply(this,arguments)}function zd(){return(zd=(0,y.A)(function*(r){const e=yield oc(r),t=e.eventManager;return t.onListen=cg.bind(null,e.syncEngine),t.onUnlisten=dg.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=hg.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=fg.bind(null,e.syncEngine),t})).apply(this,arguments)}function xp(r,e,t={}){const n=new S;return r.asyncQueue.enqueueAndForget((0,y.A)(function*(){return function(s,l,h,f,m){const I=new ic({next:P=>{l.enqueueAndForget(()=>nd(s,T));const k=P.docs.has(h);!k&&P.fromCache?m.reject(new A(B.UNAVAILABLE,"Failed to get document because the client is offline.")):k&&P.fromCache&&f&&"server"===f.source?m.reject(new A(B.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(P)},error:P=>m.reject(P)}),T=new od($n(h.path),I,{includeMetadataChanges:!0,_a:!0});return ed(s,T)}(yield Qo(r),r.asyncQueue,e,t,n)})),n.promise}function Dp(r,e,t={}){const n=new S;return r.asyncQueue.enqueueAndForget((0,y.A)(function*(){return function(s,l,h,f,m){const I=new ic({next:P=>{l.enqueueAndForget(()=>nd(s,T)),P.fromCache&&"server"===f.source?m.reject(new A(B.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(P)},error:P=>m.reject(P)}),T=new od(h,I,{includeMetadataChanges:!0,_a:!0});return ed(s,T)}(yield Qo(r),r.asyncQueue,e,t,n)})),n.promise}function Np(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const kp=new Map;function Wd(r,e,t){if(!t)throw new A(B.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Op(r,e,t,n){if(!0===e&&!0===n)throw new A(B.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Mp(r){if(!Y.isDocumentKey(r))throw new A(B.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Lp(r){if(Y.isDocumentKey(r))throw new A(B.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ac(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":ne()}function ve(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new A(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ac(r);throw new A(B.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function Fp(r,e){if(e<=0)throw new A(B.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class Up{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new A(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new A(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Op("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Np(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new A(B.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new A(B.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new A(B.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lu{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Up({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new A(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new A(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Up(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new W;switch(n.type){case"firstParty":return new be(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new A(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=kp.get(t);n&&(K("ComponentProvider","Removing Datastore"),kp.delete(t),n.terminate())}(this),Promise.resolve()}}function Bp(r,e,t,n={}){var i;const s=(r=ve(r,lu))._getSettings(),l=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==l&&dt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:l,ssl:!1})),n.mockUserToken){let h,f;if("string"==typeof n.mockUserToken)h=n.mockUserToken,f=_e.MOCK_USER;else{h=(0,me.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new A(B.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new _e(m)}r._authCredentials=new te(new b(h,f))}}class vt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new vt(this.firestore,e,this._query)}}class Qe{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Qe(this.firestore,e,this._key)}}class nr extends vt{constructor(e,t,n){super(e,t,$n(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Qe(this.firestore,null,new Y(e))}withConverter(e){return new nr(this.firestore,e,this._path)}}function qp(r,e,...t){if(r=(0,me.Ku)(r),Wd("collection","path",e),r instanceof lu){const n=Ee.fromString(e,...t);return Lp(n),new nr(r,null,n)}{if(!(r instanceof Qe||r instanceof nr))throw new A(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Ee.fromString(e,...t));return Lp(n),new nr(r.firestore,null,n)}}function cu(r,e,...t){if(r=(0,me.Ku)(r),1===arguments.length&&(e=jt.newId()),Wd("doc","path",e),r instanceof lu){const n=Ee.fromString(e,...t);return Mp(n),new Qe(r,null,new Y(n))}{if(!(r instanceof Qe||r instanceof nr))throw new A(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Ee.fromString(e,...t));return Mp(n),new Qe(r.firestore,r instanceof nr?r.converter:null,new Y(n))}}function zp(r,e){return r=(0,me.Ku)(r),e=(0,me.Ku)(e),(r instanceof Qe||r instanceof nr)&&(e instanceof Qe||e instanceof nr)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Kd(r,e){return r=(0,me.Ku)(r),e=(0,me.Ku)(e),r instanceof vt&&e instanceof vt&&r.firestore===e.firestore&&qi(r._query,e._query)&&r.converter===e.converter}class $g{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new kh(this,"async_queue_retry"),this.Eu=()=>{const t=ec();t&&K("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const e=ec();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=ec();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new S;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){var e=this;return(0,y.A)(function*(){if(0!==e.uu.length){try{yield e.uu[0](),e.uu.shift(),e.t_.reset()}catch(t){if(!$t(t))throw t;K("AsyncQueue","Operation failed with retryable error: "+t)}e.uu.length>0&&e.t_.Go(()=>e.Ru())}})()}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{throw this.hu=n,this.Pu=!1,Me("INTERNAL UNHANDLED ERROR: ",function(l){let h=l.message||"";return l.stack&&(h=l.stack.includes(l.message)?l.stack:l.message+"\n"+l.stack),h}(n)),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const i=Zh.createAndSchedule(this,e,t,n,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&ne()}verifyOperationInProgress(){}mu(){var e=this;return(0,y.A)(function*(){let t;do{t=e.au,yield t}while(t!==e.au)})()}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}function Gd(r){return function(t){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class Qg{constructor(){this._progressObserver={},this._taskCompletionResolver=new S,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Fe extends lu{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new $g,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Wp(this),this._firestoreClient.terminate()}}function Jg(r,e){const t="object"==typeof r?r:(0,Zt.getApp)(),n="string"==typeof r?r:e||"(default)",i=(0,Zt._getProvider)(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const s=(0,me.yU)("firestore");s&&Bp(i,...s)}return i}function Je(r){return r._firestoreClient||Wp(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Wp(r){var e,t,n;const i=r._freezeSettings(),s=(f=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Xr(r._databaseId,f,r._persistenceKey,(I=i).host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,Np(I.experimentalLongPollingOptions),I.useFetchStreams));var f,I;r._firestoreClient=new kg(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Kp(r,e,t){const n=new S;return r.asyncQueue.enqueue((0,y.A)(function*(){try{yield sc(r,t),yield Md(r,e),n.resolve()}catch(i){const s=i;if(!Sp(s))throw s;dt("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function Gp(r){if(r._initialized||r._terminated)throw new A(B.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class rr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new rr(Ge.fromBase64String(e))}catch(t){throw new A(B.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new rr(Ge.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Vr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new A(B.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Be(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class us{constructor(e){this._methodName=e}}class uc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new A(B.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new A(B.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return he(this._lat,e._lat)||he(this._long,e._long)}}class lc{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}}const oy=/^__.*__$/;class ay{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new rn(e,this.data,this.fieldMask,t,this.fieldTransforms):new si(e,this.data,t,this.fieldTransforms)}}class jp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new rn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function $p(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ne()}}class cc{constructor(e,t,n,i,s,l){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=l||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new cc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.vu(e),i}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return fc(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(0===e.length)throw this.Mu("Document fields must not be empty");if($p(this.wu)&&oy.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class uy{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||au(e)}Nu(e,t,n,i=!1){return new cc({wu:e,methodName:t,Ou:n,path:Be.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ls(r){const e=r._freezeSettings(),t=au(r._databaseId);return new uy(r._databaseId,!!e.ignoreUndefinedProperties,t)}function hc(r,e,t,n,i,s={}){const l=r.Nu(s.merge||s.mergeFields?2:0,e,t,i);Xd("Data must be an object, but it was:",l,n);const h=Jp(n,l);let f,m;if(s.merge)f=new Rt(l.fieldMask),m=l.fieldTransforms;else if(s.mergeFields){const I=[];for(const T of s.mergeFields){const P=fu(e,T,t);if(!l.contains(P))throw new A(B.INVALID_ARGUMENT,`Field '${P}' is specified in your field mask but missing from your input data.`);Xp(I,P)||I.push(P)}f=new Rt(I),m=l.fieldTransforms.filter(T=>f.covers(T.field))}else f=null,m=l.fieldTransforms;return new ay(new at(h),f,m)}class du extends us{_toFieldTransform(e){if(2!==e.wu)throw e.Mu(1===e.wu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof du}}function Qp(r,e,t){return new cc({wu:3,Ou:e.settings.Ou,methodName:r._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class jd extends us{_toFieldTransform(e){return new so(e.path,new ri)}isEqual(e){return e instanceof jd}}class $d extends us{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=Qp(this,e,!0),n=this.Lu.map(s=>cs(s,t)),i=new Pn(n);return new so(e.path,i)}isEqual(e){return e instanceof $d&&(0,me.bD)(this.Lu,e.Lu)}}class Qd extends us{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=Qp(this,e,!0),n=this.Lu.map(s=>cs(s,t)),i=new vr(n);return new so(e.path,i)}isEqual(e){return e instanceof Qd&&(0,me.bD)(this.Lu,e.Lu)}}class Hd extends us{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=new Er(e.serializer,ol(e.serializer,this.Bu));return new so(e.path,t)}isEqual(e){return e instanceof Hd&&this.Bu===e.Bu}}function Jd(r,e,t,n){const i=r.Nu(1,e,t);Xd("Data must be an object, but it was:",i,n);const s=[],l=at.empty();Wn(n,(f,m)=>{const I=dc(e,f,t);m=(0,me.Ku)(m);const T=i.Cu(I);if(m instanceof du)s.push(I);else{const P=cs(m,T);null!=P&&(s.push(I),l.set(I,P))}});const h=new Rt(s);return new jp(l,h,i.fieldTransforms)}function Yd(r,e,t,n,i,s){const l=r.Nu(1,e,t),h=[fu(e,n,t)],f=[i];if(s.length%2!=0)throw new A(B.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let P=0;P<s.length;P+=2)h.push(fu(e,s[P])),f.push(s[P+1]);const m=[],I=at.empty();for(let P=h.length-1;P>=0;--P)if(!Xp(m,h[P])){const k=h[P];let z=f[P];z=(0,me.Ku)(z);const $=l.Cu(k);if(z instanceof du)m.push(k);else{const G=cs(z,$);null!=G&&(m.push(k),I.set(k,G))}}const T=new Rt(m);return new jp(I,T,l.fieldTransforms)}function Hp(r,e,t,n=!1){return cs(t,r.Nu(n?4:3,e))}function cs(r,e){if(Yp(r=(0,me.Ku)(r)))return Xd("Unsupported field value:",e,r),Jp(r,e);if(r instanceof us)return function(n,i){if(!$p(i.wu))throw i.Mu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(n,i){const s=[];let l=0;for(const h of n){let f=cs(h,i.Fu(l));null==f&&(f={nullValue:"NULL_VALUE"}),s.push(f),l++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,me.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return ol(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=Ue.fromDate(n);return{timestampValue:li(i.serializer,s)}}if(n instanceof Ue){const s=new Ue(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:li(i.serializer,s)}}if(n instanceof uc)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof rr)return{bytesValue:vl(i.serializer,n._byteString)};if(n instanceof Qe){const s=i.databaseId,l=n.firestore._databaseId;if(!l.isEqual(s))throw i.Mu(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Ji(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof lc)return h=i,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(f=>{if("number"!=typeof f)throw h.Mu("VectorValues must only contain numeric values.");return Rn(h.serializer,f)})}}}}};var h;throw i.Mu(`Unsupported field value: ${ac(n)}`)}(r,e)}function Jp(r,e){const t={};return Gu(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wn(r,(n,i)=>{const s=cs(i,e.bu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function Yp(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof Ue||r instanceof uc||r instanceof rr||r instanceof Qe||r instanceof us||r instanceof lc)}function Xd(r,e,t){if(!Yp(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=ac(t);throw e.Mu("an object"===n?r+" a custom object":r+" "+n)}var i}function fu(r,e,t){if((e=(0,me.Ku)(e))instanceof Vr)return e._internalPath;if("string"==typeof e)return dc(r,e);throw fc("Field path arguments must be of type string or ",r,!1,void 0,t)}const ly=new RegExp("[~\\*/\\[\\]]");function dc(r,e,t){if(e.search(ly)>=0)throw fc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Vr(...e.split("."))._internalPath}catch{throw fc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function fc(r,e,t,n,i){const s=n&&!n.isEmpty(),l=void 0!==i;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let f="";return(s||l)&&(f+=" (found",s&&(f+=` in field ${n}`),l&&(f+=` in document ${i}`),f+=")"),new A(B.INVALID_ARGUMENT,h+r+f)}function Xp(r,e){return r.some(t=>t.isEqual(e))}class pu{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Qe(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new cy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(pc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class cy extends pu{data(){return super.data()}}function pc(r,e){return"string"==typeof e?dc(r,e):e instanceof Vr?e._internalPath:e._delegate._internalPath}function Zp(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new A(B.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Zd{}class mu extends Zd{}function yi(r,e,...t){let n=[];e instanceof Zd&&n.push(e),n=n.concat(t),function(s){const l=s.filter(f=>f instanceof Ho).length,h=s.filter(f=>f instanceof _u).length;if(l>1||l>0&&h>0)throw new A(B.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class _u extends mu{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new _u(e,t,n)}_apply(e){const t=this._parse(e);return rm(e._query,t),new vt(e.firestore,e.converter,eo(e._query,t))}_parse(e){const t=ls(e.firestore);return function(s,l,h,f,m,I,T){let P;if(m.isKeyField()){if("array-contains"===I||"array-contains-any"===I)throw new A(B.INVALID_ARGUMENT,`Invalid Query. You can't perform '${I}' queries on documentId().`);if("in"===I||"not-in"===I){nm(T,I);const k=[];for(const z of T)k.push(tm(f,s,z));P={arrayValue:{values:k}}}else P=tm(f,s,T)}else"in"!==I&&"not-in"!==I&&"array-contains-any"!==I||nm(T,I),P=Hp(h,"where",T,"in"===I||"not-in"===I);return Ie.create(m,I,P)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Ho extends Zd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ho(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:Se.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let l=i;const h=s.getFlattenedFilters();for(const f of h)rm(l,f),l=eo(l,f)}(e._query,t),new vt(e.firestore,e.converter,eo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ef extends mu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ef(e,t)}_apply(e){const t=function(i,s,l){if(null!==i.startAt)throw new A(B.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new A(B.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Tn(s,l)}(e._query,this._field,this._direction);return new vt(e.firestore,e.converter,function(i,s){const l=i.explicitOrderBy.concat([s]);return new nn(i.path,i.collectionGroup,l,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class mc extends mu{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new mc(e,t,n)}_apply(e){return new vt(e.firestore,e.converter,ni(e._query,this._limit,this._limitType))}}class _c extends mu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new _c(e,t,n)}_apply(e){const t=em(e,this.type,this._docOrFields,this._inclusive);return new vt(e.firestore,e.converter,(s=t,new nn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class gc extends mu{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new gc(e,t,n)}_apply(e){const t=em(e,this.type,this._docOrFields,this._inclusive);return new vt(e.firestore,e.converter,(s=t,new nn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function em(r,e,t,n){if(t[0]=(0,me.Ku)(t[0]),t[0]instanceof pu)return function(s,l,h,f,m){if(!f)throw new A(B.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${h}().`);const I=[];for(const T of ti(s))if(T.field.isKeyField())I.push(pr(l,f.key));else{const P=f.data.field(T.field);if(Us(P))throw new A(B.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+T.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===P){const k=T.field.canonicalString();throw new A(B.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${k}' (used as the orderBy) does not exist.`)}I.push(P)}return new hn(I,m)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=ls(r.firestore);return function(l,h,f,m,I,T){const P=l.explicitOrderBy;if(I.length>P.length)throw new A(B.INVALID_ARGUMENT,`Too many arguments provided to ${m}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const k=[];for(let z=0;z<I.length;z++){const $=I[z];if(P[z].field.isKeyField()){if("string"!=typeof $)throw new A(B.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${m}(), but got a ${typeof $}`);if(!Bi(l)&&-1!==$.indexOf("/"))throw new A(B.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${m}() must be a plain document ID, but '${$}' contains a slash.`);const G=l.path.child(Ee.fromString($));if(!Y.isDocumentKey(G))throw new A(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${m}() must result in a valid document path, but '${G}' is not because it contains an odd number of segments.`);const Z=new Y(G);k.push(pr(h,Z))}else{const G=Hp(f,m,$);k.push(G)}}return new hn(k,T)}(r._query,r.firestore._databaseId,i,e,t,n)}}function tm(r,e,t){if("string"==typeof(t=(0,me.Ku)(t))){if(""===t)throw new A(B.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bi(e)&&-1!==t.indexOf("/"))throw new A(B.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Ee.fromString(t));if(!Y.isDocumentKey(n))throw new A(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return pr(r,new Y(n))}if(t instanceof Qe)return pr(r,t._key);throw new A(B.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ac(t)}.`)}function nm(r,e){if(!Array.isArray(r)||0===r.length)throw new A(B.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function rm(r,e){const t=function(i,s){for(const l of i)for(const h of l.getFlattenedFilters())if(s.indexOf(h.op)>=0)return h.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new A(B.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class tf{convertValue(e,t="none"){switch(In(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ke(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(yn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ne()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Wn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;const s=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(l=>ke(l.doubleValue));return new lc(s)}convertGeoPoint(e){return new uc(ke(e.latitude),ke(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Bs(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Di(e));default:return null}}convertTimestamp(e){const t=Pt(e);return new Ue(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ee.fromString(e);se(vo(n));const i=new Gn(n.get(1),n.get(3)),s=new Y(n.popFirst(5));return i.isEqual(t)||Me(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function yc(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class Iy extends tf{constructor(e){super(),this.firestore=e}convertBytes(e){return new rr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Qe(this.firestore,null,t)}}class hs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xr extends pu{constructor(e,t,n,i,s,l){super(e,t,n,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new gu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(pc("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class gu extends xr{data(e={}){return super.data(e)}}class Ii{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new hs(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new gu(this._firestore,this._userDataWriter,n.key,n,new hs(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new A(B.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map(h=>({type:"added",doc:new gu(i._firestore,i._userDataWriter,h.doc.key,h.doc,new hs(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:l++}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(h=>s||3!==h.type).map(h=>{const f=new gu(i._firestore,i._userDataWriter,h.doc.key,h.doc,new hs(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,I=-1;return 0!==h.type&&(m=l.indexOf(h.doc.key),l=l.delete(h.doc.key)),1!==h.type&&(l=l.add(h.doc),I=l.indexOf(h.doc.key)),{type:Ey(h.type),doc:f,oldIndex:m,newIndex:I}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ey(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ne()}}function sm(r,e){return r instanceof xr&&e instanceof xr?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Ii&&e instanceof Ii&&r._firestore===e._firestore&&Kd(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function om(r){r=ve(r,Qe);const e=ve(r.firestore,Fe);return xp(Je(e),r._key).then(t=>rf(e,r,t))}class vi extends tf{constructor(e){super(),this.firestore=e}convertBytes(e){return new rr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Qe(this.firestore,null,t)}}function nf(r,e,t){r=ve(r,Qe);const n=ve(r.firestore,Fe),i=yc(r.converter,e,t);return Jo(n,[hc(ls(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,Le.none())])}function am(r,e,t,...n){r=ve(r,Qe);const i=ve(r.firestore,Fe),s=ls(i);let l;return l="string"==typeof(e=(0,me.Ku)(e))||e instanceof Vr?Yd(s,"updateDoc",r._key,e,t,n):Jd(s,"updateDoc",r._key,e),Jo(i,[l.toMutation(r._key,Le.exists(!0))])}function um(r,...e){var t,n,i;r=(0,me.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},l=0;"object"!=typeof e[l]||Gd(e[l])||(s=e[l],l++);const h={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Gd(e[l])){const T=e[l];e[l]=null===(t=T.next)||void 0===t?void 0:t.bind(T),e[l+1]=null===(n=T.error)||void 0===n?void 0:n.bind(T),e[l+2]=null===(i=T.complete)||void 0===i?void 0:i.bind(T)}let f,m,I;if(r instanceof Qe)m=ve(r.firestore,Fe),I=$n(r._key.path),f={next:T=>{e[l]&&e[l](rf(m,r,T))},error:e[l+1],complete:e[l+2]};else{const T=ve(r,vt);m=ve(T.firestore,Fe),I=T._query;const P=new vi(m);f={next:k=>{e[l]&&e[l](new Ii(m,P,T,k))},error:e[l+1],complete:e[l+2]},Zp(r._query)}return function(P,k,z,$){const G=new ic($),Z=new od(k,G,z);return P.asyncQueue.enqueueAndForget((0,y.A)(function*(){return ed(yield Qo(P),Z)})),()=>{G.za(),P.asyncQueue.enqueueAndForget((0,y.A)(function*(){return nd(yield Qo(P),Z)}))}}(Je(m),I,h,f)}function Jo(r,e){return function(n,i){const s=new S;return n.asyncQueue.enqueueAndForget((0,y.A)(function*(){return function pg(r,e,t){return pd.apply(this,arguments)}(yield qd(n),i,s)})),s.promise}(Je(r),e)}function rf(r,e,t){const n=t.docs.get(e._key),i=new vi(r);return new xr(r,i,e._key,n,new hs(t.hasPendingWrites,t.fromCache),e.converter)}const Fy={maxAttempts:5};class lm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ls(e)}set(e,t,n){this._verifyNotCommitted();const i=Ei(e,this._firestore),s=yc(i.converter,t,n),l=hc(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(l.toMutation(i._key,Le.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Ei(e,this._firestore);let l;return l="string"==typeof(t=(0,me.Ku)(t))||t instanceof Vr?Yd(this._dataReader,"WriteBatch.update",s._key,t,n,i):Jd(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(l.toMutation(s._key,Le.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ei(e,this._firestore);return this._mutations=this._mutations.concat(new oi(t._key,Le.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new A(B.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ei(r,e){if((r=(0,me.Ku)(r)).firestore!==e)throw new A(B.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class Uy extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=ls(t)}get(t){const n=Ei(t,this._firestore),i=new Iy(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return ne();const l=s[0];if(l.isFoundDocument())return new pu(this._firestore,i,l.key,l,n.converter);if(l.isNoDocument())return new pu(this._firestore,i,n._key,null,n.converter);throw ne()})}set(t,n,i){const s=Ei(t,this._firestore),l=yc(s.converter,n,i),h=hc(this._dataReader,"Transaction.set",s._key,l,null!==s.converter,i);return this._transaction.set(s._key,h),this}update(t,n,i,...s){const l=Ei(t,this._firestore);let h;return h="string"==typeof(n=(0,me.Ku)(n))||n instanceof Vr?Yd(this._dataReader,"Transaction.update",l._key,n,i,s):Jd(this._dataReader,"Transaction.update",l._key,n),this._transaction.update(l._key,h),this}delete(t){const n=Ei(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ei(e,this._firestore),n=new vi(this._firestore);return super.get(e).then(i=>new xr(this._firestore,n,t._key,i._document,new hs(!1,!1),t.converter))}}function of(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new A("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function fm(){if(typeof Uint8Array>"u")throw new A("unimplemented","Uint8Arrays are not available in this environment.")}function pm(){if(!function Bf(){return typeof atob<"u"}())throw new A("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){Wt=Zt.SDK_VERSION,(0,Zt._registerComponent)(new Si.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const l=n.getProvider("app").getImmediate(),h=new Fe(new de(n.getProvider("auth-internal")),new ot(n.getProvider("app-check-internal")),function(m,I){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new A(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gn(m.options.projectId,I)}(l,i),l);return s=Object.assign({useFetchStreams:t},s),h._setSettings(s),h},"PUBLIC").setMultipleInstances(!0)),(0,Zt.registerVersion)(jr,"4.7.0",e),(0,Zt.registerVersion)(jr,"4.7.0","esm2017")}();class yu{constructor(e){this._delegate=e}static fromBase64String(e){return pm(),new yu(rr.fromBase64String(e))}static fromUint8Array(e){return fm(),new yu(rr.fromUint8Array(e))}toBase64(){return pm(),this._delegate.toBase64()}toUint8Array(){return fm(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function af(r){return function Hy(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class Jy{enableIndexedDbPersistence(e,t){return function Yg(r,e){Gp(r=ve(r,Fe));const t=Je(r);if(t._uninitializedComponentsProvider)throw new A(B.FAILED_PRECONDITION,"SDK cache is already specified.");dt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new jo;return Kp(t,i,new kd(i,n.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Xg(r){Gp(r=ve(r,Fe));const e=Je(r);if(e._uninitializedComponentsProvider)throw new A(B.FAILED_PRECONDITION,"SDK cache is already specified.");dt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new jo;return Kp(e,n,new Rp(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Zg(r){if(r._initialized&&!r._terminated)throw new A(B.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new S;return r._queue.enqueueAndForgetEvenWhileRestricted((0,y.A)(function*(){try{yield(t=(0,y.A)(function*(i){if(!ln.D())return Promise.resolve();const s=i+"main";yield ln.delete(s)}),function n(i){return t.apply(this,arguments)})(as(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class mm{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Gn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&dt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Bp(this._delegate,e,t,n)}enableNetwork(){return function ty(r){return function Og(r){return r.asyncQueue.enqueue((0,y.A)(function*(){const e=yield bp(r),t=yield Cp(r);return e.setNetworkEnabled(!0),function(i){const s=J(i);return s.L_.delete(0),uu(s)}(t)}))}(Je(r=ve(r,Fe)))}(this._delegate)}disableNetwork(){return function ny(r){return function Mg(r){return r.asyncQueue.enqueue((0,y.A)(function*(){const e=yield bp(r),t=yield Cp(r);return e.setNetworkEnabled(!1),(n=(0,y.A)(function*(s){const l=J(s);l.L_.add(0),yield Lo(l),l.q_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(Je(r=ve(r,Fe)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Op("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function ey(r){return function(t){const n=new S;return t.asyncQueue.enqueueAndForget((0,y.A)(function*(){return function yg(r,e){return Id.apply(this,arguments)}(yield qd(t),n)})),n.promise}(Je(r=ve(r,Fe)))}(this._delegate)}onSnapshotsInSync(e){return function Cy(r,e){return function Bg(r,e){const t=new ic(e);return r.asyncQueue.enqueueAndForget((0,y.A)(function*(){return i=yield Qo(r),s=t,J(i).Y_.add(s),void s.next();var i,s})),()=>{t.za(),r.asyncQueue.enqueueAndForget((0,y.A)(function*(){return i=yield Qo(r),s=t,void J(i).Y_.delete(s);var i,s}))}}(Je(r=ve(r,Fe)),Gd(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new A("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Yo(this,qp(this._delegate,e))}catch(t){throw Mt(t,"collection()","Firestore.collection()")}}doc(e){try{return new pn(this,cu(this._delegate,e))}catch(t){throw Mt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Lt(this,function jg(r,e){if(r=ve(r,lu),Wd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new A(B.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new vt(r,null,(n=e,new nn(Ee.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Mt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function By(r,e,t){r=ve(r,Fe);const n=Object.assign(Object.assign({},Fy),t);return function(s){if(s.maxAttempts<1)throw new A(B.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,l,h){const f=new S;return s.asyncQueue.enqueueAndForget((0,y.A)(function*(){const m=yield function Vp(r){return oc(r).then(e=>e.datastore)}(s);new Ng(s.asyncQueue,m,h,l,f).ru()})),f.promise}(Je(r),i=>e(new Uy(r,i)),n)}(this._delegate,t=>e(new _m(this,t)))}batch(){return Je(this._delegate),new gm(new lm(this._delegate,e=>Jo(this._delegate,e)))}loadBundle(e){return function ry(r,e){const t=Je(r=ve(r,Fe)),n=new Qg;return function qg(r,e,t,n){const i=function(l,h){let f;return f="string"==typeof l?ml().encode(l):l,I=function(I,T){if(I instanceof Uint8Array)return Pp(I,T);if(I instanceof ArrayBuffer)return Pp(new Uint8Array(I),T);if(I instanceof ReadableStream)return I.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(f),new xg(I,h);var I}(t,au(e));r.asyncQueue.enqueueAndForget((0,y.A)(function*(){!function Cg(r,e,t){const n=J(r);var i;(i=(0,y.A)(function*(l,h,f){try{const m=yield h.getMetadata();if(yield function(z,$){const G=J(z),Z=Ze($.createTime);return G.persistence.runTransaction("hasNewerBundle","readonly",oe=>G.Gr.getBundleMetadata(oe,$.id)).then(oe=>!!oe&&oe.createTime.compareTo(Z)>=0)}(l.localStore,m))return yield h.close(),f._completeWith({taskState:"Success",documentsLoaded:(z=m).totalDocuments,bytesLoaded:z.totalBytes,totalDocuments:z.totalDocuments,totalBytes:z.totalBytes}),Promise.resolve(new Set);f._updateProgress(mp(m));const I=new og(m,l.localStore,h.serializer);let T=yield h.Ua();for(;T;){const k=yield I.la(T);k&&f._updateProgress(k),T=yield h.Ua()}const P=yield I.complete();return yield Cr(l,P.Ia,void 0),yield function(z,$){const G=J(z);return G.persistence.runTransaction("Save bundle","readwrite",Z=>G.Gr.saveBundleMetadata(Z,$))}(l.localStore,m),f._completeWith(P.progress),Promise.resolve(P.Pa)}catch(m){return dt("SyncEngine",`Loading bundle failed with ${m}`),f._failWith(m),Promise.resolve(new Set)}var z}),function s(l,h,f){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield qd(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function iy(r,e){return function zg(r,e){return r.asyncQueue.enqueue((0,y.A)(function*(){return function(n,i){const s=J(n);return s.persistence.runTransaction("Get named query","readonly",l=>s.Gr.getNamedQuery(l,i))}(yield $o(r),e)}))}(Je(r=ve(r,Fe)),e).then(t=>t?new vt(r,null,t.query):null)}(this._delegate,e).then(t=>t?new Lt(this,t):null)}}class vc extends tf{constructor(e){super(),this.firestore=e}convertBytes(e){return new yu(new rr(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return pn.forKey(t,this.firestore,null)}}class _m{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new vc(e)}get(e){const t=fs(e);return this._delegate.get(t).then(n=>new Iu(this._firestore,new xr(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=fs(e);return n?(of("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=fs(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}}class gm{constructor(e){this._delegate=e}set(e,t,n){const i=fs(e);return n?(of("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=fs(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ds{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new gu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new vu(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=ds.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new ds(e,new vc(e),t),i.set(t,s)),s}}ds.INSTANCES=new WeakMap;class pn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new vc(e)}static forPath(e,t,n){if(e.length%2!=0)throw new A("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new pn(t,new Qe(t._delegate,n,new Y(e)))}static forKey(e,t,n){return new pn(t,new Qe(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Yo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Yo(this.firestore,qp(this._delegate,e))}catch(t){throw Mt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,me.Ku)(e))instanceof Qe&&zp(this._delegate,e)}set(e,t){t=of("DocumentReference.set",t);try{return t?nf(this._delegate,e,t):nf(this._delegate,e)}catch(n){throw Mt(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?am(this._delegate,e):am(this._delegate,e,t,...n)}catch(i){throw Mt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function Sy(r){return Jo(ve(r.firestore,Fe),[new oi(r._key,Le.none())])}(this._delegate)}onSnapshot(...e){const t=ym(e),n=Im(e,i=>new Iu(this.firestore,new xr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return um(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function Ty(r){r=ve(r,Qe);const e=ve(r.firestore,Fe),t=Je(e),n=new vi(e);return function Lg(r,e){const t=new S;return r.asyncQueue.enqueueAndForget((0,y.A)(function*(){return(n=(0,y.A)(function*(s,l,h){try{const f=yield function(I,T){const P=J(I);return P.persistence.runTransaction("read document","readonly",k=>P.localDocuments.getDocument(k,T))}(s,l);f.isFoundDocument()?h.resolve(f):f.isNoDocument()?h.resolve(null):h.reject(new A(B.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(f){const m=qo(f,`Failed to get document '${l} from cache`);h.reject(m)}}),function i(s,l,h){return n.apply(this,arguments)})(yield $o(r),e,t);var n})),t.promise}(t,r._key).then(i=>new xr(e,n,r._key,i,new hs(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function Ay(r){r=ve(r,Qe);const e=ve(r.firestore,Fe);return xp(Je(e),r._key,{source:"server"}).then(t=>rf(e,r,t))}(this._delegate):om(this._delegate),t.then(n=>new Iu(this.firestore,new xr(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new pn(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}function Mt(r,e,t){return r.message=r.message.replace(e,t),r}function ym(r){for(const e of r)if("object"==typeof e&&!af(e))return e;return{}}function Im(r,e){var t,n;let i;return i=af(r[0])?r[0]:af(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class Iu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new pn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return sm(this._delegate,e._delegate)}}class vu extends Iu{data(e){const t=this._delegate.data(e);return this._delegate._converter||function sa(r){r||ne()}(void 0!==t),t}}class Lt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new vc(e)}where(e,t,n){try{return new Lt(this.firestore,yi(this._delegate,function hy(r,e,t){const n=e,i=pc("where",r);return _u._create(i,n,t)}(e,t,n)))}catch(i){throw Mt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Lt(this.firestore,yi(this._delegate,function dy(r,e="asc"){const t=e,n=pc("orderBy",r);return ef._create(n,t)}(e,t)))}catch(n){throw Mt(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Lt(this.firestore,yi(this._delegate,function fy(r){return Fp("limit",r),mc._create("limit",r,"F")}(e)))}catch(t){throw Mt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Lt(this.firestore,yi(this._delegate,function py(r){return Fp("limitToLast",r),mc._create("limitToLast",r,"L")}(e)))}catch(t){throw Mt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Lt(this.firestore,yi(this._delegate,function my(...r){return _c._create("startAt",r,!0)}(...e)))}catch(t){throw Mt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Lt(this.firestore,yi(this._delegate,function _y(...r){return _c._create("startAfter",r,!1)}(...e)))}catch(t){throw Mt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Lt(this.firestore,yi(this._delegate,function gy(...r){return gc._create("endBefore",r,!1)}(...e)))}catch(t){throw Mt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Lt(this.firestore,yi(this._delegate,function yy(...r){return gc._create("endAt",r,!0)}(...e)))}catch(t){throw Mt(t,"endAt()","Query.endAt()")}}isEqual(e){return Kd(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function Ry(r){r=ve(r,vt);const e=ve(r.firestore,Fe),t=Je(e),n=new vi(e);return function Fg(r,e){const t=new S;return r.asyncQueue.enqueueAndForget((0,y.A)(function*(){return(n=(0,y.A)(function*(s,l,h){try{const f=yield Jl(s,l,!0),m=new yp(l,f.Ts),I=m.ma(f.documents),T=m.applyChanges(I,!1);h.resolve(T.snapshot)}catch(f){const m=qo(f,`Failed to execute query '${l} against cache`);h.reject(m)}}),function i(s,l,h){return n.apply(this,arguments)})(yield $o(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Ii(e,n,r,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function Py(r){r=ve(r,vt);const e=ve(r.firestore,Fe),t=Je(e),n=new vi(e);return Dp(t,r._query,{source:"server"}).then(i=>new Ii(e,n,r,i))}(this._delegate):function wy(r){r=ve(r,vt);const e=ve(r.firestore,Fe),t=Je(e),n=new vi(e);return Zp(r._query),Dp(t,r._query).then(i=>new Ii(e,n,r,i))}(this._delegate),t.then(n=>new uf(this.firestore,new Ii(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=ym(e),n=Im(e,i=>new uf(this.firestore,new Ii(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return um(this._delegate,t,n)}withConverter(e){return new Lt(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}class Xy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new vu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class uf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Lt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new vu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Xy(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new vu(this._firestore,n))})}isEqual(e){return sm(this._delegate,e._delegate)}}class Yo extends Lt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new pn(this.firestore,e):null}doc(e){try{return new pn(this.firestore,void 0===e?cu(this._delegate):cu(this._delegate,e))}catch(t){throw Mt(t,"doc()","CollectionReference.doc()")}}add(e){return function by(r,e){const t=ve(r.firestore,Fe),n=cu(r),i=yc(r.converter,e);return Jo(t,[hc(ls(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,Le.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new pn(this.firestore,t))}isEqual(e){return zp(this._delegate,e._delegate)}withConverter(e){return new Yo(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}function fs(r){return ve(r,Qe)}class lf{constructor(...e){this._delegate=new Vr(...e)}static documentId(){return new lf(Be.keyField().canonicalString())}isEqual(e){return(e=(0,me.Ku)(e))instanceof Vr&&this._delegate._internalPath.isEqual(e._internalPath)}}class ps{constructor(e){this._delegate=e}static serverTimestamp(){const e=function zy(){return new jd("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ps(e)}static delete(){const e=function qy(){return new du("deleteField")}();return e._methodName="FieldValue.delete",new ps(e)}static arrayUnion(...e){const t=function Wy(...r){return new $d("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new ps(t)}static arrayRemove(...e){const t=function Ky(...r){return new Qd("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new ps(t)}static increment(e){const t=function Gy(r){return new Hd("increment",r)}(e);return t._methodName="FieldValue.increment",new ps(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Zy={Firestore:mm,GeoPoint:uc,Timestamp:Ue,Blob:yu,Transaction:_m,WriteBatch:gm,DocumentReference:pn,DocumentSnapshot:Iu,Query:Lt,QueryDocumentSnapshot:vu,QuerySnapshot:uf,CollectionReference:Yo,FieldPath:lf,FieldValue:ps,setLogLevel:function Yy(r){!function kt(r){Kt.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};function vm(r,e){return function nI(r,e=ia.E){return new et.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=n&&n()}})}(r,e)}function cf(r,e){return vm(r,e).pipe((0,lt.T)(t=>({payload:t,type:"query"})))}!function tI(r){(function eI(r,e){r.INTERNAL.registerComponent(new Si.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},Zy)))})(r,(e,t)=>new mm(e,t,new Jy)),r.registerVersion("@firebase/firestore-compat","0.3.35")}(bi.A);class Em{constructor(e,t){(0,w.A)(this,"ref",void 0),(0,w.A)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=Rm(n,t);return new wm(i,s,this.afs)}snapshotChanges(){return function rI(r,e){return vm(r,e).pipe((0,qr.Z)(void 0),Mn(),(0,lt.T)(t=>{const[n,i]=t;return i.exists?null!=n&&n.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(fe.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,lt.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,st.H)(this.ref.get(e)).pipe(fe.U0)}}function Ec(r,e){return cf(r,e).pipe((0,qr.Z)(void 0),Mn(),(0,lt.T)(t=>{const[n,i]=t,s=i.payload.docChanges(),l=s.map(h=>({type:h.type,payload:h}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((h,f)=>{const m=s.find(T=>T.doc.ref.isEqual(h.ref)),I=null==n?void 0:n.payload.docs.find(T=>T.ref.isEqual(h.ref));m&&JSON.stringify(m.doc.metadata)===JSON.stringify(h.metadata)||!m&&I&&JSON.stringify(I.metadata)===JSON.stringify(h.metadata)||l.push({type:"modified",payload:{oldIndex:f,newIndex:f,type:"modified",doc:h}})}),l}))}function Tm(r,e,t){return Ec(r,t).pipe((0,sr.S)((n,i)=>function iI(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function sI(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return hf(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return hf(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return hf(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,ws.F)(),(0,lt.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function hf(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function Am(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class wm{constructor(e,t,n){(0,w.A)(this,"ref",void 0),(0,w.A)(this,"query",void 0),(0,w.A)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Ec(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,lt.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,qr.Z)(void 0),Mn(),(0,ir.p)(([n,i])=>i.length>0||!n),(0,lt.T)(([,n])=>n),fe.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,sr.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Am(e);return Tm(this.query,t,this.afs.schedulers.outsideAngular).pipe(fe.U0)}valueChanges(e={}){return cf(this.query,this.afs.schedulers.outsideAngular).pipe((0,lt.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),fe.U0)}get(e){return(0,st.H)(this.query.get(e)).pipe(fe.U0)}add(e){return this.ref.add(e)}doc(e){return new Em(this.ref.doc(e),this.afs)}}class oI{constructor(e,t){(0,w.A)(this,"query",void 0),(0,w.A)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Ec(this.query,this.afs.schedulers.outsideAngular).pipe((0,lt.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,ir.p)(t=>t.length>0),fe.U0):Ec(this.query,this.afs.schedulers.outsideAngular).pipe(fe.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,sr.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Am(e);return Tm(this.query,t,this.afs.schedulers.outsideAngular).pipe(fe.U0)}valueChanges(e={}){return cf(this.query,this.afs.schedulers.outsideAngular).pipe((0,lt.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),fe.U0)}get(e){return(0,st.H)(this.query.get(e)).pipe(fe.U0)}}const aI=new Q.nKC("angularfire2.enableFirestorePersistence"),uI=new Q.nKC("angularfire2.firestore.persistenceSettings"),lI=new Q.nKC("angularfire2.firestore.settings"),cI=new Q.nKC("angularfire2.firestore.use-emulator");function Rm(r,e=t=>t){return{query:e(r),ref:r}}let hI=(()=>{var r;class e{constructor(n,i,s,l,h,f,m,I,T,P,k,z,$,G,Z,oe,ae){(0,w.A)(this,"schedulers",void 0),(0,w.A)(this,"firestore",void 0),(0,w.A)(this,"persistenceEnabled$",void 0),this.schedulers=m;const ie=(0,We.iB)(n,f,i),pe=T;P&&De(ie,f,k,$,G,Z,z,oe),[this.firestore,this.persistenceEnabled$]=(0,We.BM)(`${ie.name}.firestore`,"AngularFirestore",ie.name,()=>{const ce=f.runOutsideAngular(()=>ie.firestore());if(l&&ce.settings(l),pe&&ce.useEmulator(...pe),s&&!(0,Tt.Vy)(h)){const D=()=>{try{return(0,st.H)(ce.enablePersistence(I||void 0).then(()=>!0,()=>!1))}catch(R){return typeof console<"u"&&console.warn(R),(0,Oe.of)(!1)}};return[ce,f.runOutsideAngular(D)]}return[ce,(0,Oe.of)(!1)]},[l,pe,s])}collection(n,i){let s;s="string"==typeof n?this.firestore.collection(n):n;const{ref:l,query:h}=Rm(s,i),f=this.schedulers.ngZone.run(()=>l);return new wm(f,h,this)}collectionGroup(n,i){const s=i||(h=>h),l=this.firestore.collectionGroup(n);return new oI(s(l),this)}doc(n){let i;i="string"==typeof n?this.firestore.doc(n):n;const s=this.schedulers.ngZone.run(()=>i);return new Em(s,this)}createId(){return this.firestore.collection("_").doc().id}}return r=e,(0,w.A)(e,"\u0275fac",function(n){return new(n||r)(Q.KVO(We.rx),Q.KVO(We.uP,8),Q.KVO(aI,8),Q.KVO(lI,8),Q.KVO(Q.Agw),Q.KVO(Q.SKi),Q.KVO(fe.u0),Q.KVO(uI,8),Q.KVO(cI,8),Q.KVO(xe,8),Q.KVO(Es,8),Q.KVO(kn,8),Q.KVO(Ur,8),Q.KVO(Br,8),Q.KVO(Ts,8),Q.KVO(As,8),Q.KVO(fe.Jv,8))}),(0,w.A)(e,"\u0275prov",Q.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})),e})();ee(2214);const bm=(0,fe.S3)(cu,!0),TI=(0,fe.S3)(om,!0),Cm=(0,fe.S3)(Jg,!0),AI=(0,fe.S3)(nf,!0);let wI=(()=>{var r;class e{constructor(){this.auth=(0,Q.WQX)(xe),this.firestore=(0,Q.WQX)(hI)}signIn(n){return(0,mn.ab)((0,mn.o)(),n.email,n.password)}signUp(n){return(0,mn.aa)((0,mn.o)(),n.email,n.password)}updateUser(n){return(0,mn.ak)((0,mn.o)().currentUser,{displayName:n})}setDocument(n,i){return AI(bm(Cm(),n),i)}getDocument(n){return(0,y.A)(function*(){return(yield TI(bm(Cm(),n))).data()})()}}return(r=e).\u0275fac=function(n){return new(n||r)},r.\u0275prov=Q.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),e})()},6552:(Is,an,ee)=>{ee.d(an,{T:()=>Tt});var y=ee(467),Q=ee(3953),w=ee(4742),Ae=ee(4964);let Tt=(()=>{var fe;class We{constructor(){this.loadingCtrl=(0,Q.WQX)(w.Xi),this.toastCtrl=(0,Q.WQX)(w.K_),this.router=(0,Q.WQX)(Ae.Ix)}loading(){return this.loadingCtrl.create({spinner:"crescent"})}presentToast(Oe){var et=this;return(0,y.A)(function*(){(yield et.toastCtrl.create(Oe)).present()})()}routerLink(Oe){return this.router.navigateByUrl(Oe)}saveInLocalStorage(Oe,et){return localStorage.setItem(Oe,JSON.stringify(et))}getFromLocalStorage(Oe){return JSON.parse(localStorage.getItem(Oe))}}return(fe=We).\u0275fac=function(Oe){return new(Oe||fe)},fe.\u0275prov=Q.jDH({token:fe,factory:fe.\u0275fac,providedIn:"root"}),We})()},3683:(Is,an,ee)=>{ee.d(an,{H:()=>We});var y=ee(3953),Q=ee(177),w=ee(4742),Ae=ee(4341);function Tt(Re,Oe){if(1&Re&&y.nrm(0,"ion-icon",4),2&Re){const et=y.XpG();y.Y8G("name",et.icon)}}function fe(Re,Oe){if(1&Re){const et=y.RV6();y.j41(0,"ion-button",5),y.bIt("click",function(){y.eBV(et);const Bt=y.XpG();return y.Njj(Bt.showOrHidePassword())}),y.nrm(1,"ion-icon",6),y.k0s()}if(2&Re){const et=y.XpG();y.R7$(),y.Y8G("name",et.hide?"eye-outline":"eye-off-outline")}}let We=(()=>{var Re;class Oe{constructor(){this.hide=!0}ngOnInit(){"password"==this.type&&(this.isPassword=!0)}showOrHidePassword(){this.hide=!this.hide,this.type=this.hide?"password":"text"}}return(Re=Oe).\u0275fac=function(st){return new(st||Re)},Re.\u0275cmp=y.VBU({type:Re,selectors:[["app-custom-input"]],inputs:{control:"control",type:"type",label:"label",autocomplete:"autocomplete",icon:"icon"},decls:4,vars:6,consts:[["lines","none",1,"custom-input","ion-margin-vertical"],["color","","slot","start",3,"name",4,"ngIf"],["label-placement","floating",3,"type","autocomplete","label","formControl"],["slot","end","expand","block","fill","clear","shape","round","size","medium",3,"click",4,"ngIf"],["color","","slot","start",3,"name"],["slot","end","expand","block","fill","clear","shape","round","size","medium",3,"click"],["slot","icon-only",3,"name"]],template:function(st,Bt){1&st&&(y.j41(0,"ion-item",0),y.DNE(1,Tt,1,1,"ion-icon",1),y.nrm(2,"ion-input",2),y.DNE(3,fe,2,1,"ion-button",3),y.k0s()),2&st&&(y.R7$(),y.Y8G("ngIf",Bt.icon),y.R7$(),y.Y8G("type",Bt.type)("autocomplete",Bt.autocomplete)("label",Bt.label)("formControl",Bt.control),y.R7$(),y.Y8G("ngIf",Bt.isPassword))},dependencies:[Q.bT,w.Jm,w.iq,w.$w,w.uz,w.Gw,Ae.BC,Ae.l_]}),Oe})()},9381:(Is,an,ee)=>{ee.d(an,{l:()=>Tt});var y=ee(3953),Q=ee(177),w=ee(4742);function Ae(fe,We){if(1&fe&&y.nrm(0,"ion-back-button",5),2&fe){const Re=y.XpG();y.Y8G("defaultHref",Re.backButton)}}let Tt=(()=>{var fe;class We{constructor(){}ngOnInit(){}}return(fe=We).\u0275fac=function(Oe){return new(Oe||fe)},fe.\u0275cmp=y.VBU({type:fe,selectors:[["app-header"]],inputs:{title:"title",backButton:"backButton"},decls:9,vars:2,consts:[[1,"ion-no-border"],["color","primary"],["slot","start"],[3,"defaultHref",4,"ngIf"],[1,"admin"],[3,"defaultHref"]],template:function(Oe,et){1&Oe&&(y.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),y.DNE(3,Ae,1,1,"ion-back-button",3),y.k0s(),y.j41(4,"ion-title")(5,"strong"),y.EFF(6),y.k0s(),y.j41(7,"div",4),y.EFF(8,"Retail Off"),y.k0s()()()()),2&Oe&&(y.R7$(3),y.Y8G("ngIf",et.backButton),y.R7$(3),y.JRh(et.title))},dependencies:[Q.bT,w.QW,w.eU,w.BC,w.ai,w.el],styles:[".admin[_ngcontent-%COMP%]{font-size:13px}"]}),We})()},9981:(Is,an,ee)=>{ee.d(an,{Z:()=>w});var y=ee(3953),Q=ee(4742);let w=(()=>{var Ae;class Tt{constructor(){}ngOnInit(){}}return(Ae=Tt).\u0275fac=function(We){return new(We||Ae)},Ae.\u0275cmp=y.VBU({type:Ae,selectors:[["app-logo"]],decls:6,vars:0,consts:[["color","primary","name","shield-outline",1,"shield-icon"],["color","primary"]],template:function(We,Re){1&We&&(y.nrm(0,"ion-icon",0),y.j41(1,"ion-text",1)(2,"h1")(3,"strong"),y.EFF(4,"Retail"),y.k0s(),y.EFF(5,"Off"),y.k0s()())},dependencies:[Q.iq,Q.IO],styles:[".shield-icon[_ngcontent-%COMP%]{font-size:80px;margin-top:40px}h1[_ngcontent-%COMP%]{margin-top:0}"]}),Tt})()},2438:(Is,an,ee)=>{var y=ee(467),Q=ee(3345),w=ee(257),Ae=ee(1076),We=(ee(7852),ee(8041),ee(1362));function Re(){return window}function st(){return st=(0,y.A)(function*(A,S,b){var W;const{BuildInfo:te}=Re();(0,w.au)(S.sessionId,"AuthEvent did not contain a session ID");const de=yield function Dt(A){return lt.apply(this,arguments)}(S.sessionId),Pe={};return(0,w.av)()?Pe.ibi=te.packageName:(0,w.aw)()?Pe.apn=te.packageName:(0,w.ax)(A,"operation-not-supported-in-this-environment"),te.displayName&&(Pe.appDisplayName=te.displayName),Pe.sessionId=de,(0,w.ay)(A,b,S.type,void 0,null!==(W=S.eventId)&&void 0!==W?W:void 0,Pe)}),st.apply(this,arguments)}function Dn(){return(Dn=(0,y.A)(function*(A){const{BuildInfo:S}=Re(),b={};(0,w.av)()?b.iosBundleId=S.packageName:(0,w.aw)()?b.androidPackageName=S.packageName:(0,w.ax)(A,"operation-not-supported-in-this-environment"),yield(0,w.az)(A,b)})).apply(this,arguments)}function Or(){return(Or=(0,y.A)(function*(A,S,b){const{cordova:W}=Re();let te=()=>{};try{yield new Promise((de,Pe)=>{let be=null;function $e(){var we;de();const jt=null===(we=W.plugins.browsertab)||void 0===we?void 0:we.close;"function"==typeof jt&&jt(),"function"==typeof(null==b?void 0:b.close)&&b.close()}function ot(){be||(be=window.setTimeout(()=>{Pe((0,w.aB)(A,"redirect-cancelled-by-user"))},2e3))}function Gt(){"visible"===(null==document?void 0:document.visibilityState)&&ot()}S.addPassiveListener($e),document.addEventListener("resume",ot,!1),(0,w.aw)()&&document.addEventListener("visibilitychange",Gt,!1),te=()=>{S.removePassiveListener($e),document.removeEventListener("resume",ot,!1),document.removeEventListener("visibilitychange",Gt,!1),be&&window.clearTimeout(be)}})}finally{te()}})).apply(this,arguments)}function lt(){return(lt=(0,y.A)(function*(A){const S=function Mr(A){if((0,w.au)(/[0-9a-zA-Z]+/.test(A),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(A);const S=new ArrayBuffer(A.length),b=new Uint8Array(S);for(let W=0;W<A.length;W++)b[W]=A.charCodeAt(W);return b}(A),b=yield crypto.subtle.digest("SHA-256",S);return Array.from(new Uint8Array(b)).map(te=>te.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class rt extends w.aD{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(S=>{this.resolveInitialized=S})}addPassiveListener(S){this.passiveListeners.add(S)}removePassiveListener(S){this.passiveListeners.delete(S)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(S){return this.resolveInitialized(),this.passiveListeners.forEach(b=>b(S)),super.onEvent(S)}initialized(){var S=this;return(0,y.A)(function*(){yield S.initPromise})()}}function Yt(A){return Nn.apply(this,arguments)}function Nn(){return(Nn=(0,y.A)(function*(A){const S=yield yt()._get(Xt(A));return S&&(yield yt()._remove(Xt(A))),S})).apply(this,arguments)}function qt(){const A=[];for(let b=0;b<20;b++){const W=Math.floor(62*Math.random());A.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(W))}return A.join("")}function yt(){return(0,w.aE)(w.b)}function Xt(A){return(0,w.aF)("authEvent",A.config.apiKey,A.name)}function Fr(A){if(null==A||!A.includes("?"))return{};const[S,...b]=A.split("?");return(0,Ae.I9)(b.join("?"))}const Ur=class kn{constructor(){this._redirectPersistence=w.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=w.aG,this._overrideRedirectResult=w.aH}_initialize(S){var b=this;return(0,y.A)(function*(){const W=S._key();let te=b.eventManagers.get(W);return te||(te=new rt(S),b.eventManagers.set(W,te),b.attachCallbackListeners(S,te)),te})()}_openPopup(S){(0,w.ax)(S,"operation-not-supported-in-this-environment")}_openRedirect(S,b,W,te){var de=this;return(0,y.A)(function*(){!function Pi(A){var S,b,W,te,de,Pe,be,$e,ot,Gt;const we=Re();(0,w.aC)("function"==typeof(null===(S=null==we?void 0:we.universalLinks)||void 0===S?void 0:S.subscribe),A,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,w.aC)(typeof(null===(b=null==we?void 0:we.BuildInfo)||void 0===b?void 0:b.packageName)<"u",A,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,w.aC)("function"==typeof(null===(de=null===(te=null===(W=null==we?void 0:we.cordova)||void 0===W?void 0:W.plugins)||void 0===te?void 0:te.browsertab)||void 0===de?void 0:de.openUrl),A,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,w.aC)("function"==typeof(null===($e=null===(be=null===(Pe=null==we?void 0:we.cordova)||void 0===Pe?void 0:Pe.plugins)||void 0===be?void 0:be.browsertab)||void 0===$e?void 0:$e.isAvailable),A,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,w.aC)("function"==typeof(null===(Gt=null===(ot=null==we?void 0:we.cordova)||void 0===ot?void 0:ot.InAppBrowser)||void 0===Gt?void 0:Gt.open),A,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(S);const Pe=yield de._initialize(S);yield Pe.initialized(),Pe.resetRedirect(),(0,w.aI)(),yield de._originValidation(S);const be=function Lr(A,S,b=null){return{type:S,eventId:b,urlResponse:null,sessionId:qt(),postBody:null,tenantId:A.tenantId,error:(0,w.aB)(A,"no-auth-event")}}(S,W,te);yield function tt(A,S){return yt()._set(Xt(A),S)}(S,be);const $e=yield function et(A,S,b){return st.apply(this,arguments)}(S,be,b),ot=yield function na(A){const{cordova:S}=Re();return new Promise(b=>{S.plugins.browsertab.isAvailable(W=>{let te=null;W?S.plugins.browsertab.openUrl(A):te=S.InAppBrowser.open(A,(0,w.aA)()?"_blank":"_system","location=yes"),b(te)})})}($e);return function vs(A,S,b){return Or.apply(this,arguments)}(S,Pe,ot)})()}_isIframeWebStorageSupported(S,b){throw new Error("Method not implemented.")}_originValidation(S){const b=S._key();return this.originValidationPromises[b]||(this.originValidationPromises[b]=function Bt(A){return Dn.apply(this,arguments)}(S)),this.originValidationPromises[b]}attachCallbackListeners(S,b){const{universalLinks:W,handleOpenURL:te,BuildInfo:de}=Re(),Pe=setTimeout((0,y.A)(function*(){yield Yt(S),b.onEvent(Br())}),500),be=function(){var Gt=(0,y.A)(function*(we){clearTimeout(Pe);const jt=yield Yt(S);let he=null;jt&&null!=we&&we.url&&(he=function H(A,S){var b,W;const te=function ra(A){const S=Fr(A),b=S.link?decodeURIComponent(S.link):void 0,W=Fr(b).link,te=S.deep_link_id?decodeURIComponent(S.deep_link_id):void 0;return Fr(te).link||te||W||b||A}(S);if(te.includes("/__/auth/callback")){const de=Fr(te),Pe=de.firebaseError?function ir(A){try{return JSON.parse(A)}catch{return null}}(decodeURIComponent(de.firebaseError)):null,be=null===(W=null===(b=null==Pe?void 0:Pe.code)||void 0===b?void 0:b.split("auth/"))||void 0===W?void 0:W[1],$e=be?(0,w.aB)(be):null;return $e?{type:A.type,eventId:A.eventId,tenantId:A.tenantId,error:$e,urlResponse:null,sessionId:null,postBody:null}:{type:A.type,eventId:A.eventId,tenantId:A.tenantId,sessionId:A.sessionId,urlResponse:te,postBody:null}}return null}(jt,we.url)),b.onEvent(he||Br())});return function(jt){return Gt.apply(this,arguments)}}();typeof W<"u"&&"function"==typeof W.subscribe&&W.subscribe(null,be);const $e=te,ot=`${de.packageName.toLowerCase()}://`;Re().handleOpenURL=function(){var Gt=(0,y.A)(function*(we){if(we.toLowerCase().startsWith(ot)&&be({url:we}),"function"==typeof $e)try{$e(we)}catch(jt){console.error(jt)}});return function(we){return Gt.apply(this,arguments)}}()}};function Br(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,w.aB)("no-auth-event")}}function On(){var A;return(null===(A=null==self?void 0:self.location)||void 0===A?void 0:A.protocol)||null}function Zt(A=(0,Ae.ZQ)()){return!("file:"!==On()&&"ionic:"!==On()&&"capacitor:"!==On()||!A.toLowerCase().match(/iphone|ipad|ipod|android/))}function qr(){try{const A=self.localStorage,S=w.aN();if(A)return A.setItem(S,"1"),A.removeItem(S),!function ia(A=(0,Ae.ZQ)()){return function At(){return(0,Ae.lT)()&&11===(null==document?void 0:document.documentMode)}()||function Si(A=(0,Ae.ZQ)()){return/Edge\/\d+/.test(A)}(A)}()||(0,Ae.zW)()}catch{return _n()&&(0,Ae.zW)()}return!1}function _n(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Mn(){return(function mn(){return"http:"===On()||"https:"===On()}()||(0,Ae.sr)()||Zt())&&!function me(){return(0,Ae.lV)()||(0,Ae.Ll)()}()&&qr()&&!_n()}function sr(){return Zt()&&typeof document<"u"}function bi(){return(bi=(0,y.A)(function*(){return!!sr()&&new Promise(A=>{const S=setTimeout(()=>{A(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(S),A(!0)})})})).apply(this,arguments)}const ht={LOCAL:"local",NONE:"none",SESSION:"session"},It=w.aC,Ci="persistence";function Nt(A){return Fn.apply(this,arguments)}function Fn(){return(Fn=(0,y.A)(function*(A){yield A._initializationPromise;const S=un(),b=w.aF(Ci,A.config.apiKey,A.name);S&&S.setItem(b,A._getPersistence())})).apply(this,arguments)}function un(){var A;try{return(null===(A=function zr(){return typeof window<"u"?window:null}())||void 0===A?void 0:A.sessionStorage)||null}catch{return null}}const Un=w.aC;class zt{constructor(){this.browserResolver=w.aE(w.k),this.cordovaResolver=w.aE(Ur),this.underlyingResolver=null,this._redirectPersistence=w.a,this._completeRedirectFn=w.aG,this._overrideRedirectResult=w.aH}_initialize(S){var b=this;return(0,y.A)(function*(){return yield b.selectUnderlyingResolver(),b.assertedUnderlyingResolver._initialize(S)})()}_openPopup(S,b,W,te){var de=this;return(0,y.A)(function*(){return yield de.selectUnderlyingResolver(),de.assertedUnderlyingResolver._openPopup(S,b,W,te)})()}_openRedirect(S,b,W,te){var de=this;return(0,y.A)(function*(){return yield de.selectUnderlyingResolver(),de.assertedUnderlyingResolver._openRedirect(S,b,W,te)})()}_isIframeWebStorageSupported(S,b){this.assertedUnderlyingResolver._isIframeWebStorageSupported(S,b)}_originValidation(S){return this.assertedUnderlyingResolver._originValidation(S)}get _shouldInitProactively(){return sr()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Un(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var S=this;return(0,y.A)(function*(){if(S.underlyingResolver)return;const b=yield function ws(){return bi.apply(this,arguments)}();S.underlyingResolver=b?S.cordovaResolver:S.browserResolver})()}}function Wr(A){return A.unwrap()}function Gr(A){return jr(A)}function jr(A){const{_tokenResponse:S}=A instanceof Ae.g?A.customData:A;if(!S)return null;if(!(A instanceof Ae.g)&&"temporaryProof"in S&&"phoneNumber"in S)return w.P.credentialFromResult(A);const b=S.providerId;if(!b||b===w.p.PASSWORD)return null;let W;switch(b){case w.p.GOOGLE:W=w.X;break;case w.p.FACEBOOK:W=w.W;break;case w.p.GITHUB:W=w.Y;break;case w.p.TWITTER:W=w.$;break;default:const{oauthIdToken:te,oauthAccessToken:de,oauthTokenSecret:Pe,pendingToken:be,nonce:$e}=S;return de||Pe||te||be?be?b.startsWith("saml.")?w.aQ._create(b,be):w.N._fromParams({providerId:b,signInMethod:b,pendingToken:be,idToken:te,accessToken:de}):new w.Z(b).credential({idToken:te,accessToken:de,rawNonce:$e}):null}return A instanceof Ae.g?W.credentialFromError(A):W.credentialFromResult(A)}function _e(A,S){return S.catch(b=>{throw b instanceof Ae.g&&function or(A,S){var b;const W=null===(b=S.customData)||void 0===b?void 0:b._tokenResponse;if("auth/multi-factor-auth-required"===(null==S?void 0:S.code))S.resolver=new Bn(A,w.as(A,S));else if(W){const te=jr(S),de=S;te&&(de.credential=te,de.tenantId=W.tenantId||void 0,de.email=W.email||void 0,de.phoneNumber=W.phoneNumber||void 0)}}(A,b),b}).then(b=>{const te=b.user;return{operationType:b.operationType,credential:Gr(b),additionalUserInfo:w.aq(b),user:kt.getOrCreate(te)}})}function Wt(A,S){return Kt.apply(this,arguments)}function Kt(){return(Kt=(0,y.A)(function*(A,S){const b=yield S;return{verificationId:b.verificationId,confirm:W=>_e(A,b.confirm(W))}})).apply(this,arguments)}class Bn{constructor(S,b){this.resolver=b,this.auth=function Kr(A){return A.wrapped()}(S)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(S){return _e(Wr(this.auth),this.resolver.resolveSignIn(S))}}class kt{constructor(S){this._delegate=S,this.multiFactor=w.at(S)}static getOrCreate(S){return kt.USER_MAP.has(S)||kt.USER_MAP.set(S,new kt(S)),kt.USER_MAP.get(S)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(S){return this._delegate.getIdTokenResult(S)}getIdToken(S){return this._delegate.getIdToken(S)}linkAndRetrieveDataWithCredential(S){return this.linkWithCredential(S)}linkWithCredential(S){var b=this;return(0,y.A)(function*(){return _e(b.auth,w.a2(b._delegate,S))})()}linkWithPhoneNumber(S,b){var W=this;return(0,y.A)(function*(){return Wt(W.auth,w.l(W._delegate,S,b))})()}linkWithPopup(S){var b=this;return(0,y.A)(function*(){return _e(b.auth,w.d(b._delegate,S,zt))})()}linkWithRedirect(S){var b=this;return(0,y.A)(function*(){return yield Nt(w.aJ(b.auth)),w.g(b._delegate,S,zt)})()}reauthenticateAndRetrieveDataWithCredential(S){return this.reauthenticateWithCredential(S)}reauthenticateWithCredential(S){var b=this;return(0,y.A)(function*(){return _e(b.auth,w.a3(b._delegate,S))})()}reauthenticateWithPhoneNumber(S,b){return Wt(this.auth,w.r(this._delegate,S,b))}reauthenticateWithPopup(S){return _e(this.auth,w.e(this._delegate,S,zt))}reauthenticateWithRedirect(S){var b=this;return(0,y.A)(function*(){return yield Nt(w.aJ(b.auth)),w.h(b._delegate,S,zt)})()}sendEmailVerification(S){return w.ag(this._delegate,S)}unlink(S){var b=this;return(0,y.A)(function*(){return yield w.ap(b._delegate,S),b})()}updateEmail(S){return w.al(this._delegate,S)}updatePassword(S){return w.am(this._delegate,S)}updatePhoneNumber(S){return w.u(this._delegate,S)}updateProfile(S){return w.ak(this._delegate,S)}verifyBeforeUpdateEmail(S,b){return w.ah(this._delegate,S,b)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}kt.USER_MAP=new WeakMap;const K=w.aC;let Me=(()=>{class A{constructor(b,W){if(this.app=b,W.isInitialized())return this._delegate=W.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:te}=b.options;K(te,"invalid-api-key",{appName:b.name}),K(te,"invalid-api-key",{appName:b.name});const de=typeof window<"u"?zt:void 0;this._delegate=W.initialize({options:{persistence:ar(te,b.name),popupRedirectResolver:de}}),this._delegate._updateErrorMap(w.G),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?kt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(b){this._delegate.languageCode=b}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(b){this._delegate.tenantId=b}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(b,W){w.K(this._delegate,b,W)}applyActionCode(b){return w.a7(this._delegate,b)}checkActionCode(b){return w.a8(this._delegate,b)}confirmPasswordReset(b,W){return w.a6(this._delegate,b,W)}createUserWithEmailAndPassword(b,W){var te=this;return(0,y.A)(function*(){return _e(te._delegate,w.aa(te._delegate,b,W))})()}fetchProvidersForEmail(b){return this.fetchSignInMethodsForEmail(b)}fetchSignInMethodsForEmail(b){return w.af(this._delegate,b)}isSignInWithEmailLink(b){return w.ad(this._delegate,b)}getRedirectResult(){var b=this;return(0,y.A)(function*(){K(Mn(),b._delegate,"operation-not-supported-in-this-environment");const W=yield w.j(b._delegate,zt);return W?_e(b._delegate,Promise.resolve(W)):{credential:null,user:null}})()}addFrameworkForLogging(b){!function Ts(A,S){(0,w.aJ)(A)._logFramework(S)}(this._delegate,b)}onAuthStateChanged(b,W,te){const{next:de,error:Pe,complete:be}=dt(b,W,te);return this._delegate.onAuthStateChanged(de,Pe,be)}onIdTokenChanged(b,W,te){const{next:de,error:Pe,complete:be}=dt(b,W,te);return this._delegate.onIdTokenChanged(de,Pe,be)}sendSignInLinkToEmail(b,W){return w.ac(this._delegate,b,W)}sendPasswordResetEmail(b,W){return w.a5(this._delegate,b,W||void 0)}setPersistence(b){var W=this;return(0,y.A)(function*(){let te;switch(function Ln(A,S){It(Object.values(ht).includes(S),A,"invalid-persistence-type"),(0,Ae.lV)()?It(S!==ht.SESSION,A,"unsupported-persistence-type"):(0,Ae.Ll)()?It(S===ht.NONE,A,"unsupported-persistence-type"):_n()?It(S===ht.NONE||S===ht.LOCAL&&(0,Ae.zW)(),A,"unsupported-persistence-type"):It(S===ht.NONE||qr(),A,"unsupported-persistence-type")}(W._delegate,b),b){case ht.SESSION:te=w.a;break;case ht.LOCAL:te=(yield w.aE(w.i)._isAvailable())?w.i:w.b;break;case ht.NONE:te=w.U;break;default:return w.ax("argument-error",{appName:W._delegate.name})}return W._delegate.setPersistence(te)})()}signInAndRetrieveDataWithCredential(b){return this.signInWithCredential(b)}signInAnonymously(){return _e(this._delegate,w.a0(this._delegate))}signInWithCredential(b){return _e(this._delegate,w.a1(this._delegate,b))}signInWithCustomToken(b){return _e(this._delegate,w.a4(this._delegate,b))}signInWithEmailAndPassword(b,W){return _e(this._delegate,w.ab(this._delegate,b,W))}signInWithEmailLink(b,W){return _e(this._delegate,w.ae(this._delegate,b,W))}signInWithPhoneNumber(b,W){return Wt(this._delegate,w.s(this._delegate,b,W))}signInWithPopup(b){var W=this;return(0,y.A)(function*(){return K(Mn(),W._delegate,"operation-not-supported-in-this-environment"),_e(W._delegate,w.c(W._delegate,b,zt))})()}signInWithRedirect(b){var W=this;return(0,y.A)(function*(){return K(Mn(),W._delegate,"operation-not-supported-in-this-environment"),yield Nt(W._delegate),w.f(W._delegate,b,zt)})()}updateCurrentUser(b){return this._delegate.updateCurrentUser(b)}verifyPasswordResetCode(b){return w.a9(this._delegate,b)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return A.Persistence=ht,A})();function dt(A,S,b){let W=A;"function"!=typeof A&&({next:W,error:S,complete:b}=A);const te=W;return{next:Pe=>te(Pe&&kt.getOrCreate(Pe)),error:S,complete:b}}function ar(A,S){const b=function Vi(A,S){const b=un();if(!b)return[];const W=w.aF(Ci,A,S);switch(b.getItem(W)){case ht.NONE:return[w.U];case ht.LOCAL:return[w.i,w.a];case ht.SESSION:return[w.a];default:return[]}}(A,S);if(typeof self<"u"&&!b.includes(w.i)&&b.push(w.i),typeof window<"u")for(const W of[w.b,w.a])b.includes(W)||b.push(W);return b.includes(w.U)||b.push(w.U),b}class ne{constructor(){this.providerId="phone",this._delegate=new w.P(Wr(Q.A.auth()))}static credential(S,b){return w.P.credential(S,b)}verifyPhoneNumber(S,b){return this._delegate.verifyPhoneNumber(S,b)}unwrap(){return this._delegate}}ne.PHONE_SIGN_IN_METHOD=w.P.PHONE_SIGN_IN_METHOD,ne.PROVIDER_ID=w.P.PROVIDER_ID;const se=w.aC;class sa{constructor(S,b,W=Q.A.app()){var te;se(null===(te=W.options)||void 0===te?void 0:te.apiKey,"invalid-api-key",{appName:W.name}),this._delegate=new w.R(W.auth(),S,b),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function B(A){A.INTERNAL.registerComponent(new We.uA("auth-compat",S=>{const b=S.getProvider("app-compat").getImmediate(),W=S.getProvider("auth");return new Me(b,W)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:w.A.EMAIL_SIGNIN,PASSWORD_RESET:w.A.PASSWORD_RESET,RECOVER_EMAIL:w.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:w.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:w.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:w.A.VERIFY_EMAIL}},EmailAuthProvider:w.V,FacebookAuthProvider:w.W,GithubAuthProvider:w.Y,GoogleAuthProvider:w.X,OAuthProvider:w.Z,SAMLAuthProvider:w._,PhoneAuthProvider:ne,PhoneMultiFactorGenerator:w.m,RecaptchaVerifier:sa,TwitterAuthProvider:w.$,Auth:Me,AuthCredential:w.L,Error:Ae.g}).setInstantiationMode("LAZY").setMultipleInstances(!1)),A.registerVersion("@firebase/auth-compat","0.5.12")}(Q.A)}}]);